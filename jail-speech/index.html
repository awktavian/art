<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Jail Speech ‚Äî Memory Restored</title>
    <meta name="description" content="A childhood speech contest entry from 1998, naturally restored from VHS.">
    
    <meta property="og:title" content="The Jail Speech ‚Äî Memory Restored">
    <meta property="og:description" content="'Be smart, don't do drugs, and stay in school.' ‚Äî Tim, 1998">
    <meta property="og:image" content="images/poster.jpg">
    <meta name="theme-color" content="#0a0806">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicons/favicon-32.png">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0a0806;
            --text: #fff8f0;
            --text-dim: rgba(255, 248, 240, 0.5);
            --accent: #f5a623;
            --accent-glow: rgba(245, 166, 35, 0.4);
            --vhs-warm: #fcb69f;
            --green: #4ade80;
            --red: #f87171;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', system-ui, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Grain */
        .grain {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9998;
            opacity: 0.015;
            mix-blend-mode: overlay;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
        }
        
        /* Loading */
        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.6s ease;
        }
        .loading.hidden { opacity: 0; pointer-events: none; }
        
        .loading-ring {
            width: 44px;
            height: 44px;
            border: 2px solid rgba(245, 166, 35, 0.15);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading-text {
            margin-top: 1rem;
            font-size: 0.55rem;
            letter-spacing: 0.4em;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .loading-progress {
            margin-top: 0.6rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--accent);
        }
        
        /* Start Overlay */
        #startOverlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, rgba(20, 12, 8, 0.97) 0%, var(--bg) 70%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #startOverlay:focus { outline: none; }
        #startOverlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        
        .intro-badge {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.2rem;
            opacity: 0;
            animation: fadeUp 0.8s ease forwards 0.2s;
        }
        
        .badge {
            padding: 0.35rem 0.7rem;
            border-radius: 4px;
            font-size: 0.55rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 0.05em;
        }
        .badge.vhs {
            background: rgba(248, 113, 113, 0.12);
            border: 1px solid var(--red);
            color: var(--red);
        }
        .badge.enhanced {
            background: rgba(74, 222, 128, 0.12);
            border: 1px solid var(--green);
            color: var(--green);
        }
        .badge-arrow {
            color: var(--accent);
            font-size: 1rem;
            opacity: 0;
            animation: fadeUp 0.5s ease forwards 0.35s;
        }
        
        .intro-year {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.4em;
            color: var(--accent);
            margin-bottom: 0.6rem;
            opacity: 0;
            animation: fadeUp 0.8s ease forwards 0.45s;
        }
        
        #startOverlay h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 7vw, 4rem);
            font-weight: 400;
            font-style: italic;
            opacity: 0;
            animation: titleReveal 1s ease forwards 0.6s;
            text-align: center;
        }
        
        .subtitle {
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            margin-top: 0.6rem;
            text-transform: uppercase;
            opacity: 0;
            animation: fadeUp 0.8s ease forwards 1s;
        }
        
        .start-hint {
            position: absolute;
            bottom: 8%;
            font-size: 0.5rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            text-transform: uppercase;
            opacity: 0;
            animation: pulse 2s ease-in-out infinite, fadeUp 0.8s ease forwards 1.3s;
        }
        
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes titleReveal {
            0% { opacity: 0; transform: scale(0.94) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }
        
        /* Player Container */
        .player {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            opacity: 0;
            pointer-events: none;
            z-index: 1;
            transition: opacity 0.6s ease;
        }
        .player.active { 
            opacity: 1; 
            pointer-events: auto;
        }
        
        .video-frame {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: calc(100vh * 4 / 3);
            cursor: ew-resize;
        }
        
        /* Video Layers */
        .video-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        #videoOriginal { 
            z-index: 1; 
        }
        
        .enhanced-layer {
            z-index: 2;
            /* Clip from LEFT - shows RIGHT portion (enhanced on right side) */
            clip-path: inset(0 0 0 50%);
            transition: opacity 0.35s ease;
        }
        
        .enhanced-layer.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Blend Divider */
        .divider {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background: linear-gradient(180deg, transparent 0%, var(--text) 10%, var(--text) 90%, transparent 100%);
            z-index: 20;
            transform: translateX(-50%);
            box-shadow: 0 0 12px rgba(255, 248, 240, 0.1);
            pointer-events: none;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        
        .divider::after {
            content: '‚ü∑';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9rem;
            color: var(--text);
            z-index: 1;
        }
        
        .video-frame.dragging { cursor: grabbing; }
        .video-frame.dragging .divider::before {
            transform: translate(-50%, -50%) scale(1.1);
            border-color: var(--accent);
        }
        
        /* Video Labels */
        .labels {
            position: absolute;
            top: 1rem;
            left: 0;
            right: 9rem; /* Room for language buttons */
            display: flex;
            justify-content: space-between;
            padding: 0 1.2rem;
            z-index: 25;
            pointer-events: none;
        }
        
        .label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.5rem;
            font-weight: 500;
            letter-spacing: 0.08em;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(6px);
            opacity: 0;
            animation: labelIn 0.4s ease forwards;
        }
        .label.original { color: var(--vhs-warm); animation-delay: 0.15s; }
        .label.enhanced { color: var(--green); animation-delay: 0.25s; }
        @keyframes labelIn {
            from { opacity: 0; transform: translateY(-4px); }
            to { opacity: 0.8; transform: translateY(0); }
        }
        
        /* Language Switcher */
        .lang-switcher {
            position: fixed;
            top: 0.8rem;
            right: 0.8rem;
            z-index: 200;
            display: flex;
            gap: 0.3rem;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s ease;
        }
        .lang-switcher.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .lang-btn {
            padding: 0.3rem 0.55rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.55rem;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 3px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .lang-btn:hover {
            color: var(--text);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .lang-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
        }
        .lang-btn.switching {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           GLASS PANE ‚Äî Ethereal subtitle + controls
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        
        .glass {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            
            background: linear-gradient(
                to top,
                rgba(10, 8, 6, 0.95) 0%,
                rgba(10, 8, 6, 0.75) 25%,
                rgba(10, 8, 6, 0.4) 50%,
                rgba(10, 8, 6, 0.15) 75%,
                transparent 100%
            );
            
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            
            padding: 0 0 1.2rem 0;
            min-height: 140px;
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .glass::before {
            content: '';
            position: absolute;
            top: 0;
            left: 10%;
            right: 10%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 248, 240, 0.08), transparent);
        }
        
        /* Subtitle Area */
        .subtitle-area {
            width: 100%;
            max-width: 680px;
            text-align: center;
            padding: 0.8rem 1.2rem;
            min-height: 3rem;
        }
        
        .subtitle-line {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.1rem, 2.5vw, 1.5rem);
            font-weight: 400;
            font-style: italic;
            line-height: 1.6;
            color: var(--text);
            text-shadow: 
                0 0 20px rgba(0, 0, 0, 0.9),
                0 0 40px rgba(0, 0, 0, 0.6),
                0 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 0.02em;
            animation: subtitleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes subtitleGlow {
            0% { text-shadow: 0 0 20px rgba(0, 0, 0, 0.9), 0 0 40px rgba(0, 0, 0, 0.6), 0 2px 4px rgba(0, 0, 0, 0.8); }
            100% { text-shadow: 0 0 25px rgba(0, 0, 0, 0.9), 0 0 50px rgba(0, 0, 0, 0.5), 0 2px 6px rgba(0, 0, 0, 0.7), 0 0 60px rgba(245, 166, 35, 0.1); }
        }
        
        .subtitle-line .word {
            display: inline;
            opacity: 0.5;
            transition: opacity 0.15s ease, color 0.15s ease, text-shadow 0.15s ease;
        }
        
        .subtitle-line .word.spoken {
            opacity: 1;
        }
        
        .subtitle-line .word.current {
            color: var(--accent);
            text-shadow: 0 0 8px var(--accent-glow);
        }
        
        /* Controls */
        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            padding: 0 1rem;
            width: 100%;
            max-width: 480px;
        }
        
        .btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            opacity: 0.5;
            flex-shrink: 0;
        }
        
        .btn:hover {
            opacity: 1;
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .btn:active { transform: scale(0.95); }
        .btn:focus { outline: none; }
        .btn:focus-visible { box-shadow: 0 0 0 2px var(--accent); }
        
        .btn svg { width: 11px; height: 11px; fill: currentColor; }
        
        .btn.play {
            width: 36px;
            height: 36px;
            background: var(--accent);
            border: none;
            opacity: 1;
            box-shadow: 0 2px 10px rgba(245, 166, 35, 0.2);
        }
        .btn.play:hover {
            transform: scale(1.08);
            box-shadow: 0 3px 14px rgba(245, 166, 35, 0.3);
        }
        .btn.play svg { width: 14px; height: 14px; fill: var(--bg); }
        
        /* Progress */
        .progress-area {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            max-width: 280px;
        }
        
        .progress-track {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
            transition: height 0.12s ease;
        }
        .progress-track:hover { height: 5px; }
        
        .progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            width: 0%;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            right: -3px;
            top: 50%;
            transform: translateY(-50%);
            width: 7px;
            height: 7px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.12s ease;
        }
        .progress-track:hover .progress-fill::after { opacity: 1; }
        
        .time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-dim);
            white-space: nowrap;
            min-width: 65px;
        }
        
        /* Volume */
        .volume-area {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .volume-slider {
            width: 0;
            height: 3px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 2px;
            outline: none;
            opacity: 0;
            transition: all 0.2s ease;
        }
        .volume-area:hover .volume-slider {
            width: 45px;
            opacity: 1;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 8px;
            height: 8px;
            background: var(--text);
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* End Overlay */
        #endOverlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at 50% 40%, #1a1208 0%, var(--bg) 70%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 900;
            opacity: 0;
            visibility: hidden;
            transition: all 0.6s ease;
        }
        #endOverlay.visible { opacity: 1; visibility: visible; }
        
        .end-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0;
        }
        #endOverlay.visible .end-icon {
            animation: endPop 0.6s ease forwards 0.2s;
        }
        @keyframes endPop {
            from { opacity: 0; transform: scale(0) rotate(-10deg); }
            to { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        .end-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.3rem, 3vw, 2rem);
            font-style: italic;
            margin-bottom: 0.3rem;
            opacity: 0;
            color: #ffecd2;
        }
        #endOverlay.visible .end-title { animation: fadeUp 0.6s ease forwards 0.4s; }
        
        .end-sub {
            font-size: 0.6rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            opacity: 0;
        }
        #endOverlay.visible .end-sub { animation: fadeUp 0.6s ease forwards 0.6s; }
        
        .replay-btn {
            padding: 0.7rem 1.5rem;
            font-family: inherit;
            font-size: 0.65rem;
            font-weight: 500;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s ease;
            opacity: 0;
        }
        #endOverlay.visible .replay-btn { animation: fadeUp 0.6s ease forwards 0.8s; }
        .replay-btn:hover {
            background: var(--accent);
            color: var(--bg);
        }
        
        /* Tech whisper */
        .tech {
            position: fixed;
            bottom: 0.4rem;
            left: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.45rem;
            color: var(--text-dim);
            opacity: 0.15;
            z-index: 50;
        }
        .tech span { color: var(--accent); }
        
        /* Seek flash */
        .seek-flash {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.4rem;
            color: var(--text);
            opacity: 0;
            pointer-events: none;
            z-index: 500;
        }
        .seek-flash.show {
            animation: seekPop 0.3s ease forwards;
        }
        @keyframes seekPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            40% { opacity: 1; transform: translate(-50%, -50%) scale(1.02); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Language transition */
        .lang-flash {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            color: var(--accent);
            opacity: 0;
            pointer-events: none;
            z-index: 500;
        }
        .lang-flash.show {
            animation: langPop 0.5s ease forwards;
        }
        @keyframes langPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            30% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
    </style>
</head>
<body>
    <div class="grain" aria-hidden="true"></div>
    <div class="seek-flash" id="seekFlash"></div>
    <div class="lang-flash" id="langFlash"></div>
    
    <div class="loading" id="loading">
        <div class="loading-ring"></div>
        <div class="loading-text">Preserving Time</div>
        <div class="loading-progress" id="loadProgress">0%</div>
    </div>
    
    <div id="startOverlay" tabindex="0" role="button" aria-label="Click to begin">
        <div class="intro-badge">
            <span class="badge vhs">VHS 640√ó480</span>
            <span class="badge-arrow">‚Üí</span>
            <span class="badge enhanced">2K 2560√ó1920</span>
        </div>
        <div class="intro-year">‚âà 1998</div>
        <h1>"The Jail Speech"</h1>
        <div class="subtitle">Natural Restoration ¬∑ Texture Preserved</div>
        <div class="start-hint">Click anywhere to begin</div>
    </div>
    
    <div class="player" id="player">
        <div class="video-frame" id="videoFrame">
            <!-- Original VHS (left side, always visible, muted) -->
            <video id="videoOriginal" class="video-layer" playsinline muted preload="auto">
                <source src="https://storage.googleapis.com/kagami-public/jail-speech/original.mp4?v=2" type="video/mp4">
            </video>
            
            <!-- Enhanced videos (right side, one active at a time) -->
            <!-- v=2: Iris-3 with correct framing (Jan 4, 2026) -->
            <video id="videoEN" class="video-layer enhanced-layer" playsinline preload="auto">
                <source src="https://storage.googleapis.com/kagami-public/jail-speech/enhanced.mp4?v=2" type="video/mp4">
            </video>
            <video id="videoES" class="video-layer enhanced-layer hidden" playsinline preload="auto">
                <source src="https://storage.googleapis.com/kagami-public/jail-speech/enhanced_es.mp4?v=2" type="video/mp4">
            </video>
            <video id="videoJA" class="video-layer enhanced-layer hidden" playsinline preload="auto">
                <source src="https://storage.googleapis.com/kagami-public/jail-speech/enhanced_ja.mp4?v=2" type="video/mp4">
            </video>
            
            <div class="divider" id="divider"></div>
            
            <div class="labels">
                <span class="label original">VHS ¬∑ 1998</span>
                <span class="label enhanced" id="enhancedLabel">RESTORED</span>
            </div>
        </div>
    </div>
    
    <div class="lang-switcher" id="langSwitcher">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="es">ES</button>
        <button class="lang-btn" data-lang="ja">Êó•Êú¨Ë™û</button>
    </div>
    
    <div class="glass" id="glass">
        <div class="subtitle-area">
            <div class="subtitle-line" id="subtitleLine"></div>
        </div>
        
        <div class="controls">
            <button class="btn" id="rwdBtn" aria-label="Rewind 5s">
                <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
            </button>
            
            <button class="btn play" id="playBtn" aria-label="Play">
                <svg id="iconPlay" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg id="iconPause" viewBox="0 0 24 24" style="display:none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            
            <button class="btn" id="fwdBtn" aria-label="Forward 5s">
                <svg viewBox="0 0 24 24"><path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/></svg>
            </button>
            
            <div class="progress-area">
                <div class="progress-track" id="progressTrack">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="time" id="timeDisplay">0:00 / 0:00</div>
            </div>
            
            <div class="volume-area">
                <button class="btn" id="volBtn" aria-label="Volume">
                    <svg id="iconVol" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                    <svg id="iconMute" viewBox="0 0 24 24" style="display:none"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                </button>
                <input type="range" class="volume-slider" id="volSlider" min="0" max="100" value="70">
            </div>
        </div>
    </div>
    
    <div id="endOverlay">
        <div class="end-icon">üìº</div>
        <h2 class="end-title">"The Jail Speech"</h2>
        <p class="end-sub">The texture of time, preserved</p>
        <button class="replay-btn" id="replayBtn">Watch Again</button>
    </div>
    
    <div class="tech"><span>Iris-3</span> ¬∑ natural 4√ó restoration</div>
    
    <script>
    /**
     * THE JAIL SPEECH ‚Äî Video Player
     * 
     * Architecture:
     * - Original VHS video on LEFT (always synced to EN timing, muted)
     * - Enhanced video on RIGHT (EN/ES/JA - one active at a time)
     * - Percentage-based seek for language switching
     * - Crossfade transition between dubbed versions
     * 
     * Video Durations:
     * - EN: 263.03s
     * - ES: 267.73s (1.8% longer)
     * - JA: 279.36s (6.2% longer)
     */
    
    // === VIDEO DURATIONS (measured) ===
    const DURATIONS = {
        en: 263.029,
        es: 267.733,
        ja: 279.360,
        original: 263.029
    };
    
    // === SUBTITLE DATA ===
    // Accurate transcription from Whisper ASR
    // Timestamps are percentages (0-1) of each video's duration
    
    const SUBTITLES = {
        en: [
            { pct: 0.000, end: 0.016, text: "This is the police. Stand up and put your hands in the air." },
            { pct: 0.016, end: 0.023, text: "Hands in the air. Come on, stand up." },
            { pct: 0.027, end: 0.035, text: "You have the right to remain silent." },
            { pct: 0.035, end: 0.057, text: "Anything you say or do can and will be used against you in a court of law." },
            { pct: 0.057, end: 0.069, text: "Not many people want to hear these sounds, and you shouldn't need to." },
            { pct: 0.069, end: 0.073, text: "By the way, you can sit down here." },
            { pct: 0.073, end: 0.090, text: "Hi, I'm Tim Jacobi, and I'm here to tell you how and why." },
            { pct: 0.090, end: 0.114, text: "That's a good idea. Jail, prison, penitentiary, the big house, the Pokey, the pit." },
            { pct: 0.115, end: 0.131, text: "Who's got a break? Iron bar hotel?" },
            { pct: 0.131, end: 0.143, text: "The hokey or lockup?" },
            { pct: 0.143, end: 0.169, text: "647,000 people in the U.S. have been in the slammer at one time or another." },
            { pct: 0.169, end: 0.188, text: "And following hundreds of those go back, so they must like it there." },
            { pct: 0.188, end: 0.203, text: "By the way, anybody here from California? Anybody?" },
            { pct: 0.203, end: 0.220, text: "You have the highest chance in the U.S. of going to jail." },
            { pct: 0.220, end: 0.239, text: "So, you may end up with some of that, you know." },
            { pct: 0.253, end: 0.267, text: "The easiest way to not go to jail is to not get caught." },
            { pct: 0.267, end: 0.286, text: "But, even better, don't do anything wrong." },
            { pct: 0.286, end: 0.314, text: "The hardest way not to go to jail is to pay big money for a good lawyer." },
            { pct: 0.314, end: 0.325, text: "Things can take a very long time in court of law." },
            { pct: 0.329, end: 0.344, text: "This is how a day is typically spent in jail." },
            { pct: 0.378, end: 0.386, text: "That was 10 seconds." },
            { pct: 0.386, end: 0.397, text: "Let's multiply that by 8,000, 6,000 or 4,000," },
            { pct: 0.397, end: 0.416, text: "subtract an hour for an exercise period, and you have your day." },
            { pct: 0.416, end: 0.432, text: "So, in conclusion..." },
            { pct: 0.432, end: 0.462, text: "Only plead innocent, think of a positive effect, and never ever run from the police." },
            { pct: 0.462, end: 0.477, text: "Now, the top 10 reasons not to go to jail." },
            { pct: 0.477, end: 0.496, text: "Reason number 10: Stripes make you look bad." },
            { pct: 0.496, end: 0.523, text: "Reason number 9: There's bad guys in there." },
            { pct: 0.523, end: 0.549, text: "Reason 8: There's a lot of cops around." },
            { pct: 0.549, end: 0.576, text: "Number 7: Cafeteria food." },
            { pct: 0.576, end: 0.618, text: "Number 6: You may get to wear the bad pants, but a ball and chain are just not cool." },
            { pct: 0.618, end: 0.637, text: "Reason number 5: They never take those mug shots from the right angle." },
            { pct: 0.637, end: 0.656, text: "Hmm, I need a volunteer or two." },
            { pct: 0.656, end: 0.667, text: "Thank you for volunteering, why don't you come on up?" },
            { pct: 0.667, end: 0.686, text: "Get this around your neck, and hold it for the audience." },
            { pct: 0.686, end: 0.698, text: "Doesn't this look terrible?" },
            { pct: 0.698, end: 0.713, text: "It looks even worse." },
            { pct: 0.713, end: 0.724, text: "And here's the worst shot yet." },
            { pct: 0.724, end: 0.743, text: "Now, look at this." },
            { pct: 0.743, end: 0.755, text: "Take some different pictures like this, and everything will work out great." },
            { pct: 0.755, end: 0.766, text: "You can take this off now." },
            { pct: 0.766, end: 0.778, text: "Here, you can have your free card for your troubles." },
            { pct: 0.778, end: 0.793, text: "You may need it someday, don't worry." },
            { pct: 0.793, end: 0.812, text: "Reason number 4: It's no cruel or unusual punishment in the United States." },
            { pct: 0.812, end: 0.854, text: "It was made by the Eighth Amendment, but I hear in prison they have color TVs with cable and no remote." },
            { pct: 0.854, end: 0.880, text: "Number 3: A saw blade in the cake just ruins the flavor." },
            { pct: 0.880, end: 0.914, text: "Reason number 2: On the outside, every Wednesday is 29 cent hamburger day at McDonald's." },
            { pct: 0.914, end: 0.926, text: "You don't want to miss it." },
            { pct: 0.926, end: 0.960, text: "And, the number one reason not to go to jail is Bubba." },
            { pct: 0.960, end: 0.971, text: "So," },
            { pct: 0.971, end: 0.983, text: "be smart," },
            { pct: 0.983, end: 0.994, text: "don't do drugs," },
            { pct: 0.994, end: 1.000, text: "and stay in school." },
        ],
        // ES/JA use same timing - dubbed videos are same content different language
        es: [
            { pct: 0.000, end: 0.016, text: "¬°Esta es la polic√≠a! ¬°Lev√°ntate y pon las manos en el aire!" },
            { pct: 0.016, end: 0.023, text: "¬°Manos arriba! ¬°Vamos, lev√°ntate!" },
            { pct: 0.027, end: 0.035, text: "Tienes derecho a guardar silencio." },
            { pct: 0.035, end: 0.057, text: "Cualquier cosa que digas o hagas puede y ser√° usada en tu contra." },
            { pct: 0.057, end: 0.069, text: "No mucha gente quiere escuchar estos sonidos, y no deber√≠as necesitarlo." },
            { pct: 0.069, end: 0.073, text: "Por cierto, puedes sentarte aqu√≠." },
            { pct: 0.073, end: 0.090, text: "Hola, soy Tim Jacobi, y estoy aqu√≠ para decirte c√≥mo y por qu√©." },
            { pct: 0.090, end: 0.114, text: "Es buena idea. La c√°rcel, la prisi√≥n, el penal, la casa grande, el bote." },
            { pct: 0.115, end: 0.143, text: "¬øQui√©n tiene un descanso? ¬øEl hotel de barras de hierro? ¬øEl encierro?" },
            { pct: 0.143, end: 0.169, text: "647,000 personas en EE.UU. han estado en la c√°rcel en alg√∫n momento." },
            { pct: 0.169, end: 0.188, text: "Y cientos de ellos vuelven, as√≠ que les debe gustar." },
            { pct: 0.188, end: 0.220, text: "Por cierto, ¬øalguien aqu√≠ es de California? Tienen la mayor probabilidad de ir a la c√°rcel." },
            { pct: 0.253, end: 0.286, text: "La forma m√°s f√°cil de no ir a la c√°rcel es no dejarse atrapar. Pero mejor, no hagas nada malo." },
            { pct: 0.286, end: 0.325, text: "La forma m√°s dif√≠cil es pagar mucho dinero por un buen abogado. Las cosas pueden tardar mucho en los tribunales." },
            { pct: 0.329, end: 0.386, text: "As√≠ es como se pasa un d√≠a t√≠pico en la c√°rcel... Esos fueron 10 segundos." },
            { pct: 0.386, end: 0.432, text: "Multiplica eso por 8,000, resta una hora de ejercicio, y tienes tu d√≠a." },
            { pct: 0.432, end: 0.462, text: "En conclusi√≥n: Solo declara inocente, piensa en efectos positivos, y nunca corras de la polic√≠a." },
            { pct: 0.462, end: 0.496, text: "Las 10 razones principales para no ir a la c√°rcel. Raz√≥n 10: Las rayas te hacen ver mal." },
            { pct: 0.496, end: 0.549, text: "Raz√≥n 9: Hay tipos malos ah√≠. Raz√≥n 8: Hay muchos polic√≠as alrededor." },
            { pct: 0.549, end: 0.618, text: "N√∫mero 7: Comida de cafeter√≠a. N√∫mero 6: Los pantalones de prisi√≥n no son geniales." },
            { pct: 0.618, end: 0.656, text: "Raz√≥n 5: Nunca toman las fotos de la ficha desde el √°ngulo correcto. Necesito un voluntario." },
            { pct: 0.656, end: 0.713, text: "Gracias por ofrecerte. Ponte esto. ¬øNo se ve terrible?" },
            { pct: 0.713, end: 0.778, text: "Se ve a√∫n peor. Ahora toma diferentes fotos as√≠ y todo saldr√° bien." },
            { pct: 0.778, end: 0.854, text: "Raz√≥n 4: No es castigo cruel en EE.UU., pero en prisi√≥n tienen TV por cable sin control remoto." },
            { pct: 0.854, end: 0.914, text: "N√∫mero 3: Una sierra en el pastel arruina el sabor. Raz√≥n 2: Los mi√©rcoles hay hamburguesas a 29 centavos." },
            { pct: 0.914, end: 0.960, text: "Y la raz√≥n n√∫mero uno para no ir a la c√°rcel es... Bubba." },
            { pct: 0.960, end: 1.000, text: "As√≠ que... s√© inteligente, no uses drogas, y qu√©date en la escuela." },
        ],
        ja: [
            { pct: 0.000, end: 0.016, text: "Ë≠¶ÂØü„Å†ÔºÅÁ´ã„Å£„Å¶‰∏°Êâã„Çí‰∏ä„Åí„ÇçÔºÅ" },
            { pct: 0.016, end: 0.023, text: "Êâã„Çí‰∏ä„Åí„ÇçÔºÅ„Åï„ÅÇ„ÄÅÁ´ã„Å¶ÔºÅ" },
            { pct: 0.027, end: 0.035, text: "„ÅÇ„Å™„Åü„Å´„ÅØÈªôÁßòÊ®©„Åå„ÅÇ„Çã„ÄÇ" },
            { pct: 0.035, end: 0.057, text: "„ÅÇ„Å™„Åü„ÅåË®Ä„ÅÜ„Åì„Å®„ÅØÂÖ®„Å¶Ê≥ïÂª∑„Åß‰∏çÂà©„Å™Ë®ºÊã†„Å®„Åó„Å¶‰Ωø„Çè„Çå„Çã„ÄÇ" },
            { pct: 0.057, end: 0.069, text: "„Åì„Çì„Å™Èü≥„ÇíËÅû„Åç„Åü„ÅÑ‰∫∫„ÅØ„ÅÇ„Åæ„Çä„ÅÑ„Å™„ÅÑ„Åó„ÄÅËÅû„ÅèÂøÖË¶Å„ÇÇ„Å™„ÅÑ„ÄÇ" },
            { pct: 0.069, end: 0.073, text: "„Å®„Åì„Çç„Åß„ÄÅ„Åì„Åì„Å´Â∫ß„Å£„Å¶„ÅÑ„ÅÑ„Çà„ÄÇ" },
            { pct: 0.073, end: 0.090, text: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅ„ÉÜ„Ç£„É†„Éª„Ç∏„Çß„Ç§„Ç≥„Éì„Åß„Åô„ÄÇ„Åù„ÅÆÁêÜÁî±„ÇíË™¨Êòé„Åó„Åæ„Åô„ÄÇ" },
            { pct: 0.090, end: 0.114, text: "ÂàëÂãôÊâÄ„ÄÅÁõ£ÁçÑ„ÄÅÁâ¢Â±ã„ÄÅ„É†„Ç∑„Éß„ÄÅ„Éñ„ÇøÁÆ±„ÄÅÈâÑÊ†ºÂ≠ê„Éõ„ÉÜ„É´„ÄÇ" },
            { pct: 0.115, end: 0.169, text: "„Ç¢„É°„É™„Ç´„Åß„ÅØ64‰∏á7000‰∫∫„Åå‰∏ÄÂ∫¶„ÅØÂàëÂãôÊâÄ„Å´ÂÖ•„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çã„ÄÇ" },
            { pct: 0.169, end: 0.188, text: "„Åù„Åó„Å¶‰ΩïÁôæ‰∫∫„ÇÇ„ÅåÊàª„Å£„Å¶„Åè„Çã„ÄÇ„Åç„Å£„Å®Ê∞ó„Å´ÂÖ•„Å£„Å¶„Çã„Çì„Å†„Çç„ÅÜ„ÄÇ" },
            { pct: 0.188, end: 0.220, text: "„Å®„Åì„Çç„Åß„ÄÅ„Ç´„É™„Éï„Ç©„É´„Éã„Ç¢„Åã„ÇâÊù•„Åü‰∫∫„ÅÑ„ÇãÔºüÂàëÂãôÊâÄ„Å´Ë°å„ÅèÁ¢∫Áéá„Åå‰∏ÄÁï™È´ò„ÅÑ„Çà„ÄÇ" },
            { pct: 0.253, end: 0.286, text: "ÂàëÂãôÊâÄ„Å´Ë°å„Åã„Å™„ÅÑ‰∏ÄÁï™Á∞°Âçò„Å™ÊñπÊ≥ï„ÅØÊçï„Åæ„Çâ„Å™„ÅÑ„Åì„Å®„ÄÇ„Åß„ÇÇ„ÄÅÊÇ™„ÅÑ„Åì„Å®„Çí„Åó„Å™„ÅÑ„Åª„ÅÜ„Åå„ÅÑ„ÅÑ„ÄÇ" },
            { pct: 0.286, end: 0.325, text: "‰∏ÄÁï™Èõ£„Åó„ÅÑÊñπÊ≥ï„ÅØÈ´ò„ÅÑÂºÅË≠∑Â£´„ÇíÈõá„ÅÜ„Åì„Å®„ÄÇË£ÅÂà§„ÅØÈï∑„Åè„Åã„Åã„Çã„ÄÇ" },
            { pct: 0.329, end: 0.386, text: "ÂàëÂãôÊâÄ„Åß„ÅÆ‰∏ÄÊó•„ÅØ„Åì„Çì„Å™ÊÑü„Åò... „Åì„Çå„Åå10Áßí„Å†„Å£„Åü„ÄÇ" },
            { pct: 0.386, end: 0.432, text: "„Åì„Çå„Çí8000ÂÄç„Åó„Å¶„ÄÅÈÅãÂãïÊôÇÈñì„Çí1ÊôÇÈñìÂºï„Åè„Å®„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏ÄÊó•„Å†„ÄÇ" },
            { pct: 0.432, end: 0.462, text: "ÁµêË´ñÔºöÁÑ°ÂÆü„Çí‰∏ªÂºµ„Åó„ÄÅ„Éù„Ç∏„ÉÜ„Ç£„Éñ„Å´ËÄÉ„Åà„ÄÅÁµ∂ÂØæ„Å´Ë≠¶ÂØü„Åã„ÇâÈÄÉ„Åí„Çã„Å™„ÄÇ" },
            { pct: 0.462, end: 0.496, text: "ÂàëÂãôÊâÄ„Å´Ë°å„Åã„Å™„ÅÑÁêÜÁî±„Éà„ÉÉ„Éó10„ÄÇÁêÜÁî±10ÔºöÁ∏ûÊ®°Êßò„ÅØ‰ººÂêà„Çè„Å™„ÅÑ„ÄÇ" },
            { pct: 0.496, end: 0.549, text: "ÁêÜÁî±9ÔºöÊÇ™„ÅÑÂ•¥„Åå„ÅÑ„Çã„ÄÇÁêÜÁî±8ÔºöË≠¶ÂÆò„Åå„Åü„Åè„Åï„Çì„ÅÑ„Çã„ÄÇ" },
            { pct: 0.549, end: 0.618, text: "ÁêÜÁî±7Ôºö„Ç´„Éï„Çß„ÉÜ„É™„Ç¢„ÅÆÈ£ü‰∫ã„ÄÇÁêÜÁî±6ÔºöÂõö‰∫∫Êúç„ÅØ„Åã„Å£„Åì„Çà„Åè„Å™„ÅÑ„ÄÇ" },
            { pct: 0.618, end: 0.656, text: "ÁêÜÁî±5Ôºö„Éû„Ç∞„Ç∑„Éß„ÉÉ„Éà„ÅØ„ÅÑ„ÅÑËßíÂ∫¶„ÅßÊíÆ„Å£„Å¶„Åè„Çå„Å™„ÅÑ„ÄÇ„Éú„É©„É≥„ÉÜ„Ç£„Ç¢„ÅåÂøÖË¶Å„Å†„ÄÇ" },
            { pct: 0.656, end: 0.713, text: "ÂèÇÂä†„Åó„Å¶„Åè„Çå„Å¶„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÇ„Åì„Çå„ÇíÈ¶ñ„Å´„Åã„Åë„Å¶„ÄÇ„Å≤„Å©„ÅèË¶ã„Åà„Çã„Åß„Åó„ÇáÔºü" },
            { pct: 0.713, end: 0.778, text: "„ÇÇ„Å£„Å®„Å≤„Å©„ÅÑ„ÄÇ„Åì„ÅÜ„ÇÑ„Å£„Å¶ÈÅï„ÅÜÂÜôÁúü„ÇíÊíÆ„Çå„Å∞Â§ß‰∏àÂ§´„ÄÇ" },
            { pct: 0.778, end: 0.854, text: "ÁêÜÁî±4Ôºö„Ç¢„É°„É™„Ç´„Åß„ÅØÊÆãÈÖ∑„Å™ÂàëÁΩ∞„ÅØÁ¶ÅÊ≠¢„Å†„Åå„ÄÅÂàëÂãôÊâÄ„Å´„ÅØ„É™„É¢„Ç≥„É≥„Å™„Åó„ÅÆ„Ç±„Éº„Éñ„É´„ÉÜ„É¨„Éì„Åå„ÅÇ„Çã„ÄÇ" },
            { pct: 0.854, end: 0.914, text: "ÁêÜÁî±3Ôºö„Ç±„Éº„Ç≠„ÅÆ‰∏≠„ÅÆ„ÅÆ„Åì„Åé„Çä„ÅØÂë≥„ÇíÂè∞ÁÑ°„Åó„Å´„Åô„Çã„ÄÇÁêÜÁî±2ÔºöÂ§ñ„Åß„ÅØÊØéÈÄ±Ê∞¥ÊõúÊó•„Å´„Éè„É≥„Éê„Éº„Ç¨„Éº„Åå29„Çª„É≥„Éà„ÄÇ" },
            { pct: 0.914, end: 0.960, text: "„Åù„Åó„Å¶ÂàëÂãôÊâÄ„Å´Ë°å„Åã„Å™„ÅÑÁêÜÁî±Á¨¨1‰Ωç„ÅØ... „Éñ„ÉÉ„Éê„ÄÇ" },
            { pct: 0.960, end: 1.000, text: "„Å†„Åã„Çâ... Ë≥¢„Åè„ÅÇ„Çå„ÄÅ„Éâ„É©„ÉÉ„Ç∞„ÅØ„ÇÑ„Çã„Å™„ÄÅÂ≠¶Ê†°„Å´Ë°å„Åë„ÄÇ" },
        ],
    };

    // === DOM ===
    const loading = document.getElementById('loading');
    const loadProgress = document.getElementById('loadProgress');
    const startOverlay = document.getElementById('startOverlay');
    const player = document.getElementById('player');
    const videoFrame = document.getElementById('videoFrame');
    const videoOriginal = document.getElementById('videoOriginal');
    const videoEN = document.getElementById('videoEN');
    const videoES = document.getElementById('videoES');
    const videoJA = document.getElementById('videoJA');
    const divider = document.getElementById('divider');
    const enhancedLabel = document.getElementById('enhancedLabel');
    const langSwitcher = document.getElementById('langSwitcher');
    const langBtns = document.querySelectorAll('.lang-btn');
    const langFlash = document.getElementById('langFlash');
    const glass = document.getElementById('glass');
    const subtitleLine = document.getElementById('subtitleLine');
    const playBtn = document.getElementById('playBtn');
    const iconPlay = document.getElementById('iconPlay');
    const iconPause = document.getElementById('iconPause');
    const rwdBtn = document.getElementById('rwdBtn');
    const fwdBtn = document.getElementById('fwdBtn');
    const progressTrack = document.getElementById('progressTrack');
    const progressFill = document.getElementById('progressFill');
    const timeDisplay = document.getElementById('timeDisplay');
    const volBtn = document.getElementById('volBtn');
    const volSlider = document.getElementById('volSlider');
    const iconVol = document.getElementById('iconVol');
    const iconMute = document.getElementById('iconMute');
    const endOverlay = document.getElementById('endOverlay');
    const replayBtn = document.getElementById('replayBtn');
    const seekFlash = document.getElementById('seekFlash');

    // === STATE ===
    let currentLang = 'en';
    let currentVideo = videoEN;
    let blendPos = 50;
    let isDragging = false;
    let isPlaying = false;
    let isSwitching = false;
    let lastSubIdx = -1;

    const videos = { en: videoEN, es: videoES, ja: videoJA };
    const langLabels = { en: 'RESTORED', es: 'ESPA√ëOL', ja: 'Êó•Êú¨Ë™û' };

    // === INIT ===
    async function init() {
        // Set initial volumes
        const vol = 0.7;
        videoEN.volume = vol;
        videoES.volume = vol;
        videoJA.volume = vol;
        volSlider.value = 70;

        // Load all videos
        const allVideos = [videoOriginal, videoEN, videoES, videoJA];
        let loaded = 0;

        await Promise.all(allVideos.map(v => 
            new Promise(resolve => {
                if (v.readyState >= 3) {
                    loaded++;
                    loadProgress.textContent = Math.round((loaded / 4) * 100) + '%';
                    resolve();
                } else {
                    v.addEventListener('canplaythrough', () => {
                        loaded++;
                        loadProgress.textContent = Math.round((loaded / 4) * 100) + '%';
                        resolve();
                    }, { once: true });
                    v.load();
                }
            })
        ));
        
        // CRITICAL: Force all videos to time 0 and wait for seek
        await Promise.all(allVideos.map(v => 
            new Promise(resolve => {
                v.currentTime = 0;
                v.addEventListener('seeked', () => resolve(), { once: true });
                setTimeout(resolve, 200); // Fallback
            })
        ));
        
        setTimeout(() => loading.classList.add('hidden'), 300);
        setupEvents();
    }

    function setupEvents() {
        // Start
        startOverlay.addEventListener('click', start);
        startOverlay.addEventListener('keydown', e => {
            if (e.code === 'Space' || e.code === 'Enter') start();
        });
        
        // Blend slider
        videoFrame.addEventListener('mousedown', startDrag);
        videoFrame.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);
        
        // Controls
        playBtn.addEventListener('click', togglePlay);
        rwdBtn.addEventListener('click', () => seek(-5));
        fwdBtn.addEventListener('click', () => seek(5));
        progressTrack.addEventListener('click', seekToPos);
        volBtn.addEventListener('click', toggleMute);
        volSlider.addEventListener('input', updateVolume);
        replayBtn.addEventListener('click', replay);
        
        // Language
        langBtns.forEach(btn => btn.addEventListener('click', () => switchLang(btn.dataset.lang)));
        
        // Keyboard
        document.addEventListener('keydown', handleKey);
        
        // Time update (only listen to active video)
        videoEN.addEventListener('timeupdate', onTimeUpdate);
        videoES.addEventListener('timeupdate', onTimeUpdate);
        videoJA.addEventListener('timeupdate', onTimeUpdate);
        
        videoEN.addEventListener('ended', showEnd);
        videoES.addEventListener('ended', showEnd);
        videoJA.addEventListener('ended', showEnd);
        
        // Double click fullscreen
        videoFrame.addEventListener('dblclick', toggleFullscreen);
    }

    function start() {
        startOverlay.classList.add('hidden');
        player.classList.add('active');
        langSwitcher.classList.add('visible');
        glass.classList.add('visible');
        // NO AUTOPLAY - user must click play button
    }

    // === BLEND SLIDER ===
    function startDrag(e) {
        if (e.target.closest('.controls') || e.target.closest('.btn')) return;
        isDragging = true;
        videoFrame.classList.add('dragging');
        drag(e);
    }

    function drag(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const rect = videoFrame.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        blendPos = Math.max(0, Math.min(100, (x / rect.width) * 100));
        
        divider.style.left = blendPos + '%';
        
        // Update clip-path on all enhanced videos
        // Clip from LEFT by blendPos% - shows right portion (enhanced on right)
        // blendPos=50 means: inset(0 0 0 50%) = left half clipped, right half visible
        const clip = `inset(0 0 0 ${blendPos}%)`;
        videoEN.style.clipPath = clip;
        videoES.style.clipPath = clip;
        videoJA.style.clipPath = clip;
    }

    function endDrag() {
        isDragging = false;
        videoFrame.classList.remove('dragging');
    }

    // === PLAYBACK ===
    function togglePlay() {
        if (isPlaying) {
            pause();
        } else {
            play();
        }
    }

    function play() {
        videoOriginal.play();
        currentVideo.play();
        isPlaying = true;
        iconPlay.style.display = 'none';
        iconPause.style.display = 'block';
    }

    function pause() {
        videoOriginal.pause();
        currentVideo.pause();
        isPlaying = false;
        iconPlay.style.display = 'block';
        iconPause.style.display = 'none';
    }

    function seek(secs) {
        const dur = DURATIONS[currentLang];
        const t = Math.max(0, Math.min(dur, currentVideo.currentTime + secs));
        
        currentVideo.currentTime = t;
        
        // Sync original using percentage
        const pct = t / dur;
        videoOriginal.currentTime = pct * DURATIONS.original;
        
        seekFlash.textContent = secs > 0 ? `+${secs}s` : `${secs}s`;
        seekFlash.classList.add('show');
        setTimeout(() => seekFlash.classList.remove('show'), 300);
    }

    function seekToPos(e) {
        const rect = progressTrack.getBoundingClientRect();
        const pct = (e.clientX - rect.left) / rect.width;
        
        const dur = DURATIONS[currentLang];
        currentVideo.currentTime = pct * dur;
        videoOriginal.currentTime = pct * DURATIONS.original;
    }

    function onTimeUpdate() {
        if (isSwitching) return;
        
        const t = currentVideo.currentTime;
        const dur = DURATIONS[currentLang];
        const pct = t / dur;
        
        progressFill.style.width = (pct * 100) + '%';
        timeDisplay.textContent = `${fmt(t)} / ${fmt(dur)}`;
        
        // Keep original synced (percentage-based)
        const origTarget = pct * DURATIONS.original;
        if (Math.abs(videoOriginal.currentTime - origTarget) > 0.3) {
            videoOriginal.currentTime = origTarget;
        }
        
        updateSubtitles(pct);
    }

    function fmt(s) {
        if (!s || isNaN(s)) return '0:00';
        const m = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    // === SUBTITLES ===
    function updateSubtitles(pct) {
        const subs = SUBTITLES[currentLang];
        
        // Find current subtitle
        let subIdx = -1;
        for (let i = 0; i < subs.length; i++) {
            if (pct >= subs[i].pct && pct <= subs[i].end) {
                subIdx = i;
                break;
            }
        }
        
        if (subIdx === -1) {
            if (subtitleLine.textContent !== '') {
                subtitleLine.textContent = '';
                lastSubIdx = -1;
            }
            return;
        }
        
        // Only update DOM if subtitle changed
        if (subIdx !== lastSubIdx) {
            lastSubIdx = subIdx;
            subtitleLine.textContent = subs[subIdx].text;
        }
    }

    // === VOLUME ===
    function toggleMute() {
        currentVideo.muted = !currentVideo.muted;
        iconVol.style.display = currentVideo.muted ? 'none' : 'block';
        iconMute.style.display = currentVideo.muted ? 'block' : 'none';
    }

    function updateVolume() {
        const vol = volSlider.value / 100;
        videoEN.volume = vol;
        videoES.volume = vol;
        videoJA.volume = vol;
        
        iconVol.style.display = vol === 0 ? 'none' : 'block';
        iconMute.style.display = vol === 0 ? 'block' : 'none';
    }

    // === LANGUAGE SWITCH (PERCENTAGE-BASED WITH CROSSFADE) ===
    async function switchLang(lang) {
        if (lang === currentLang || isSwitching) return;
        
        isSwitching = true;
        const wasPlaying = isPlaying;
        
        // Calculate percentage position in current video
        const pct = currentVideo.currentTime / DURATIONS[currentLang];
        
        // Mark buttons
        langBtns.forEach(b => b.classList.toggle('switching', b.dataset.lang !== lang));
        
        // Show language indicator
        langFlash.textContent = langLabels[lang];
        langFlash.classList.add('show');
        
        // Pause current
        if (wasPlaying) pause();
        
        // Get new video
        const newVideo = videos[lang];
        const newTime = pct * DURATIONS[lang];
        
        // Seek new video
        newVideo.currentTime = newTime;
        
        // Wait for seek to complete
        await new Promise(resolve => {
            const check = () => {
                if (Math.abs(newVideo.currentTime - newTime) < 0.5 || newVideo.readyState >= 3) {
                    resolve();
                } else {
                    requestAnimationFrame(check);
                }
            };
            newVideo.addEventListener('seeked', resolve, { once: true });
            setTimeout(resolve, 300); // Timeout fallback
            check();
        });
        
        // Crossfade: show new, hide old
        // Clip from LEFT - enhanced video shows on RIGHT side
        const clip = `inset(0 0 0 ${blendPos}%)`;
        newVideo.style.clipPath = clip;
        newVideo.classList.remove('hidden');
        
        // Brief overlap then hide old
        await new Promise(r => setTimeout(r, 50));
        currentVideo.classList.add('hidden');
        
        // Update state
        const oldVideo = currentVideo;
        currentVideo = newVideo;
        currentLang = lang;
        lastSubIdx = -1;
        
        // Update label
        enhancedLabel.textContent = langLabels[lang];
        
        // Update buttons
        langBtns.forEach(b => {
            b.classList.toggle('active', b.dataset.lang === lang);
            b.classList.remove('switching');
        });
        
        // Remove flash
        setTimeout(() => langFlash.classList.remove('show'), 400);
        
        // Resume
        if (wasPlaying) {
            play();
        }
        
        isSwitching = false;
    }

    // === ENDING ===
    function showEnd() {
        glass.classList.remove('visible');
        endOverlay.classList.add('visible');
        pause();
    }

    function replay() {
        endOverlay.classList.remove('visible');
        glass.classList.add('visible');
        
        // Reset all videos
        videoOriginal.currentTime = 0;
        videoEN.currentTime = 0;
        videoES.currentTime = 0;
        videoJA.currentTime = 0;
        lastSubIdx = -1;
        
        setTimeout(() => play(), 200);
    }

    // === KEYBOARD ===
    function handleKey(e) {
        if (e.target.tagName === 'INPUT') return;
        
        switch(e.code) {
            case 'Space':
                e.preventDefault();
                if (!startOverlay.classList.contains('hidden')) {
                    start();
                } else {
                    togglePlay();
                }
                break;
            case 'ArrowLeft':
                e.preventDefault();
                seek(-5);
                break;
            case 'ArrowRight':
                e.preventDefault();
                seek(5);
                break;
            case 'KeyM':
                toggleMute();
                break;
            case 'KeyF':
                toggleFullscreen();
                break;
            case 'Digit1':
                switchLang('en');
                break;
            case 'Digit2':
                switchLang('es');
                break;
            case 'Digit3':
                switchLang('ja');
                break;
        }
    }

    function toggleFullscreen() {
        if (document.fullscreenElement) {
            document.exitFullscreen();
        } else {
            document.documentElement.requestFullscreen();
        }
    }

    // GO
    init();
    </script>
</body>
</html>
