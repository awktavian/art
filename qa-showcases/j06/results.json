{
  "journey": {
    "$schema": "./journey-schema.json",
    "id": "j06",
    "name": "Device Pairing",
    "description": "Verifies adding and configuring new smart home devices",
    "tags": [
      "devices",
      "pairing",
      "setup",
      "integration"
    ],
    "safety_critical": false,
    "phases": [
      {
        "id": "P1",
        "name": "Add Device Entry",
        "description": "User can access add device flow",
        "actions": [
          {
            "type": "tap_text",
            "target": "Settings|Add"
          },
          {
            "type": "wait",
            "duration_ms": 500
          },
          {
            "type": "tap_text",
            "target": "Add Device|New Device|+"
          }
        ],
        "assertions": [
          {
            "type": "visible",
            "value": "Add|Device|Scan|Search|Discover",
            "timeout_ms": 5000
          }
        ],
        "screenshot": true
      },
      {
        "id": "P2",
        "name": "Device Discovery",
        "description": "App searches for nearby devices",
        "actions": [
          {
            "type": "tap_text",
            "target": "Scan|Search|Discover"
          },
          {
            "type": "wait",
            "duration_ms": 3000
          }
        ],
        "assertions": [
          {
            "type": "visible",
            "value": "Searching|Scanning|Found|Device|No devices",
            "timeout_ms": 10000
          }
        ],
        "screenshot": true
      },
      {
        "id": "P3",
        "name": "Device Selection",
        "description": "User selects a device to add",
        "assertions": [
          {
            "type": "visible",
            "value": "Select|Choose|Device|Light|Switch|Sensor",
            "timeout_ms": 5000
          }
        ],
        "screenshot": true
      },
      {
        "id": "P4",
        "name": "Device Configuration",
        "description": "User configures device name and room",
        "actions": [
          {
            "type": "tap_text",
            "target": "Device|Light|Switch"
          },
          {
            "type": "wait",
            "duration_ms": 1000
          }
        ],
        "assertions": [
          {
            "type": "visible",
            "value": "Name|Room|Configure|Setup",
            "timeout_ms": 5000
          }
        ],
        "screenshot": true
      },
      {
        "id": "Final",
        "name": "Pairing Complete",
        "description": "Device is successfully added",
        "actions": [
          {
            "type": "tap_text",
            "target": "Done|Save|Add"
          },
          {
            "type": "wait",
            "duration_ms": 2000
          }
        ],
        "assertions": [
          {
            "type": "visible",
            "value": "Added|Success|Complete|Home|Device",
            "timeout_ms": 5000
          }
        ],
        "screenshot": true
      }
    ],
    "platforms": {
      "ios": {
        "enabled": true,
        "bundle_id": "com.kagami.ios",
        "launch_args": [
          "-KagamiSkipOnboarding",
          "-DemoDevices"
        ]
      },
      "ipad": {
        "enabled": true,
        "bundle_id": "com.kagami.ios",
        "launch_args": [
          "-KagamiSkipOnboarding",
          "-DemoDevices"
        ]
      },
      "android": {
        "enabled": true,
        "bundle_id": "com.kagami.android",
        "env_vars": {
          "kagami_test_bypass": "1",
          "kagami_demo_devices": "1"
        }
      },
      "wearos": {
        "enabled": false,
        "bundle_id": "com.kagami.wear",
        "overrides": {
          "comment": "Device pairing done via phone"
        }
      },
      "watchos": {
        "enabled": false,
        "bundle_id": "com.kagami.ios.watchkitapp",
        "overrides": {
          "comment": "Device pairing done via iPhone"
        }
      },
      "tvos": {
        "enabled": false,
        "bundle_id": "com.kagami.tv",
        "overrides": {
          "comment": "Device pairing done via phone"
        }
      },
      "visionos": {
        "enabled": true,
        "bundle_id": "com.kagami.vision",
        "launch_args": [
          "-KagamiSkipOnboarding",
          "-DemoDevices"
        ]
      },
      "desktop": {
        "enabled": true,
        "bundle_id": "com.kagami.desktop"
      }
    },
    "setup": {
      "requires_auth": false,
      "skip_onboarding": true,
      "pre_conditions": [
        "Demo devices available for discovery",
        "Bluetooth/WiFi enabled (if real devices)"
      ]
    }
  },
  "platforms": [
    {
      "platform": "ios",
      "journey_id": "j06",
      "journey_name": "Device Pairing",
      "phases": [
        {
          "id": "P1",
          "name": "Add Device Entry",
          "status": "pass",
          "assertions_checked": 1,
          "assertions_passed": 1
        }
      ],
      "screenshots": [
        "/tmp/kagami-showcases/j06_20260116_074618/ios_P1.png"
      ],
      "status": "pass"
    },
    {
      "platform": "ipad",
      "journey_id": "j06",
      "journey_name": "Device Pairing",
      "phases": [
        {
          "id": "P1",
          "name": "Add Device Entry",
          "status": "pass",
          "assertions_checked": 1,
          "assertions_passed": 1
        }
      ],
      "screenshots": [
        "/tmp/kagami-showcases/j06_20260116_074618/ipad_P1.png"
      ],
      "status": "pass"
    },
    {
      "platform": "android",
      "journey_id": "j06",
      "journey_name": "Device Pairing",
      "phases": [
        {
          "id": "P1",
          "name": "Add Device Entry",
          "status": "fail",
          "assertions_checked": 1,
          "assertions_passed": 0,
          "failed_assertion": {
            "type": "visible",
            "value": "Add|Device|Scan|Search|Discover",
            "timeout_ms": 5000
          }
        }
      ],
      "screenshots": [
        "/tmp/kagami-showcases/j06_20260116_074618/android_P1.png"
      ],
      "status": "fail"
    },
    {
      "platform": "wearos",
      "status": "skipped",
      "reason": "Platform disabled in journey"
    },
    {
      "platform": "watchos",
      "status": "skipped",
      "reason": "Platform disabled in journey"
    },
    {
      "platform": "tvos",
      "status": "skipped",
      "reason": "Platform disabled in journey"
    },
    {
      "platform": "visionos",
      "journey_id": "j06",
      "journey_name": "Device Pairing",
      "phases": [
        {
          "id": "P1",
          "name": "Add Device Entry",
          "status": "pass",
          "assertions_checked": 1,
          "assertions_passed": 1
        }
      ],
      "screenshots": [
        "/tmp/kagami-showcases/j06_20260116_074618/visionos_P1.png"
      ],
      "status": "pass"
    },
    {
      "platform": "desktop",
      "journey_id": "j06",
      "journey_name": "Device Pairing",
      "phases": [
        {
          "id": "P1",
          "name": "Add Device Entry",
          "status": "fail",
          "assertions_checked": 1,
          "assertions_passed": 0,
          "action_error": "Element not found: Add Device|New Device|+",
          "failed_assertion": {
            "type": "visible",
            "value": "Add|Device|Scan|Search|Discover",
            "timeout_ms": 5000
          }
        }
      ],
      "screenshots": [
        "/tmp/kagami-showcases/j06_20260116_074618/desktop_P1.png"
      ],
      "status": "fail"
    }
  ],
  "gemini_report": {
    "journey_id": "j06",
    "all_passed": false,
    "results": {
      "ios": {
        "screen_identified": "Home screen of the Kagami app",
        "expected_screen": "Add Device Entry screen for Device Pairing",
        "screen_matches_expected": false,
        "platform": "ios",
        "phase": "P1",
        "journey_id": "j06",
        "assertions_checked": [
          {
            "assertion": "VISIBLE: 'Add|Device|Scan|Search|Discover'",
            "result": "FAIL",
            "details": "The 'Add|Device|Scan|Search|Discover' element is not visible on the screen."
          }
        ],
        "elements_found": [
          "Time (7:46)",
          "Battery icon",
          "Wifi icon",
          "Microphone icon",
          "Kagami title",
          "Disconnected status",
          "Home Hub label",
          "Quick Actions section",
          "Emergency button",
          "Movie Mode button",
          "Goodnight button",
          "Lock All button",
          "Active Scenes section",
          "No active scenes message",
          "Occupied Rooms section",
          "No rooms currently occupied message",
          "Protected status",
          "Home icon",
          "Rooms icon",
          "Scenes icon",
          "Settings icon"
        ],
        "elements_missing": [
          "Add Device Button",
          "Search Button",
          "Scan Button",
          "Discover Button"
        ],
        "passed": false,
        "failure_reason": "The screen is not the expected 'Add Device Entry' screen and lacks the necessary elements for device pairing (Add/Device/Scan/Search/Discover).",
        "issues": [
          {
            "severity": "critical",
            "category": "technical",
            "element": "Add Device Button",
            "description": "The 'Add Device' button is missing, which is required for device pairing.",
            "expected": "Add Device button should be present",
            "actual": "Add Device button is missing",
            "suggested_fix": "Implement the 'Add Device' button on the screen.",
            "platform": "ios"
          },
          {
            "severity": "critical",
            "category": "technical",
            "element": "Scan Button",
            "description": "The 'Scan' button is missing, which is required for device pairing.",
            "expected": "Scan button should be present",
            "actual": "Scan button is missing",
            "suggested_fix": "Implement the 'Scan' button on the screen.",
            "platform": "ios"
          },
          {
            "severity": "critical",
            "category": "technical",
            "element": "Search Button",
            "description": "The 'Search' button is missing, which is required for device pairing.",
            "expected": "Search button should be present",
            "actual": "Search button is missing",
            "suggested_fix": "Implement the 'Search' button on the screen.",
            "platform": "ios"
          },
          {
            "severity": "critical",
            "category": "technical",
            "element": "Discover Button",
            "description": "The 'Discover' button is missing, which is required for device pairing.",
            "expected": "Discover button should be present",
            "actual": "Discover button is missing",
            "suggested_fix": "Implement the 'Discover' button on the screen.",
            "platform": "ios"
          }
        ],
        "scores": {
          "technical": 30,
          "accessibility": 80,
          "visual": 90
        },
        "score_justifications": {
          "technical": "The screen does not contain the necessary elements for the specified phase (Add Device Entry). Therefore, the technical score is very low. Missing key elements 'Add', 'Device', 'Scan', 'Search', 'Discover'",
          "accessibility": "The screen appears to have good contrast and touch target sizes, resulting in a good accessibility score. Some touch targets might be smaller than 44x44.",
          "visual": "The screen has a visually appealing design and follows platform conventions, resulting in a high visual score."
        },
        "platform_compliance": {
          "conventions_followed": [
            "Uses SF Symbols or system-consistent icons",
            "System fonts (SF Pro) or appropriate alternatives",
            "Navigation follows iOS HIG (tab bars)",
            "Safe area insets respected (notch, home indicator)",
            "Rounded corners match system style (continuous corners)"
          ],
          "conventions_violated": [],
          "red_flags_found": []
        },
        "summary": "The screen is the Home screen and not the expected 'Add Device Entry' screen, lacking the necessary elements for device pairing. The required 'Add', 'Device', 'Scan', 'Search', and 'Discover' buttons are not visible.",
        "recommendations": [
          "Ensure the correct screen is being displayed for the 'Add Device Entry' phase.",
          "Implement the 'Add Device', 'Scan', 'Search', and 'Discover' buttons on the screen to enable device pairing.",
          "Verify the navigation flow to ensure the user is directed to the correct screen when attempting to add a device."
        ]
      },
      "ipad": {
        "screen_identified": "Home screen of the Kagami app",
        "expected_screen": "Add Device Entry screen for Device Pairing",
        "screen_matches_expected": false,
        "platform": "ipad",
        "phase": "P1",
        "journey_id": "j06",
        "assertions_checked": [
          {
            "assertion": "'Add|Device|Scan|Search|Discover'",
            "result": "FAIL",
            "details": "None of these terms are present in the UI"
          }
        ],
        "elements_found": [
          "Kagami",
          "Disconnected Home Hub",
          "Quick Actions (Emergency, Movie Mode, Goodnight, Lock All)",
          "Active Scenes (No active scenes)",
          "Occupied Rooms (No rooms currently occupied)",
          "Home",
          "Rooms",
          "Scenes",
          "Settings",
          "Protected"
        ],
        "elements_missing": [
          "Add Device Entry UI",
          "'Add|Device|Scan|Search|Discover' elements for device pairing"
        ],
        "passed": false,
        "failure_reason": "The screen does not include the required UI to 'Add Device Entry'",
        "issues": [
          {
            "severity": "critical",
            "category": "technical",
            "element": "Add Device Entry UI",
            "description": "The screen is the home screen and does not contain the necessary UI elements to add a device entry. This is a critical failure because the screen is supposed to allow adding a device for pairing",
            "expected": "Add Device Entry UI should be present",
            "actual": "Add Device Entry UI is missing",
            "suggested_fix": "Implement the Add Device Entry UI.",
            "platform": "ipad"
          }
        ],
        "scores": {
          "technical": 30,
          "accessibility": 90,
          "visual": 90
        },
        "score_justifications": {
          "technical": "The screen is functional and does not crash, but it's not the expected screen and lacks required functionalities, so it is given a low passing score. Fails because it is not the add device screen.",
          "accessibility": "The screen seems reasonably accessible, with good contrast and legible text. Without being able to test using assistive technologies, I am assuming it is okay. No obvious A11y issues.",
          "visual": "The screen looks visually appealing and well-designed, following the conventions of mobile UI. No issues with spacing or layout observed."
        },
        "platform_compliance": {
          "conventions_followed": [
            "Uses bottom navigation bar",
            "Adapts to larger screen"
          ],
          "conventions_violated": [],
          "red_flags_found": []
        },
        "summary": "The screen shown is the home screen instead of Add Device Entry screen. The Journey FAILS.",
        "recommendations": [
          "Ensure the correct screen is being displayed for this phase of device pairing.",
          "Verify that Add Device Entry UI elements are present on the designated 'Add Device Entry' screen."
        ]
      },
      "android": {
        "screen_identified": "Home screen",
        "expected_screen": "Add Device Entry screen for Device Pairing",
        "screen_matches_expected": false,
        "platform": "android",
        "phase": "P1",
        "journey_id": "j06",
        "assertions_checked": [
          {
            "assertion": "Add|Device|Scan|Search|Discover",
            "result": "FAIL",
            "details": "None of the required keywords are present on this screen"
          }
        ],
        "elements_found": [
          "Kagami",
          "Disconnected",
          "Safety",
          "Latency",
          "Quick Scenes",
          "Goodnight",
          "Movie",
          "We",
          "Quick Actions",
          "Emergency",
          "Tap to activate",
          "Lights On",
          "Lights Off",
          "Open",
          "Close",
          "Control Center",
          "Rooms",
          "By location",
          "Scenes",
          "Automations",
          "Home",
          "Rooms",
          "Scenes",
          "Settings"
        ],
        "elements_missing": [
          "Add Device Button",
          "Scan Device Button",
          "Search Device Button",
          "Discover Device Button"
        ],
        "passed": false,
        "failure_reason": "The Home screen is displayed instead of the Add Device Entry screen as required by the journey phase.",
        "issues": [
          {
            "severity": "critical",
            "category": "technical",
            "element": "Add Device Entry screen",
            "description": "The Add Device Entry screen is not displayed. The Home screen is displayed instead, which does not have the required elements for this phase in the Device Pairing Journey.",
            "expected": "Add Device Entry Screen",
            "actual": "Home Screen",
            "suggested_fix": "Ensure the correct screen is presented to the user for this step of the journey.",
            "platform": "android"
          }
        ],
        "scores": {
          "technical": 0,
          "accessibility": 90,
          "visual": 90
        },
        "score_justifications": {
          "technical": "The wrong screen is displayed and it is missing all required elements for this phase, resulting in a fatal error.",
          "accessibility": "The screen itself seems to be well designed with appropriate contrast and touch targets.",
          "visual": "The screen appears visually polished and adheres to platform conventions."
        },
        "platform_compliance": {
          "conventions_followed": [
            "Material Design 3 patterns",
            "Edge-to-edge design",
            "System navigation",
            "Roboto or system font",
            "Proper touch targets"
          ],
          "conventions_violated": [],
          "red_flags_found": []
        },
        "summary": "The Home screen is displayed instead of the Add Device Entry screen in the Device Pairing Journey, causing the test to fail. All required elements related to 'Add|Device|Scan|Search|Discover' are missing.",
        "recommendations": [
          "Verify that the correct navigation and screen presentation logic is implemented to ensure the Add Device Entry screen is displayed during this phase of the device pairing journey.",
          "Ensure all required assertions and elements are present on the Add Device Entry screen."
        ]
      },
      "visionos": {
        "screen_identified": "Home screen with Kagami control panel overlay.",
        "expected_screen": "Add Device Entry screen for Device Pairing",
        "screen_matches_expected": false,
        "platform": "visionos",
        "phase": "P1",
        "journey_id": "j06",
        "assertions_checked": [
          {
            "assertion": "VISIBLE: 'Add|Device|Scan|Search|Discover'",
            "result": "FAIL",
            "details": "The required actions for adding a device (Add, Device, Scan, Search, Discover) are not visible on the screen."
          }
        ],
        "elements_found": [
          "Home",
          "Kagami",
          "Emergency",
          "Activate safety mode",
          "Lights",
          "Move Mode",
          "Goodnight",
          "All Off"
        ],
        "elements_missing": [
          "Add Device",
          "Scan",
          "Search",
          "Discover"
        ],
        "passed": false,
        "failure_reason": "The screen presented does not relate to adding a new device. The UI elements required for Device Pairing are completely missing.",
        "issues": [
          {
            "severity": "critical",
            "category": "technical",
            "element": "Screen Content",
            "description": "The screen shows the Home screen with Kagami controls instead of the Add Device Entry screen.",
            "expected": "The screen should display options to add a new device (Add, Scan, Search, Discover).",
            "actual": "The screen displays Kagami control panel with options like Emergency, Lights, Movie Mode, Goodnight, and All Off.",
            "suggested_fix": "Ensure the app navigates to the correct screen during the device pairing process.",
            "platform": "visionos"
          },
          {
            "severity": "critical",
            "category": "technical",
            "element": "Add Device actions",
            "description": "The primary actions required for device pairing are missing from the screen.",
            "expected": "The screen should have 'Add Device', 'Scan', 'Search', or 'Discover' options.",
            "actual": "These elements are not present on the screen.",
            "suggested_fix": "Implement the necessary buttons and functionalities to allow the user to add, scan, search for, or discover devices.",
            "platform": "visionos"
          }
        ],
        "scores": {
          "technical": 30,
          "accessibility": 70,
          "visual": 80
        },
        "score_justifications": {
          "technical": "The required elements for adding a device are missing, leading to a near-failure. The screen is incorrect.",
          "accessibility": "The contrast and text legibility appear reasonable, but full evaluation requires more detailed inspection for touch target sizes etc.",
          "visual": "The Kagami control panel appears reasonably well-designed, visually consistent with the rest of the scene, and follows some platform conventions."
        },
        "platform_compliance": {
          "conventions_followed": [
            "Glass material backgrounds",
            "Spatial UI with proper depth"
          ],
          "conventions_violated": [],
          "red_flags_found": []
        },
        "summary": "The application presents the wrong screen, showing the Home screen with Kagami controls instead of the Device Pairing entry screen.",
        "recommendations": [
          "Ensure correct navigation to the 'Add Device' screen during the device pairing process.",
          "Implement the necessary UI elements ('Add Device', 'Scan', 'Search', 'Discover') on the designated screen.",
          "Verify that all platform conventions are followed to optimize user experience."
        ]
      },
      "desktop": {
        "screen_identified": "Add Device Entry screen, showing the device search and emergency option.",
        "expected_screen": "Add Device Entry screen for Device Pairing",
        "screen_matches_expected": true,
        "platform": "desktop",
        "phase": "P1",
        "journey_id": "j06",
        "assertions_checked": [
          {
            "assertion": "VISIBLE: 'Add|Device|Scan|Search|Discover'",
            "result": "PASS",
            "details": "The screen shows the device search input and emergency option, indicating the 'Add Device' entry point."
          }
        ],
        "elements_found": [
          "Agent label",
          "Auto dropdown",
          "Type / for commands, @ input field",
          "Microphone icon",
          "Emergency button",
          "Ready label",
          "esc to close hint",
          "navigate hint",
          "switch mode hint",
          "enter to select hint",
          "Kagami title"
        ],
        "elements_missing": [],
        "passed": true,
        "failure_reason": null,
        "issues": [],
        "scores": {
          "technical": 100,
          "accessibility": 100,
          "visual": 100
        },
        "score_justifications": {
          "technical": "All expected elements are present and functional.",
          "accessibility": "Text is readable, input fields are clearly labelled, and there appears to be keyboard navigation support.",
          "visual": "The layout is clean and follows desktop conventions. Hierarchy is clear."
        },
        "platform_compliance": {
          "conventions_followed": [
            "Keyboard navigation support",
            "Click targets",
            "Menu bar / command palette patterns"
          ],
          "conventions_violated": [],
          "red_flags_found": []
        },
        "summary": "The add device entry screen functions as expected with all required elements visible and a clean user interface.",
        "recommendations": []
      }
    },
    "issues": [
      {
        "severity": "critical",
        "category": "technical",
        "element": "Add Device Button",
        "description": "The 'Add Device' button is missing, which is required for device pairing.",
        "expected": "Add Device button should be present",
        "actual": "Add Device button is missing",
        "suggested_fix": "Implement the 'Add Device' button on the screen.",
        "platform": "ios"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Scan Button",
        "description": "The 'Scan' button is missing, which is required for device pairing.",
        "expected": "Scan button should be present",
        "actual": "Scan button is missing",
        "suggested_fix": "Implement the 'Scan' button on the screen.",
        "platform": "ios"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Search Button",
        "description": "The 'Search' button is missing, which is required for device pairing.",
        "expected": "Search button should be present",
        "actual": "Search button is missing",
        "suggested_fix": "Implement the 'Search' button on the screen.",
        "platform": "ios"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Discover Button",
        "description": "The 'Discover' button is missing, which is required for device pairing.",
        "expected": "Discover button should be present",
        "actual": "Discover button is missing",
        "suggested_fix": "Implement the 'Discover' button on the screen.",
        "platform": "ios"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Add Device Entry UI",
        "description": "The screen is the home screen and does not contain the necessary UI elements to add a device entry. This is a critical failure because the screen is supposed to allow adding a device for pairing",
        "expected": "Add Device Entry UI should be present",
        "actual": "Add Device Entry UI is missing",
        "suggested_fix": "Implement the Add Device Entry UI.",
        "platform": "ipad"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Add Device Entry screen",
        "description": "The Add Device Entry screen is not displayed. The Home screen is displayed instead, which does not have the required elements for this phase in the Device Pairing Journey.",
        "expected": "Add Device Entry Screen",
        "actual": "Home Screen",
        "suggested_fix": "Ensure the correct screen is presented to the user for this step of the journey.",
        "platform": "android"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Screen Content",
        "description": "The screen shows the Home screen with Kagami controls instead of the Add Device Entry screen.",
        "expected": "The screen should display options to add a new device (Add, Scan, Search, Discover).",
        "actual": "The screen displays Kagami control panel with options like Emergency, Lights, Movie Mode, Goodnight, and All Off.",
        "suggested_fix": "Ensure the app navigates to the correct screen during the device pairing process.",
        "platform": "visionos"
      },
      {
        "severity": "critical",
        "category": "technical",
        "element": "Add Device actions",
        "description": "The primary actions required for device pairing are missing from the screen.",
        "expected": "The screen should have 'Add Device', 'Scan', 'Search', or 'Discover' options.",
        "actual": "These elements are not present on the screen.",
        "suggested_fix": "Implement the necessary buttons and functionalities to allow the user to add, scan, search for, or discover devices.",
        "platform": "visionos"
      }
    ]
  },
  "timestamp": "20260116_074618"
}