/* ═══════════════════════════════════════════════════════════════════════════
   THE MACHINE — Loop as Industrial Equipment
   ═══════════════════════════════════════════════════════════════════════════ */
.loop-machine {
    position: relative;
    background: linear-gradient(180deg, var(--void-light) 0%, var(--void) 100%);
    border: 2px solid rgba(255, 217, 15, 0.25);
    border-radius: var(--space-md);
    padding: var(--space-xl) var(--space-lg) var(--space-lg);
    margin: var(--space-xl) 0;
    overflow: visible;
}
.loop-machine::before, .loop-machine::after {
    content: '';
    position: absolute;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 217, 15, 0.5) 0%, rgba(255, 217, 15, 0.15) 50%, transparent 70%);
    box-shadow: 0 0 10px rgba(255, 217, 15, 0.4);
}
.loop-machine::before { top: 12px; left: 12px; }
.loop-machine::after { top: 12px; right: 12px; }
.machine-status {
    position: absolute;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--ralph-green);
    text-transform: uppercase;
    letter-spacing: 0.12em;
}
.machine-status::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--ralph-green);
    border-radius: 50%;
    box-shadow: 0 0 10px var(--ralph-green), 0 0 20px var(--ralph-green);
    animation: machine-led 2s ease-in-out infinite;
}
@keyframes machine-led {
    0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--ralph-green), 0 0 20px var(--ralph-green); }
    50% { opacity: 0.5; box-shadow: 0 0 5px var(--ralph-green); }
}
.loop-conveyor {
    position: absolute;
    top: 50%;
    left: var(--space-md);
    right: var(--space-md);
    height: 4px;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 217, 15, 0.15) 10%, rgba(255, 217, 15, 0.25) 50%, rgba(255, 217, 15, 0.15) 90%, transparent 100%);
    border-radius: 2px;
    overflow: hidden;
    transform: translateY(-50%);
    margin-top: 12px;
}
.loop-conveyor::after {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(90deg, transparent 0px, transparent 18px, rgba(255, 217, 15, 0.4) 18px, rgba(255, 217, 15, 0.4) 20px);
    animation: conveyor-flow 1.5s linear infinite;
}
@keyframes conveyor-flow {
    from { transform: translateX(-20px); }
    to { transform: translateX(0); }
}

/* ═══ DIAGONALIZE — The Hero Step ═══ */
.loop-step.diagonalize {
    position: relative;
    background: linear-gradient(135deg, var(--ralph-yellow) 0%, #FFE566 50%, var(--ralph-yellow) 100%);
    font-size: 0.95rem;
    padding: var(--space-sm) var(--space-lg);
    box-shadow: 0 4px 25px rgba(255, 217, 15, 0.6), 0 0 50px rgba(255, 217, 15, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    animation: diag-glow 2s ease-in-out infinite;
    z-index: 2;
    overflow: visible;
}
@keyframes diag-glow {
    0%, 100% { box-shadow: 0 4px 25px rgba(255, 217, 15, 0.6), 0 0 50px rgba(255, 217, 15, 0.35); transform: scale(1); }
    50% { box-shadow: 0 6px 35px rgba(255, 217, 15, 0.8), 0 0 70px rgba(255, 217, 15, 0.5); transform: scale(1.06); }
}
.diagonalize-rays {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 180px;
    height: 180px;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: -1;
}
.diagonalize-rays::before {
    content: '';
    position: absolute;
    inset: 0;
    background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 217, 15, 0.5) 4deg, transparent 8deg, transparent 51deg, rgba(255, 217, 15, 0.4) 55deg, transparent 59deg, transparent 103deg, rgba(255, 217, 15, 0.5) 107deg, transparent 111deg, transparent 154deg, rgba(255, 217, 15, 0.4) 158deg, transparent 162deg, transparent 206deg, rgba(255, 217, 15, 0.5) 210deg, transparent 214deg, transparent 257deg, rgba(255, 217, 15, 0.4) 261deg, transparent 265deg, transparent 309deg, rgba(255, 217, 15, 0.5) 313deg, transparent 317deg, transparent 360deg);
    animation: rays-rotate 10s linear infinite;
    opacity: 0.8;
}
@keyframes rays-rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.spawn-badge {
    position: absolute;
    top: -16px;
    right: -16px;
    background: linear-gradient(135deg, var(--ralph-pink), #FF8DC7);
    color: white;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 12px;
    box-shadow: 0 3px 12px rgba(255, 105, 180, 0.6);
    animation: badge-pop 1.2s ease-in-out infinite;
    z-index: 10;
}
@keyframes badge-pop { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15) rotate(-3deg); } }
.loop-step.diagonalize:hover { transform: scale(1.18) rotate(-3deg); box-shadow: 0 10px 50px rgba(255, 217, 15, 0.9), 0 0 100px rgba(255, 217, 15, 0.6); }

/* ═══ MULTIPLY VISUAL — 7 Noses ═══ */
.multiply-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-lg);
    margin: var(--space-lg) 0;
    padding: var(--space-md) var(--space-lg);
    background: rgba(255, 217, 15, 0.06);
    border-radius: var(--space-sm);
    border: 1px dashed rgba(255, 217, 15, 0.35);
}
.multiply-visual .single { font-size: 2.8rem; opacity: 0.75; }
.multiply-visual .multiply-arrow { font-family: 'JetBrains Mono', monospace; font-size: 2rem; color: var(--ralph-yellow); animation: mult-pulse 1.5s ease-in-out infinite; }
@keyframes mult-pulse { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.35); opacity: 1; } }
.multiply-visual .many { display: flex; gap: 6px; font-size: 2rem; }
.multiply-visual .many span { opacity: 0; animation: nose-pop 0.6s ease-out forwards; }
.multiply-visual .many span:nth-child(1) { animation-delay: 0s; }
.multiply-visual .many span:nth-child(2) { animation-delay: .1s; }
.multiply-visual .many span:nth-child(3) { animation-delay: .2s; }
.multiply-visual .many span:nth-child(4) { animation-delay: .3s; }
.multiply-visual .many span:nth-child(5) { animation-delay: .4s; }
.multiply-visual .many span:nth-child(6) { animation-delay: .5s; }
.multiply-visual .many span:nth-child(7) { animation-delay: .6s; }
@keyframes nose-pop { 0% { opacity: 0; transform: scale(0) rotate(-180deg); } 60% { opacity: 1; transform: scale(1.25) rotate(12deg); } 100% { opacity: 1; transform: scale(1) rotate(0); } }

/* ═══ BIG IDEA — DIAGONALIZE Definition ═══ */
.big-idea.definition {
    position: relative;
    background: linear-gradient(135deg, var(--ralph-yellow) 0%, #FFED4A 35%, var(--ralph-pink) 100%);
    padding: var(--space-xl) var(--space-lg);
    overflow: visible;
    box-shadow: 0 0 80px rgba(255, 217, 15, 0.5), 0 21px 55px rgba(255, 217, 15, 0.4), inset 0 0 55px rgba(255, 255, 255, 0.25);
}
.big-idea.definition::before, .big-idea.definition::after {
    content: '';
    position: absolute;
    width: 45px;
    height: 45px;
    border: 5px solid var(--void);
    opacity: 0.5;
}
.big-idea.definition::before { top: 18px; left: 18px; border-right: none; border-bottom: none; animation: bracket-bob 2.5s ease-in-out infinite; }
.big-idea.definition::after { bottom: 18px; right: 18px; border-left: none; border-top: none; animation: bracket-bob 2.5s ease-in-out infinite 1.25s; }
@keyframes bracket-bob { 0%, 100% { opacity: 0.4; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.12); } }
.definition-burst {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 500%;
    height: 500%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, transparent 0%, transparent 12%, rgba(255, 255, 255, 0.2) 12.5%, transparent 13%, transparent 24%, rgba(255, 255, 255, 0.12) 24.5%, transparent 25%, transparent 36%, rgba(255, 255, 255, 0.06) 36.5%, transparent 37%);
    animation: burst-out 4s ease-out infinite;
    pointer-events: none;
}
@keyframes burst-out { 0% { transform: translate(-50%, -50%) scale(0.15); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }
.big-idea.definition .def-content { position: relative; z-index: 2; }
.big-idea.definition p { font-size: 2.4rem; line-height: 1.35; }
.big-idea.definition .keyword {
    display: inline-block;
    background: var(--void);
    color: var(--ralph-yellow);
    padding: 8px 24px;
    border-radius: 10px;
    font-family: 'JetBrains Mono', monospace;
    margin-right: 12px;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
    animation: kw-glow 2.5s ease-in-out infinite;
}
@keyframes kw-glow { 0%, 100% { box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5); } 50% { box-shadow: 0 5px 35px rgba(255, 217, 15, 0.6), 0 5px 25px rgba(0, 0, 0, 0.5); } }

/* ═══ SPAWN CODE BLOCK ═══ */
.code-spawn {
    position: relative;
    background: var(--void);
    border: 1px solid rgba(255, 217, 15, 0.35);
    border-radius: var(--space-sm);
    overflow: hidden;
    margin: var(--space-lg) 0;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
}
.code-spawn-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px var(--space-md);
    background: linear-gradient(180deg, var(--void-light), var(--void));
    border-bottom: 1px solid rgba(255, 217, 15, 0.25);
}
.code-spawn-dots { display: flex; gap: 7px; }
.code-spawn-dots span { width: 13px; height: 13px; border-radius: 50%; background: var(--ralph-red); }
.code-spawn-dots span:nth-child(2) { background: var(--ralph-yellow); }
.code-spawn-dots span:nth-child(3) { background: var(--ralph-green); }
.code-spawn-title { font-family: 'JetBrains Mono', monospace; font-size: 0.72rem; color: var(--text-dim); display: flex; align-items: center; gap: var(--space-xs); }
.spawn-status { color: var(--ralph-green); animation: sp-blink 1.2s ease-in-out infinite; }
@keyframes sp-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.35; } }
.code-spawn-counter { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--ralph-yellow); background: rgba(255, 217, 15, 0.18); padding: 5px 14px; border-radius: var(--space-xs); font-weight: 600; }
.code-spawn-body { padding: var(--space-md); }
.code-spawn pre { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; line-height: 2.1; margin: 0; }
.code-spawn .code-line { display: flex; align-items: center; gap: var(--space-sm); opacity: 0; transform: translateX(-20px); animation: ln-spawn 0.55s ease-out forwards; }
.code-spawn .code-line:nth-child(1) { animation-delay: 0.15s; }
.code-spawn .code-line:nth-child(2) { animation-delay: 0.30s; }
.code-spawn .code-line:nth-child(3) { animation-delay: 0.45s; }
.code-spawn .code-line:nth-child(4) { animation-delay: 0.60s; }
.code-spawn .code-line:nth-child(5) { animation-delay: 0.75s; }
.code-spawn .code-line:nth-child(6) { animation-delay: 0.90s; }
.code-spawn .code-line:nth-child(7) { animation-delay: 1.05s; }
.code-spawn .code-line:nth-child(8) { animation-delay: 1.20s; }
@keyframes ln-spawn { 0% { opacity: 0; transform: translateX(-20px); } 60% { opacity: 1; transform: translateX(6px); } 100% { opacity: 1; transform: translateX(0); } }
.code-spawn .line-indicator { width: 11px; height: 11px; border-radius: 50%; background: var(--text-dim); flex-shrink: 0; }
.code-spawn .code-line.spawned .line-indicator { background: var(--ralph-green); box-shadow: 0 0 14px var(--ralph-green); }
.code-spawn .code-line.comment .line-indicator { background: transparent; border: 1px dashed var(--text-dim); }

.loop-machine.animate-sequence .loop-step { opacity: 0; animation: step-drop 0.55s ease-out forwards; }
.loop-machine.animate-sequence .loop-step:nth-child(1) { animation-delay: 0.1s; }
.loop-machine.animate-sequence .loop-step:nth-child(3) { animation-delay: 0.3s; }
.loop-machine.animate-sequence .loop-step:nth-child(5) { animation-delay: 0.5s; }
.loop-machine.animate-sequence .loop-step:nth-child(7) { animation-delay: 0.7s; }
.loop-machine.animate-sequence .loop-step:nth-child(9) { animation-delay: 0.9s; }
.loop-machine.animate-sequence .loop-step:nth-child(11) { animation-delay: 1.1s; }
.loop-machine.animate-sequence .loop-step:nth-child(13) { animation-delay: 1.3s; }
@keyframes step-drop { 0% { opacity: 0; transform: translateY(-25px) scale(0.75); } 55% { opacity: 1; transform: translateY(6px) scale(1.08); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
.loop-machine.animate-sequence .loop-step.diagonalize { animation: diag-drop 0.9s ease-out forwards; animation-delay: 0.5s; }
@keyframes diag-drop { 0% { opacity: 0; transform: translateY(-35px) scale(0.25); } 35% { opacity: 1; transform: translateY(0) scale(1.35); } 55% { transform: scale(0.88); } 75% { transform: scale(1.12); } 100% { opacity: 1; transform: scale(1); } }
