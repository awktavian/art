<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Metrics ‚Äî KagamiOS Audit</title>
    <meta name="description" content="Detailed test metrics and coverage data for KagamiOS.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Èè°</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&family=Bangers&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="grid-pattern"></div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="index.html" class="nav-brand">
                <span class="nav-kanji">Èè°</span>
                <span class="nav-title">Test Audit</span>
                <span class="nav-badge">v2.0</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Overview</a></li>
                <li><a href="index.html#pyramid">Pyramid</a></li>
                <li><a href="metrics.html" class="active">Metrics</a></li>
                <li><a href="analysis.html">Analysis</a></li>
                <li><a href="actions.html">Actions</a></li>
            </ul>
        </div>
    </nav>

    <!-- Header -->
    <section class="hero" style="min-height: 50vh; padding-top: 140px;">
        <h1>Test Metrics</h1>
        <p class="hero-sub">
            Real numbers from actual test runs. No estimates. All verified.
        </p>
    </section>

    <!-- Test Run Results -->
    <section class="metrics-section">
        <div class="section-title">Verified Test Run Results</div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üß™</span>
                    <span class="metric-badge badge-pass">Total</span>
                </div>
                <div class="metric-value" style="color: var(--pass);">11,242</div>
                <div class="metric-label">Test Functions</div>
                <div class="metric-detail">via grep -r "def test_"</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">‚úÖ</span>
                    <span class="metric-badge badge-pass">Unit</span>
                </div>
                <div class="metric-value" style="color: var(--pass);">2,033</div>
                <div class="metric-label">Unit Tests Passing</div>
                <div class="metric-detail">162 failed ‚Ä¢ 163 errors</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üîó</span>
                    <span class="metric-badge badge-pass">Core</span>
                </div>
                <div class="metric-value" style="color: var(--pass);">3,727</div>
                <div class="metric-label">Core Tests Passing</div>
                <div class="metric-detail">501 failed ‚Ä¢ 140 errors</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üîí</span>
                    <span class="metric-badge badge-info">CBF</span>
                </div>
                <div class="metric-value" style="color: var(--flow);">3,779</div>
                <div class="metric-label">CBF References</div>
                <div class="metric-detail">Across 446 files ‚Ä¢ VERIFIED</div>
            </div>
        </div>
    </section>

    <!-- Test Categories -->
    <section class="table-section">
        <div class="section-title">Test Categories</div>

        <table class="data-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Total</th>
                    <th>Passed</th>
                    <th>Failed</th>
                    <th>Errors</th>
                    <th>Pass Rate</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="status-dot pass"></span> unit/ folder</td>
                    <td class="mono">2,554</td>
                    <td class="mono text-pass">2,033</td>
                    <td class="mono text-fail">162</td>
                    <td class="mono text-warn">163</td>
                    <td class="mono">85%</td>
                </tr>
                <tr>
                    <td><span class="status-dot pass"></span> core/ folder</td>
                    <td class="mono">4,803</td>
                    <td class="mono text-pass">3,727</td>
                    <td class="mono text-fail">501</td>
                    <td class="mono text-warn">140</td>
                    <td class="mono">84%</td>
                </tr>
                <tr>
                    <td><span class="status-dot pass"></span> integration/ folder</td>
                    <td class="mono">946</td>
                    <td class="mono text-pass">~800</td>
                    <td class="mono text-fail">~100</td>
                    <td class="mono text-warn">46</td>
                    <td class="mono">~85%</td>
                </tr>
                <tr>
                    <td><span class="status-dot pass"></span> forge/ folder</td>
                    <td class="mono">644</td>
                    <td class="mono text-pass">~550</td>
                    <td class="mono text-fail">~90</td>
                    <td class="mono">4</td>
                    <td class="mono">~85%</td>
                </tr>
                <tr>
                    <td><span class="status-dot warn"></span> e2e/ folder</td>
                    <td class="mono">218</td>
                    <td class="mono text-pass">~180</td>
                    <td class="mono text-fail">~35</td>
                    <td class="mono">3</td>
                    <td class="mono">~82%</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- Execution Stats -->
    <section class="metrics-section">
        <div class="section-title">Execution Statistics</div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üìÅ</span>
                    <span class="metric-badge badge-info">Lines</span>
                </div>
                <div class="metric-value">270,734</div>
                <div class="metric-label">Lines of Test Code</div>
                <div class="metric-detail">Across all test files</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">‚è±Ô∏è</span>
                    <span class="metric-badge badge-info">Time</span>
                </div>
                <div class="metric-value">205s</div>
                <div class="metric-label">Core Test Duration</div>
                <div class="metric-detail">3 minutes 25 seconds</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">‚ö°</span>
                    <span class="metric-badge badge-info">Speed</span>
                </div>
                <div class="metric-value">21</div>
                <div class="metric-label">Tests Per Second</div>
                <div class="metric-detail">Average execution speed</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">‚ö†Ô∏è</span>
                    <span class="metric-badge badge-warn">Warnings</span>
                </div>
                <div class="metric-value">1,053</div>
                <div class="metric-label">Deprecation Warnings</div>
                <div class="metric-detail">Mostly Pydantic V2 migration</div>
            </div>
        </div>
    </section>

    <!-- Test Distribution -->
    <section class="metrics-section">
        <div class="section-title">Test Distribution by Folder (CORRECTED)</div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üìÅ</span>
                </div>
                <div class="metric-value" style="font-size: 28px;">unit/</div>
                <div class="metric-label">2,554 functions (23%)</div>
                <div class="metric-detail">Pure unit tests ‚Ä¢ Fastest</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üìÅ</span>
                </div>
                <div class="metric-value" style="font-size: 28px;">core/</div>
                <div class="metric-label">4,803 functions (43%)</div>
                <div class="metric-detail">Mixed unit + integration</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üìÅ</span>
                </div>
                <div class="metric-value" style="font-size: 28px;">integration/</div>
                <div class="metric-label">946 functions (8%)</div>
                <div class="metric-detail">Cross-component tests</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-icon">üìÅ</span>
                </div>
                <div class="metric-value" style="font-size: 28px;">e2e/</div>
                <div class="metric-label">218 functions (2%)</div>
                <div class="metric-detail">Full system tests</div>
            </div>
        </div>

        <div style="margin-top: var(--space-lg); padding: var(--space-lg); background: var(--surface2); border-radius: 8px;">
            <p style="font-size: 14px; line-height: 1.7; color: var(--text-dim);">
                <strong style="color: var(--warn);">Note:</strong> Previous reports cited marker-based distribution
                (tier_unit: 24%, tier_integration: 61%). This CORRECTED view shows actual folder distribution.
                The <code>core/</code> folder contains a MIX of unit and integration tests,
                making the "inverted pyramid" narrative oversimplified.
            </p>
        </div>
    </section>

    <!-- Failure Analysis -->
    <section class="table-section">
        <div class="section-title">Top Failure Clusters</div>

        <table class="data-table">
            <thead>
                <tr>
                    <th>Component</th>
                    <th>Failures</th>
                    <th>Root Cause</th>
                    <th>Priority</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="status-dot fail"></span> World Model</td>
                    <td class="mono text-fail">87</td>
                    <td>Multi-step empowerment API changes</td>
                    <td><span class="metric-badge badge-fail">P0</span></td>
                </tr>
                <tr>
                    <td><span class="status-dot fail"></span> Consciousness Integration</td>
                    <td class="mono text-fail">28</td>
                    <td>Zero-abstraction validation logic</td>
                    <td><span class="metric-badge badge-warn">P1</span></td>
                </tr>
                <tr>
                    <td><span class="status-dot fail"></span> TLS Enforcement</td>
                    <td class="mono text-fail">15</td>
                    <td>Environment detection issues</td>
                    <td><span class="metric-badge badge-warn">P1</span></td>
                </tr>
                <tr>
                    <td><span class="status-dot fail"></span> Memory Bridge</td>
                    <td class="mono text-fail">12</td>
                    <td>Config mismatch (disabled by default)</td>
                    <td><span class="metric-badge badge-info">P2</span></td>
                </tr>
                <tr>
                    <td><span class="status-dot fail"></span> Property Tests</td>
                    <td class="mono text-fail">54</td>
                    <td>Hypothesis edge cases / flaky</td>
                    <td><span class="metric-badge badge-info">P2</span></td>
                </tr>
                <tr>
                    <td><span class="status-dot fail"></span> Contract Tests</td>
                    <td class="mono text-fail">37</td>
                    <td>Snapshot drift (expected)</td>
                    <td><span class="metric-badge badge-info">P2</span></td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-kanji">Èè°</div>
            <p class="footer-text">
                All metrics verified via actual pytest runs
            </p>
            <p class="footer-timestamp">
                Generated 2026-01-12 ‚Ä¢ pytest 8.x ‚Ä¢ Python 3.11.12
            </p>
        </div>
    </footer>
</body>
</html>
