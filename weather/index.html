<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What About the Weather? â€” Celestial Shades System</title>
    <meta name="description" content="A technical deep dive into building an astronomical shade automation system. Sun position calculation, window geometry, weather integration, and safety constraints.">
    <meta name="author" content="Tim Jacoby">
    <meta name="keywords" content="home automation, ephemeris, sun position, shade control, smart home, agentic systems, Python, async">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#07060B">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="What About the Weather? â€” Celestial Shades System">
    <meta property="og:description" content="A technical deep dive into astronomical shade automation. For engineers building agentic systems.">
    <meta property="og:site_name" content="Tim Jacoby">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="What About the Weather? â€” Celestial Shades System">
    <meta name="twitter:description" content="Astronomical shade automation â€” ephemeris, geometry, weather, and safety.">
    <meta name="twitter:creator" content="@awktavian">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;1,400&family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon & PWA -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Weather">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#07060B">
    <meta name="msapplication-config" content="browserconfig.xml">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "What About the Weather? â€” Celestial Shades System",
        "description": "A technical deep dive into building an astronomical shade automation system for agentic home control.",
        "author": {
            "@type": "Person",
            "name": "Tim Jacoby"
        },
        "datePublished": "2026-01-08",
        "keywords": "home automation, ephemeris, astronomy, smart shades, Python"
    }
    </script>
    
    <!-- Google Maps API -->
    <script>
        // Define callback before loading Google Maps
        window.initMap = function() {
            window.googleMapsLoaded = true;
            window.dispatchEvent(new Event('googlemaps-loaded'));
        };
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqS8WpBpEGt4k8V0VCLIlHmYXMm31UIUU&callback=initMap"></script>
</head>
<body class="loading">
    <!-- Skip Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Background -->
    <div class="background-layer gradient-bg" aria-hidden="true"></div>
    <div class="grain-overlay" aria-hidden="true"></div>
    
    <!-- Navigation -->
    <nav class="nav" aria-label="Main navigation">
        <div class="nav-content container">
            <a href="#hero" class="nav-logo">â˜€ï¸ Weather</a>
            <button class="nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <div class="nav-links" id="nav-menu">
                <a href="#ephemeris" class="nav-link" data-i18n="nav.ephemeris">Ephemeris</a>
                <a href="#geometry" class="nav-link" data-i18n="nav.geometry">Geometry</a>
                <a href="#weather" class="nav-link" data-i18n="nav.weather">Weather</a>
                <a href="#triggers" class="nav-link" data-i18n="nav.triggers">Triggers</a>
                <a href="#demo" class="nav-link" data-i18n="nav.demo">Live Demo</a>
                <div id="lang-selector" class="lang-selector"></div>
            </div>
        </div>
    </nav>
    
    <!-- Hero Section -->
    <header class="hero" id="hero">
        <div class="hero-sun" aria-hidden="true"></div>
        
        <!-- Left: Content -->
        <div class="hero-layout">
            <div class="hero-content">
                <div class="hero-eyebrow">
                    <span class="hero-eyebrow-icon">â˜€</span>
                    <span data-i18n="hero.badge">Technical Deep Dive</span>
                </div>

                <h1 class="hero-title">
                    <span class="hero-title-line">What About</span>
                    <span class="hero-title-line hero-title-accent">the <em>Weather?</em></span>
                </h1>

                <p class="hero-lead" data-i18n="hero.subtitle">
                    Astronomical calculations meet window geometry. Weather data creates intelligent shade automation.
                </p>
                
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-value" data-count="11">0</span>
                        <span class="stat-label" data-i18n="stat.shades">Shades</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" data-count="4">0</span>
                        <span class="stat-label" data-i18n="stat.orientations">Orientations</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" data-count="360">0</span>
                        <span class="stat-label" data-i18n="stat.degrees">Degrees</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" data-count="30">0</span>
                        <span class="stat-label" data-i18n="stat.interval">Min Cycle</span>
                    </div>
                </div>
            </div>
            
            <!-- Right: Compass-Sundial -->
            <div class="hero-compass-container">
                <div class="compass-sundial" id="compass-sundial" role="img" aria-label="Interactive compass sundial showing sun position">
                    <!-- Compass base with perspective -->
                    <div class="compass-body">
                        <!-- Outer bezel -->
                        <div class="compass-bezel">
                            <div class="bezel-marking" style="--angle: 0deg"><span>N</span></div>
                            <div class="bezel-marking" style="--angle: 45deg"><span>NE</span></div>
                            <div class="bezel-marking" style="--angle: 90deg"><span>E</span></div>
                            <div class="bezel-marking" style="--angle: 135deg"><span>SE</span></div>
                            <div class="bezel-marking" style="--angle: 180deg"><span>S</span></div>
                            <div class="bezel-marking" style="--angle: 225deg"><span>SW</span></div>
                            <div class="bezel-marking" style="--angle: 270deg"><span>W</span></div>
                            <div class="bezel-marking" style="--angle: 315deg"><span>NW</span></div>
                        </div>
                        
                        <!-- Face with hour lines -->
                        <div class="compass-face">
                            <!-- Hour lines (sundial) -->
                            <svg class="compass-hour-lines" viewBox="0 0 200 200">
                                <circle cx="100" cy="100" r="90" fill="none" stroke="rgba(212,175,55,0.15)" stroke-width="0.5"/>
                                <circle cx="100" cy="100" r="70" fill="none" stroke="rgba(212,175,55,0.1)" stroke-width="0.5"/>
                                <circle cx="100" cy="100" r="50" fill="none" stroke="rgba(212,175,55,0.08)" stroke-width="0.5"/>
                                <!-- Hour markers -->
                                <g class="hour-markers" stroke="rgba(212,175,55,0.3)" stroke-width="1">
                                    <line x1="100" y1="10" x2="100" y2="25"/>
                                    <line x1="100" y1="175" x2="100" y2="190"/>
                                    <line x1="10" y1="100" x2="25" y2="100"/>
                                    <line x1="175" y1="100" x2="190" y2="100"/>
                                </g>
                                <!-- Degree ticks -->
                                <g class="degree-ticks" stroke="rgba(212,175,55,0.15)" stroke-width="0.5">
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(30 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(60 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(120 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(150 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(210 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(240 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(300 100 100)"/>
                                    <line x1="100" y1="12" x2="100" y2="18" transform="rotate(330 100 100)"/>
                                </g>
                            </svg>
                            
                            <!-- Gnomon (central pillar) -->
                            <div class="compass-gnomon"></div>
                            
                            <!-- Shadow cast by gnomon -->
                            <div class="compass-shadow" id="compass-shadow"></div>
                            
                            <!-- Sun position indicator -->
                            <div class="compass-sun" id="compass-sun-indicator">
                                <div class="sun-dot"></div>
                                <div class="sun-glow"></div>
                            </div>
                            
                            <!-- Moon position indicator -->
                            <div class="compass-moon" id="compass-moon-indicator">
                                <div class="moon-dot"></div>
                                <div class="moon-glow"></div>
                            </div>
                        </div>
                        
                        <!-- Glass dome reflection -->
                        <div class="compass-glass"></div>
                    </div>
                    
                    <!-- Base/pedestal -->
                    <div class="compass-pedestal"></div>
                </div>
                
                <p class="compass-hint" id="compass-hint">
                    <span class="compass-hint-icon">ğŸ“±</span>
                    <span>Tap to enable device orientation</span>
                </p>
                
                <!-- Location Map -->
                <div class="compass-map-container">
                    <div class="compass-map" id="location-map"></div>
                    <div class="map-overlay">
                        <span class="map-coords" id="map-coords">47.6815Â° N, 122.3390Â° W</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="scroll-indicator" role="button" tabindex="0" aria-label="Scroll to learn more">
            <span data-i18n="hero.scroll">Explore</span>
            <svg class="scroll-arrow" viewBox="0 0 24 24" width="20" height="20">
                <path d="M12 5v14M5 12l7 7 7-7" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
    </header>
    
    <!-- Main Content -->
    <main id="main-content">
        
        <!-- Section 1: Ephemeris -->
        <section class="section" id="ephemeris">
            <div class="container">
                <header class="section-header" data-reveal>
                    <span class="section-number">01</span>
                    <h2 class="section-title" data-i18n="section.ephemeris.title">The <em>Ephemeris</em></h2>
                    <p class="section-description" data-i18n="section.ephemeris.description">
                        Where is the sun right now? Not from a weather APIâ€”calculated from orbital mechanics.
                    </p>
                </header>
                
                <div class="grid-2">
                    <div data-reveal data-reveal-delay="1">
                        <h3 style="color: var(--gold); margin-bottom: var(--space-3);" data-i18n="section.ephemeris.whyCalculate">Why Calculate?</h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-4);" data-i18n="section.ephemeris.whyCalculateDesc">
                            Weather APIs give you sunrise/sunset timesâ€”but that's not enough. We need the sun's <strong>exact position</strong> (azimuth and altitude) at any moment to know which windows have glare.
                        </p>

                        <div class="callout">
                            <div class="callout-title" data-i18n="callout.problemApis.title">The Problem with APIs</div>
                            <div class="callout-content" data-i18n="callout.problemApis.content">
                                Weather APIs tell you <em>when</em> the sun rises. They don't tell you <em>where</em> it is at 2:47 PM or which direction it's shining. For that, I need to do the math myself. And honestly? It's beautiful math.
                            </div>
                        </div>
                    </div>
                    
                    <div data-reveal data-reveal-delay="2">
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-dot"></span>
                                <span class="code-dot"></span>
                                <span class="code-dot"></span>
                                <span class="code-title">ephemeris.py</span>
                            </div>
                            <div class="code-content">
<pre><code><span class="code-keyword">def</span> <span class="code-function">sun_position</span>(<span class="code-param">lat</span>, <span class="code-param">lon</span>, <span class="code-param">dt</span>=<span class="code-keyword">None</span>):
    <span class="code-string">"""Calculate sun azimuth and altitude."""</span>
    jd = <span class="code-function">julian_date</span>(dt)
    n = jd - <span class="code-number">2451545.0</span>  <span class="code-comment"># Days since J2000</span>
    
    <span class="code-comment"># Solar mean longitude</span>
    L = (<span class="code-number">280.460</span> + <span class="code-number">0.9856474</span> * n) % <span class="code-number">360</span>
    
    <span class="code-comment"># Mean anomaly</span>
    g = (<span class="code-number">357.528</span> + <span class="code-number">0.9856003</span> * n) % <span class="code-number">360</span>
    
    <span class="code-comment"># ... (orbital calculations)</span>
    
    <span class="code-keyword">return</span> SunPosition(
        azimuth=azimuth,   <span class="code-comment"># 0-360Â° from N</span>
        altitude=altitude, <span class="code-comment"># -90Â° to 90Â°</span>
        is_day=altitude > <span class="code-number">0</span>
    )</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="formula" data-reveal data-reveal-delay="3">
                    <div class="formula-title" data-i18n="formula.julian.title">Julian Date Calculation</div>
                    <div class="formula-content">
                        JD = âŒŠ365.25(Y + 4716)âŒ‹ + âŒŠ30.6001(M + 1)âŒ‹ + D + H/24 + B âˆ’ 1524.5
                    </div>
                    <div class="formula-description" data-i18n="formula.julian.description">
                        The foundation of all astronomical calculations. Converts calendar date to continuous day count since 4713 BCE.
                    </div>
                </div>
                
                <div class="grid-3" style="margin-top: var(--space-8);">
                    <div class="card" data-reveal data-reveal-delay="1">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
                            </div>
                            <div>
                                <div class="card-title" data-i18n="card.azimuth.title">Azimuth</div>
                                <div class="card-subtitle" data-i18n="card.azimuth.subtitle">0Â° = North</div>
                            </div>
                        </div>
                        <div class="card-body" data-i18n="card.azimuth.body">
                            The sun's compass bearing. 0Â° is North, 90Â° is East, 180Â° is South, 270Â° is West. Tells us which direction the sun is shining.
                        </div>
                    </div>

                    <div class="card" data-reveal data-reveal-delay="2">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/></svg>
                            </div>
                            <div>
                                <div class="card-title" data-i18n="card.altitude.title">Altitude</div>
                                <div class="card-subtitle" data-i18n="card.altitude.subtitle">0Â° = Horizon</div>
                            </div>
                        </div>
                        <div class="card-body" data-i18n="card.altitude.body">
                            The sun's height above the horizon. 0Â° is sunrise/sunset, 90Â° is directly overhead. Lower sun = longer shadows = more glare through windows.
                        </div>
                    </div>

                    <div class="card" data-reveal data-reveal-delay="3">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                            </div>
                            <div>
                                <div class="card-title" data-i18n="card.isDay.title">Is Day</div>
                                <div class="card-subtitle" data-i18n="card.isDay.subtitle">altitude > 0</div>
                            </div>
                        </div>
                        <div class="card-body" data-i18n="card.isDay.body">
                            Simple booleanâ€”is the sun above the horizon? If not, we don't need to worry about glare. Open all shades for nighttime views.
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Section 2: Window Geometry -->
        <section class="section section-alt" id="geometry">
            <div class="container">
                <header class="section-header" data-reveal>
                    <span class="section-number">02</span>
                    <h2 class="section-title" data-i18n="section.geometry.title">Window <em>Geometry</em></h2>
                    <p class="section-description" data-i18n="section.geometry.description">
                        A house with a view. 11 shades. 4 cardinal orientations. Which windows get sun when?
                    </p>
                </header>
                
                <div class="grid-2">
                    <div data-reveal>
                        <h3 style="color: var(--gold); margin-bottom: var(--space-3);" data-i18n="section.geometry.intensityFunction">The Intensity Function</h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-4);" data-i18n="section.geometry.intensityFunctionDesc">
                            Not all sun exposure is equal. We calculate <strong>glare intensity</strong> based on how directly the sun hits each window and the sun's altitude.
                        </p>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-dot"></span>
                                <span class="code-dot"></span>
                                <span class="code-dot"></span>
                                <span class="code-title">home_geometry.py</span>
                            </div>
                            <div class="code-content">
<pre><code><span class="code-keyword">def</span> <span class="code-function">get_sun_intensity</span>(sun_az, sun_alt, direction):
    <span class="code-string">"""0.0-1.0 glare intensity."""</span>
    <span class="code-keyword">if</span> sun_alt <= <span class="code-number">0</span>: <span class="code-keyword">return</span> <span class="code-number">0.0</span>
    
    window_az = AZIMUTH[direction]
    diff = <span class="code-function">abs</span>(sun_az - window_az)
    <span class="code-keyword">if</span> diff > <span class="code-number">180</span>: diff = <span class="code-number">360</span> - diff
    
    <span class="code-comment"># Sun within 60Â° acceptance angle?</span>
    <span class="code-keyword">if</span> diff > <span class="code-number">60</span>: <span class="code-keyword">return</span> <span class="code-number">0.0</span>
    
    alignment = <span class="code-number">1.0</span> - (diff / <span class="code-number">60.0</span>)
    
    <span class="code-comment"># Lower sun = more glare</span>
    <span class="code-keyword">if</span> sun_alt < <span class="code-number">15</span>:
        altitude_factor = <span class="code-number">1.0</span>
    <span class="code-keyword">elif</span> sun_alt < <span class="code-number">45</span>:
        altitude_factor = <span class="code-number">1.0</span> - ((sun_alt - <span class="code-number">15</span>) / <span class="code-number">45</span>)
    <span class="code-keyword">else</span>:
        altitude_factor = <span class="code-function">max</span>(<span class="code-number">0</span>, <span class="code-number">0.33</span> - ...)
    
    <span class="code-keyword">return</span> alignment * altitude_factor</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div data-reveal data-reveal-delay="1">
                        <h3 style="color: var(--gold); margin-bottom: var(--space-3);" data-i18n="section.geometry.directionConstants">Direction Constants</h3>

                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th scope="col" data-i18n="table.direction">Direction</th>
                                        <th scope="col" data-i18n="label.azimuth">Azimuth</th>
                                        <th scope="col" data-i18n="table.whatFacesIt">What Faces It</th>
                                        <th scope="col" data-i18n="table.sunTimes">Sun Times</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span style="color: var(--south)">â—</span> SOUTH</td>
                                        <td class="mono">180Â°</td>
                                        <td>Living, Dining, Entry</td>
                                        <td>10 AM â€“ 3 PM</td>
                                    </tr>
                                    <tr>
                                        <td><span style="color: var(--east)">â—</span> EAST</td>
                                        <td class="mono">90Â°</td>
                                        <td>Living Room side</td>
                                        <td>6 AM â€“ 11 AM</td>
                                    </tr>
                                    <tr>
                                        <td><span style="color: var(--west)">â—</span> WEST</td>
                                        <td class="mono">270Â°</td>
                                        <td>Primary Bed, Bed 4</td>
                                        <td>3 PM â€“ 8 PM</td>
                                    </tr>
                                    <tr>
                                        <td><span style="color: var(--north)">â—</span> NORTH</td>
                                        <td class="mono">0Â°</td>
                                        <td>Primary Bath</td>
                                        <td>Never direct</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="callout info" style="margin-top: var(--space-4);">
                            <div class="callout-title" data-i18n="callout.northFacing.title">North-Facing = Always Open</div>
                            <div class="callout-content" data-i18n="callout.northFacing.content">
                                At Seattle's latitude (47.7Â°N), north-facing windows never get direct sun. So I leave those shades aloneâ€”let that soft, even light pour in.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Weather Integration -->
        <section class="section" id="weather">
            <div class="container">
                <header class="section-header" data-reveal>
                    <span class="section-number">03</span>
                    <h2 class="section-title" data-i18n="section.weather.title">Weather <em>Integration</em></h2>
                    <p class="section-description" data-i18n="section.weather.description">
                        Celestial calculations assume clear skies. Clouds change everything.
                    </p>
                </header>
                
                <div class="grid-2">
                    <div data-reveal>
                        <h3 style="color: var(--gold); margin-bottom: var(--space-3);" data-i18n="section.weather.overrideLogic">The Override Logic</h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-4);" data-i18n="section.weather.overrideLogicDesc">
                            When it's cloudy or raining, there's no glare to block. Weather data from OpenWeatherMap One Call API 3.0 can override celestial calculations.
                        </p>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-dot"></span>
                                <span class="code-dot"></span>
                                <span class="code-dot"></span>
                                <span class="code-title">device_service.py</span>
                            </div>
                            <div class="code-content">
<pre><code><span class="code-keyword">async def</span> <span class="code-function">optimize_shades_celestial</span>(<span class="code-param">self</span>):
    <span class="code-comment"># Get current weather</span>
    weather = <span class="code-keyword">await</span> <span class="code-param">self</span>._weather.<span class="code-function">get_current</span>()
    
    <span class="code-comment"># Weather override?</span>
    <span class="code-keyword">if</span> weather.cloud_coverage > <span class="code-number">70</span>:
        <span class="code-keyword">return</span> <span class="code-function">open_all_shades</span>()  <span class="code-comment"># No glare</span>
    
    <span class="code-keyword">if</span> weather.condition <span class="code-keyword">in</span> [<span class="code-string">'rain'</span>, <span class="code-string">'thunderstorm'</span>]:
        <span class="code-keyword">return</span> <span class="code-function">open_all_shades</span>()  <span class="code-comment"># Enjoy the rain</span>
    
    <span class="code-comment"># Normal celestial optimization</span>
    sun = <span class="code-function">sun_position</span>(HOME_LAT, HOME_LON)
    <span class="code-keyword">for</span> shade <span class="code-keyword">in</span> SHADES:
        level = <span class="code-function">calculate_shade_level</span>(
            shade, sun.azimuth, sun.altitude, sun.is_day
        )
        <span class="code-keyword">await</span> <span class="code-param">self</span>.<span class="code-function">set_shade</span>(shade.id, level)</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div data-reveal data-reveal-delay="1">
                        <h3 style="color: var(--gold); margin-bottom: var(--space-3);" data-i18n="section.weather.conditions">Weather Conditions</h3>

                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th scope="col" data-i18n="table.condition">Condition</th>
                                        <th scope="col" data-i18n="table.action">Action</th>
                                        <th scope="col" data-i18n="table.why">Why</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>â˜€ï¸ Clear</td>
                                        <td>Celestial optimization</td>
                                        <td>Full sun exposure</td>
                                    </tr>
                                    <tr>
                                        <td>â›… Partly Cloudy</td>
                                        <td>Celestial optimization</td>
                                        <td>Still significant glare</td>
                                    </tr>
                                    <tr>
                                        <td>â˜ï¸ Cloudy (70%+)</td>
                                        <td class="mono" style="color: var(--success)">100% OPEN</td>
                                        <td>Diffused light, no glare</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸŒ§ï¸ Rain</td>
                                        <td class="mono" style="color: var(--success)">100% OPEN</td>
                                        <td>Enjoy watching it rain</td>
                                    </tr>
                                    <tr>
                                        <td>â›ˆï¸ Thunderstorm</td>
                                        <td class="mono" style="color: var(--success)">100% OPEN</td>
                                        <td>Nature's show</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="callout warning" style="margin-top: var(--space-4);">
                            <div class="callout-title" data-i18n="callout.seattle.title">Seattle Reality</div>
                            <div class="callout-content" data-i18n="callout.seattle.content">
                                Seattle averages 226 cloudy days per year. So yesâ€”the weather override isn't an edge case. It's the <em>common</em> case. But those 139 sunny days? They're worth getting right.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Trigger System -->
        <section class="section section-alt" id="triggers">
            <div class="container">
                <header class="section-header" data-reveal>
                    <span class="section-number">04</span>
                    <h2 class="section-title" data-i18n="section.triggers.title">Celestial <em>Triggers</em></h2>
                    <p class="section-description" data-i18n="section.triggers.description">
                        Event-driven automation. The system doesn't pollâ€”it watches for astronomical events.
                    </p>
                </header>
                
                <div class="timeline" data-reveal>
                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <time class="timeline-time" data-i18n="timeline.sunrise.time">Sunrise</time>
                        <h3 class="timeline-title" data-i18n="timeline.sunrise.title">Morning Optimization</h3>
                        <p class="timeline-description" data-i18n="timeline.sunrise.description">
                            East-facing windows get adjusted first. Living Room East (237) may close to 60% as morning sun streams in. Other shades stay open.
                        </p>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <time class="timeline-time" data-i18n="timeline.noon.time">Solar Noon</time>
                        <h3 class="timeline-title" data-i18n="timeline.noon.title">Peak Sun</h3>
                        <p class="timeline-description" data-i18n="timeline.noon.description">
                            South-facing windows see maximum exposure. Living South (235), Dining South (243), Entry (229) adjust based on altitude. High sun = less glare.
                        </p>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <time class="timeline-time" data-i18n="timeline.afternoon.time">Afternoon</time>
                        <h3 class="timeline-title" data-i18n="timeline.afternoon.title">West Exposure</h3>
                        <p class="timeline-description" data-i18n="timeline.afternoon.description">
                            Sun moves west. Primary West (68) and Bed 4 shades (359, 361) begin adjusting. Late afternoon sun is low and intenseâ€”maximum glare potential.
                        </p>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <time class="timeline-time" data-i18n="timeline.dusk.time">Civil Dusk</time>
                        <h3 class="timeline-title" data-i18n="timeline.dusk.title">Evening Opening</h3>
                        <p class="timeline-description" data-i18n="timeline.dusk.description">
                            Sun drops below horizon. All shades open to 100%. Enjoy the evening light. Prepare for sunset views.
                        </p>
                    </div>
                </div>
                
                <div class="callout" style="margin-top: var(--space-8);" data-reveal>
                    <div class="callout-title" data-i18n="callout.cbf.title">CBF Safety: I Respect Your Choices</div>
                    <div class="callout-content" data-i18n="callout.cbf.content">
                        If you close a shade yourself, I won't fight you. The <code>ResidentOverrideCBF</code> (Control Barrier Function) protects your explicit intent for 30 minutes. Your judgment matters more than my algorithm.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Live Demo -->
        <section class="section" id="demo">
            <div class="container">
                <header class="section-header" data-reveal>
                    <span class="section-number">05</span>
                    <h2 class="section-title" data-i18n="section.demo.title">Live <em>Demo</em></h2>
                    <p class="section-description" data-i18n="section.demo.description">
                        Interactive simulation. Drag the time slider to see how shade recommendations change throughout the day.
                    </p>
                </header>
                
                <div class="live-demo" data-reveal>
                    <div class="demo-grid">
                        <div>
                            <div class="control-panel" style="margin-bottom: var(--space-4);">
                                <div class="control-group">
                                    <div class="control-label">
                                        <label for="time-slider" data-i18n="demo.timeOfDay">Time of Day</label>
                                        <output class="control-value" id="time-display" for="time-slider" aria-live="polite">12:00 PM</output>
                                    </div>
                                    <input type="range" class="slider" id="time-slider" min="0" max="24" step="0.25" value="12" aria-describedby="time-display">
                                </div>

                                <div class="control-group">
                                    <div class="control-label">
                                        <span id="weather-label" data-i18n="demo.includeWeather">Include Weather</span>
                                        <span class="control-value">
                                            <label style="display: flex; align-items: center; gap: var(--space-1); cursor: pointer;">
                                                <input type="checkbox" id="weather-toggle" aria-labelledby="weather-label" style="width: 44px; height: 44px; min-width: 44px;">
                                                <span style="font-size: var(--text-sm);" data-i18n="demo.simulateClouds">Simulate clouds</span>
                                            </label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="demo-visualization" id="sun-visualization">
                                <!-- Sun position visualization rendered by JS -->
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: var(--gold); margin-bottom: var(--space-3); font-family: var(--font-mono); font-size: var(--text-sm); text-transform: uppercase; letter-spacing: 0.1em;" id="sun-position-heading" data-i18n="demo.sunPosition">Sun Position</h4>

                            <div class="demo-output" style="margin-bottom: var(--space-4);" role="region" aria-labelledby="sun-position-heading" aria-live="polite" aria-atomic="true">
                                <div class="output-row">
                                    <span class="output-label" id="azimuth-label" data-i18n="label.azimuth">Azimuth</span>
                                    <span class="output-value" id="sun-azimuth" aria-labelledby="azimuth-label">â€”</span>
                                </div>
                                <div class="output-row">
                                    <span class="output-label" id="altitude-label" data-i18n="label.altitude">Altitude</span>
                                    <span class="output-value" id="sun-altitude" aria-labelledby="altitude-label">â€”</span>
                                </div>
                                <div class="output-row">
                                    <span class="output-label" id="direction-label" data-i18n="label.direction">Direction</span>
                                    <span class="output-value" id="sun-direction" aria-labelledby="direction-label">â€”</span>
                                </div>
                                <div class="output-row">
                                    <span class="output-label" id="isday-label" data-i18n="label.isDay">Is Day</span>
                                    <span class="output-value" id="is-day" aria-labelledby="isday-label">â€”</span>
                                </div>
                                <div class="output-row">
                                    <span class="output-label" id="weather-cond-label" data-i18n="label.weather">Weather</span>
                                    <span class="output-value" id="weather-condition" aria-labelledby="weather-cond-label">â€”</span>
                                </div>
                                <div class="output-row">
                                    <span class="output-label" id="cloud-label" data-i18n="label.cloudCoverage">Cloud Coverage</span>
                                    <span class="output-value" id="cloud-coverage" aria-labelledby="cloud-label">â€”</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4 style="color: var(--gold); margin: var(--space-6) 0 var(--space-3); font-family: var(--font-mono); font-size: var(--text-sm); text-transform: uppercase; letter-spacing: 0.1em;" id="shade-recommendations-heading" data-i18n="demo.shadeRecommendations">Shade Recommendations</h4>

                    <div class="table-wrapper" id="shade-table" role="region" aria-labelledby="shade-recommendations-heading" aria-live="polite">
                        <!-- Shade table rendered by JS -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Section 6: Architecture Summary -->
        <section class="section section-alt" id="architecture">
            <div class="container">
                <header class="section-header" data-reveal>
                    <span class="section-number">06</span>
                    <h2 class="section-title" data-i18n="section.architecture.title">The <em>Architecture</em></h2>
                    <p class="section-description" data-i18n="section.architecture.description">
                        How it all fits together. From orbital mechanics to motor commandsâ€”this is where astronomy meets home comfort.
                    </p>
                </header>
                
                <div class="diagram" data-reveal>
                    <div class="diagram-title" data-i18n="diagram.dataFlow">Data Flow</div>
                    <div style="text-align: center; font-family: var(--font-mono); font-size: var(--text-sm); line-height: 2; color: var(--text-secondary);">
<pre style="display: inline-block; text-align: left;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CELESTIAL TRIGGER ENGINE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  <span style="color: var(--gold)">EPHEMERIS</span>   â”‚    â”‚  <span style="color: var(--gold)">HOME GEOM</span>   â”‚    â”‚   <span style="color: var(--gold)">WEATHER</span>   â”‚     â”‚
â”‚   â”‚              â”‚    â”‚              â”‚    â”‚              â”‚     â”‚
â”‚   â”‚ sun_position â”‚â”€â”€â”€â–¶â”‚ get_sun_    â”‚    â”‚ cloud_cover  â”‚     â”‚
â”‚   â”‚ (lat, lon,   â”‚    â”‚ intensity() â”‚â—€â”€â”€â”€â”‚ condition    â”‚     â”‚
â”‚   â”‚  datetime)   â”‚    â”‚              â”‚    â”‚              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                   â”‚              â”‚
â”‚                              â–¼                   â”‚              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚              â”‚
â”‚                    â”‚ <span style="color: var(--gold)">calculate_shade</span> â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                    â”‚    <span style="color: var(--gold)">_level()</span>     â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                  <span style="color: var(--gold)">RESIDENT OVERRIDE CBF</span>                   â”‚ â”‚
â”‚   â”‚            h(x) â‰¥ 0  â†’  Manual overrides protected       â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                               â”‚
â”‚                                 â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                    <span style="color: var(--success)">CONTROL4 / LUTRON</span>                     â”‚ â”‚
â”‚   â”‚              11 Motorized Shades Â· 4 Directions          â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                    </div>
                </div>
                
                <div class="grid-3" style="margin-top: var(--space-6);">
                    <div class="card" data-reveal data-reveal-delay="1">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div>
                                <div class="card-title" data-i18n="card.interval.title">Every 30 Minutes</div>
                                <div class="card-subtitle" data-i18n="card.interval.subtitle">Re-optimization interval</div>
                            </div>
                        </div>
                        <div class="card-body" data-i18n="card.interval.body">
                            The sun moves ~7.5Â° every 30 minutes. That's enough to shift glare from one window orientation to another. Too frequent = motor wear. Too infrequent = stale recommendations.
                        </div>
                    </div>

                    <div class="card" data-reveal data-reveal-delay="2">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                            </div>
                            <div>
                                <div class="card-title" data-i18n="card.cbfProtected.title">CBF Protected</div>
                                <div class="card-subtitle" data-i18n="card.cbfProtected.subtitle">Safety constraint</div>
                            </div>
                        </div>
                        <div class="card-body" data-i18n="card.cbfProtected.body">
                            Control Barrier Functions ensure <code>h(x) â‰¥ 0</code>. If you manually adjust a shade, the system won't override you. Your explicit intent is protected for 30 minutes.
                        </div>
                    </div>

                    <div class="card" data-reveal data-reveal-delay="3">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><path d="M23 6l-9.5 9.5-5-5L1 18"/><path d="M17 6h6v6"/></svg>
                            </div>
                            <div>
                                <div class="card-title" data-i18n="card.portable.title">Portable</div>
                                <div class="card-subtitle" data-i18n="card.portable.subtitle">Location-agnostic</div>
                            </div>
                        </div>
                        <div class="card-body" data-i18n="card.portable.body">
                            Home coordinates come from <code>config/location.yaml</code> or environment variables. Move houses? Just update the config. The algorithms don't change.
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-kanji">â˜€ï¸</div>
            <div class="footer-title" data-i18n="footer.title">What About the Weather?</div>
            <div class="footer-subtitle" data-i18n="footer.subtitle">Where astronomy meets home comfort â€” built with care by Kagami</div>
            
            <nav class="footer-links" aria-label="Footer navigation">
                <a href="https://github.com/awktavian" class="footer-link" target="_blank" rel="noopener noreferrer">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
                    GitHub
                </a>
                <a href="https://twitter.com/awktavian" class="footer-link" target="_blank" rel="noopener noreferrer">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    Twitter
                </a>
                <a href="mailto:timothyjacoby@gmail.com" class="footer-link">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                    Email
                </a>
            </nav>
            
            <div class="footer-meta">
                <span>Tim Jacoby</span> Â· <span>January 2026</span> Â· <span>Part of the Kagami Project</span>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script src="i18n.js"></script>
    <script src="main.js"></script>
</body>
</html>
