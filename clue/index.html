<!DOCTYPE html>
<html lang="en" data-Èè°="mansion" data-theme="clue" data-ending="none">
<!--
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    üèõÔ∏è THE HOUSE ‚Äî A Clue-Themed Architectural Tour of Kagami
    
    "Ladies and gentlemen, you all have one thing in common... you're all lines of code."
    ‚Äî Wadsworth
    
    FOR JILL ‚Äî Product Manager Extraordinaire
    
    This is how the Kagami codebase is actually structured.
    Your favorite movie, mapping the architecture you help shape.
    
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a0f0f">
    <title>üèõÔ∏è THE HOUSE ‚Äî A Clue-Themed Architectural Mystery | Èè° Kagami</title>
    <meta name="description" content="A murder mystery dinner party exploring the living architecture of Kagami.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèõÔ∏è</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <div class="loading-content">
            <div class="loading-icon">üèõÔ∏è</div>
            <div class="loading-quote">"I'm the butler. I buttle."</div>
            <div class="loading-bar"><div class="loading-progress" id="loading-progress"></div></div>
            <div class="loading-text">Preparing the mansion...</div>
        </div>
    </div>

    <!-- Canvas Layers -->
    <canvas id="candlelight-canvas"></canvas>
    <canvas id="dust-canvas"></canvas>
    <canvas id="passage-canvas"></canvas>

    <!-- Atmospheric Layers -->
    <div class="atmosphere">
        <div class="fog fog-1"></div>
        <div class="fog fog-2"></div>
        <div class="vignette"></div>
    </div>

    <!-- Custom Cursor -->
    <div id="cursor">
        <div class="cursor-dot"></div>
        <div class="cursor-ring"></div>
    </div>

    <!-- Main Content -->
    <div class="mansion">
        <!-- Header -->
        <header class="mansion-header">
            <div class="header-decoration">‚úß ‚ú¶ ‚úß</div>
            <h1 class="mansion-title">THE HOUSE</h1>
            <p class="mansion-subtitle">A Murder Mystery Dinner Party</p>
            <p class="mansion-tagline">"Ladies and gentlemen, you all have one thing in common..."</p>
        </header>

        <!-- For Jill -->
        <section class="dedication">
            <div class="dedication-frame">
                <p class="dedication-to">For Jill</p>
                <p class="dedication-role">Product Manager ¬∑ Architectural Advisor ¬∑ Clue Connoisseur</p>
                <p class="dedication-note">This is how Kagami works‚Äînot as documentation, but as experience.</p>
            </div>
        </section>

        <!-- The Mansion Tour -->
        <section class="investigation" id="investigation">
            <h2 class="section-title">The Mansion</h2>
            <p class="section-intro">
                401,000 lines of Python. 2,557 files. One interconnected system.<br>
                Each room of this mansion is a different part of the codebase.
            </p>
            
            <!-- Architecture Overview -->
            <div class="architecture-grid">
                <!-- API Layer -->
                <div class="arch-card" data-room="api">
                    <div class="arch-icon">üö™</div>
                    <h3>The Front Door</h3>
                    <p class="arch-path">kagami/api/</p>
                    <p class="arch-desc">REST API & WebSocket endpoints. FastAPI routes, middleware, authentication. Where the outside world enters.</p>
                    <div class="arch-files">
                        <code>routes/</code> <code>middleware/</code> <code>socketio/</code>
                    </div>
                </div>
                
                <!-- Core Brain -->
                <div class="arch-card" data-room="core">
                    <div class="arch-icon">üß†</div>
                    <h3>The Study</h3>
                    <p class="arch-path">kagami/core/</p>
                    <p class="arch-desc">The brain. Orchestration, coordination, execution. Where decisions are made and work is routed.</p>
                    <div class="arch-files">
                        <code>orchestrator/</code> <code>coordination/</code> <code>execution/</code>
                    </div>
                </div>
                
                <!-- Services -->
                <div class="arch-card" data-room="services">
                    <div class="arch-icon">‚öôÔ∏è</div>
                    <h3>The Kitchen</h3>
                    <p class="arch-path">kagami/core/services/</p>
                    <p class="arch-desc">Where the real work happens. LLM clients, embeddings, storage, MCP connections. The staff quarters.</p>
                    <div class="arch-files">
                        <code>llm/</code> <code>embedding_service.py</code> <code>mcp/</code>
                    </div>
                </div>
                
                <!-- World Model -->
                <div class="arch-card" data-room="world">
                    <div class="arch-icon">üîÆ</div>
                    <h3>The Attic</h3>
                    <p class="arch-path">kagami/core/world_model/</p>
                    <p class="arch-desc">Prediction engine. RSSM-based world simulation. Doesn't just react‚Äîit predicts what's coming.</p>
                    <div class="arch-files">
                        <code>equivariance/</code> <code>layers/</code> <code>memory/</code>
                    </div>
                </div>
                
                <!-- Safety -->
                <div class="arch-card arch-card-danger" data-room="safety">
                    <div class="arch-icon">üõ°Ô∏è</div>
                    <h3>The Walls</h3>
                    <p class="arch-path">kagami/core/safety/</p>
                    <p class="arch-desc">Control Barrier Functions. <strong>h(x) ‚â• 0. ALWAYS.</strong> The walls that keep danger out.</p>
                    <div class="arch-files">
                        <code>optimal_cbf.py</code> <code>barriers/</code>
                    </div>
                </div>
                
                <!-- Math -->
                <div class="arch-card" data-room="math">
                    <div class="arch-icon">üìê</div>
                    <h3>The Basement</h3>
                    <p class="arch-path">kagami/math/</p>
                    <p class="arch-desc">Mathematical foundations. E8 lattice quantization, Fano plane routing, octonion algebra.</p>
                    <div class="arch-files">
                        <code>e8_lattice_quantizer.py</code> <code>fano_plane.py</code> <code>octonions/</code>
                    </div>
                </div>
                
                <!-- Memory -->
                <div class="arch-card" data-room="memory">
                    <div class="arch-icon">üíæ</div>
                    <h3>The Library</h3>
                    <p class="arch-path">kagami/core/memory/</p>
                    <p class="arch-desc">Episodic and semantic memory. Vector stores, retrieval, the system's long-term knowledge.</p>
                    <div class="arch-files">
                        <code>episodic/</code> <code>semantic/</code> <code>retrieval/</code>
                    </div>
                </div>
                
                <!-- Database -->
                <div class="arch-card" data-room="database">
                    <div class="arch-icon">üóÑÔ∏è</div>
                    <h3>The Cellar</h3>
                    <p class="arch-path">kagami/core/database/</p>
                    <p class="arch-desc">PostgreSQL connections, migrations, models. Where everything is stored permanently.</p>
                    <div class="arch-files">
                        <code>connection.py</code> <code>models/</code>
                    </div>
                </div>
            </div>
            
            <!-- The Suspects: Key Components -->
            <div class="suspects-compact">
                <h3 class="subsection-title">The Suspects</h3>
                <p class="subsection-intro">The key players in every request:</p>
                
                <div class="suspect-row">
                    <div class="suspect-mini" data-character="scarlet">
                        <span class="suspect-icon">üî•</span>
                        <span class="suspect-name">Miss Scarlet</span>
                        <span class="suspect-role">Intent Parser</span>
                    </div>
                    <div class="suspect-mini" data-character="mustard">
                        <span class="suspect-icon">‚öíÔ∏è</span>
                        <span class="suspect-name">Col. Mustard</span>
                        <span class="suspect-role">Task Executor</span>
                    </div>
                    <div class="suspect-mini" data-character="white">
                        <span class="suspect-icon">üåä</span>
                        <span class="suspect-name">Mrs. White</span>
                        <span class="suspect-role">Error Handler</span>
                    </div>
                    <div class="suspect-mini" data-character="green">
                        <span class="suspect-icon">üîó</span>
                        <span class="suspect-name">Mr. Green</span>
                        <span class="suspect-role">Memory Manager</span>
                    </div>
                </div>
                <div class="suspect-row">
                    <div class="suspect-mini" data-character="plum">
                        <span class="suspect-icon">üóº</span>
                        <span class="suspect-name">Prof. Plum</span>
                        <span class="suspect-role">Route Planner</span>
                    </div>
                    <div class="suspect-mini" data-character="peacock">
                        <span class="suspect-icon">üíé</span>
                        <span class="suspect-name">Mrs. Peacock</span>
                        <span class="suspect-role">Validator</span>
                    </div>
                    <div class="suspect-mini" data-character="motorist">
                        <span class="suspect-icon">üåø</span>
                        <span class="suspect-name">The Motorist</span>
                        <span class="suspect-role">Retriever</span>
                    </div>
                    <div class="suspect-mini character-wadsworth" data-character="wadsworth">
                        <span class="suspect-icon">üèõÔ∏è</span>
                        <span class="suspect-name">Wadsworth</span>
                        <span class="suspect-role">Orchestrator</span>
                    </div>
                </div>
            </div>
            
            <!-- Secret Passages: Module Dependencies -->
            <div class="passages-compact">
                <h3 class="subsection-title">Secret Passages</h3>
                <p class="subsection-intro">How modules connect:</p>
                
                <div class="passage-grid">
                    <div class="passage-mini">
                        <span class="passage-from">API</span>
                        <span class="passage-arrow">‚Üí</span>
                        <span class="passage-to">Orchestrator</span>
                        <span class="passage-arrow">‚Üí</span>
                        <span class="passage-to">Services</span>
                    </div>
                    <div class="passage-mini">
                        <span class="passage-from">World Model</span>
                        <span class="passage-arrow">‚Üí</span>
                        <span class="passage-to">Safety</span>
                        <span class="passage-arrow">‚Üí</span>
                        <span class="passage-to">Execution</span>
                    </div>
                    <div class="passage-mini">
                        <span class="passage-from">Memory</span>
                        <span class="passage-arrow">‚Üî</span>
                        <span class="passage-to">Database</span>
                        <span class="passage-arrow">‚Üî</span>
                        <span class="passage-to">Cache</span>
                    </div>
                    <div class="passage-mini">
                        <span class="passage-from">Math</span>
                        <span class="passage-arrow">‚Üí</span>
                        <span class="passage-to">Quantization</span>
                        <span class="passage-arrow">‚Üí</span>
                        <span class="passage-to">Embeddings</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Request Lifecycle -->
        <section class="lifecycle" id="lifecycle">
            <h2 class="section-title">The Murder</h2>
            <p class="section-subtitle">"One plus one plus two plus one..."</p>
            <p class="section-intro">
                What happens when a request enters the mansion?<br>
                Follow the body through the house.
            </p>
            
            <div class="lifecycle-flow">
                <div class="lifecycle-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>The Doorbell</h4>
                        <code>api/routes/</code>
                        <p>Request arrives via REST or WebSocket</p>
                    </div>
                </div>
                <div class="lifecycle-arrow">‚Üì</div>
                
                <div class="lifecycle-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>The Butler Answers</h4>
                        <code>orchestrator/process_intent_v2.py</code>
                        <p>Wadsworth parses intent, plans execution</p>
                    </div>
                </div>
                <div class="lifecycle-arrow">‚Üì</div>
                
                <div class="lifecycle-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Safety Check</h4>
                        <code>safety/optimal_cbf.py</code>
                        <p>Is h(x) ‚â• 0? Can we proceed?</p>
                    </div>
                </div>
                <div class="lifecycle-arrow">‚Üì</div>
                
                <div class="lifecycle-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>The Kitchen</h4>
                        <code>services/llm/service.py</code>
                        <p>LLM generates response, tools execute</p>
                    </div>
                </div>
                <div class="lifecycle-arrow">‚Üì</div>
                
                <div class="lifecycle-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>The Response</h4>
                        <code>api/socketio/broadcaster.py</code>
                        <p>Stream back to client</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- The Walls (Safety) -->
        <section class="walls" id="walls">
            <h2 class="section-title">The Walls</h2>
            <p class="section-subtitle">"h(x) ‚â• 0. ALWAYS."</p>
            
            <div class="safety-hero">
                <div class="safety-formula">h(x) ‚â• 0</div>
                <p class="safety-explain">The safety barrier must never be violated</p>
            </div>
            
            <div class="safety-zones">
                <div class="safety-zone safe">
                    <div class="zone-indicator">h(x) > 0.5</div>
                    <div class="zone-status">üü¢ Safe</div>
                    <p>Proceed normally</p>
                </div>
                <div class="safety-zone caution">
                    <div class="zone-indicator">0 ‚â§ h(x) ‚â§ 0.5</div>
                    <div class="zone-status">üü° Verify</div>
                    <p>Extra validation required</p>
                </div>
                <div class="safety-zone danger">
                    <div class="zone-indicator">h(x) < 0</div>
                    <div class="zone-status">üî¥ STOP</div>
                    <p>Operation blocked</p>
                </div>
            </div>
            
            <blockquote class="safety-quote">
                "The safety invariant is INVIOLABLE."<br>
                <span class="quote-attr">‚Äî Like Mrs. Peacock's sense of propriety</span>
            </blockquote>
        </section>

        <!-- The Endings -->
        <section class="endings" id="endings">
            <h2 class="section-title">The Endings</h2>
            <p class="section-intro">
                Just like the movie had three endings, there are three ways to understand this architecture.
            </p>
            
            <div class="ending-buttons">
                <button class="ending-btn" data-ending="A">
                    <span class="ending-letter">A</span>
                    <span class="ending-title">The Data Flow</span>
                    <span class="ending-quote">"That's how it could have happened."</span>
                </button>
                <button class="ending-btn" data-ending="B">
                    <span class="ending-letter">B</span>
                    <span class="ending-title">The Safety View</span>
                    <span class="ending-quote">"But here's what really happened..."</span>
                </button>
                <button class="ending-btn" data-ending="C">
                    <span class="ending-letter">C</span>
                    <span class="ending-title">The Full Picture</span>
                    <span class="ending-quote">"But here's what REALLY happened."</span>
                </button>
            </div>
            
            <div class="ending-content" id="ending-content">
                <p class="ending-placeholder">Click an ending to reveal...</p>
            </div>
        </section>

        <!-- The Reveal -->
        <section class="reveal" id="reveal">
            <h2 class="section-title">The Reveal</h2>
            
            <div class="wadsworth-speech">
                <div class="speech-icon">üèõÔ∏è</div>
                <blockquote class="speech-quote">
                    "Let me explain... No, there is too much. Let me sum up."
                </blockquote>
            </div>
            
            <div class="evidence-board">
                <div class="evidence-item">
                    <span class="evidence-value" data-count="401000">0</span>
                    <span class="evidence-label">Lines of Code</span>
                </div>
                <div class="evidence-item">
                    <span class="evidence-value" data-count="2557">0</span>
                    <span class="evidence-label">Python Files</span>
                </div>
                <div class="evidence-item">
                    <span class="evidence-value" data-count="870">0</span>
                    <span class="evidence-label">Commits</span>
                </div>
                <div class="evidence-item">
                    <span class="evidence-value" data-count="7">0</span>
                    <span class="evidence-label">Satellites</span>
                </div>
                <div class="evidence-item">
                    <span class="evidence-value" data-count="45">0</span>
                    <span class="evidence-label">API Routes</span>
                </div>
                <div class="evidence-item">
                    <span class="evidence-value" data-count="3">0</span>
                    <span class="evidence-label">Safety Tiers</span>
                </div>
            </div>
            
            <div class="final-equation">
                <p class="equation-setup">One plus one plus two plus one...</p>
                <div class="equation-result">
                    <span class="eq-term">üö™</span>
                    <span class="eq-term">+</span>
                    <span class="eq-term">üß†</span>
                    <span class="eq-term">+</span>
                    <span class="eq-term">‚öôÔ∏è</span>
                    <span class="eq-term">+</span>
                    <span class="eq-term">üõ°Ô∏è</span>
                    <span class="eq-term">+</span>
                    <span class="eq-term">üíæ</span>
                    <span class="eq-term">=</span>
                    <span class="eq-sum">üèõÔ∏è</span>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="mansion-footer">
            <div class="footer-divider"></div>
            <blockquote class="footer-quote">
                "They all did it. But if you want to know who killed Mr. Body,<br>
                I did. In the Hall. With the architecture."
            </blockquote>
            <div class="footer-logo">
                <span class="logo-kanji">Èè°</span>
                <span class="logo-text">Kagami</span>
            </div>
            <p class="footer-meta">December 2025 ¬∑ Visit #<span id="visit-count">1</span></p>
            <p class="footer-wadsworth">"I'm the butler. I buttle."</p>
        </footer>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">√ó</button>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script src="characters.js"></script>
    <script src="mansion.js"></script>
</body>
</html>
