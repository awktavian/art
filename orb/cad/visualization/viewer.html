<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kagami Orb V3.1 ‚Äî Assembly Viewer</title>
    <style>
        :root {
            --bg: #0d0d12;
            --surface: #16161d;
            --border: rgba(255,255,255,0.08);
            --accent: #a855f7;
            --text: #e8e8ed;
            --dim: #6b6b76;
            --ok: #22c55e;
            --warn: #eab308;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg); 
            color: var(--text); 
            overflow: hidden;
        }
        #c { width:100vw; height:100vh; display:block; }
        
        /* UI Overlays */
        .ui { position:fixed; z-index:10; }
        
        #hdr {
            top:0; left:0; right:0; height:44px;
            background: rgba(13,13,18,0.92);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
        }
        .logo { display:flex; align-items:center; gap:8px; font-weight:600; font-size:13px; }
        .logo span { 
            background: linear-gradient(135deg, var(--accent), #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .badge { font-size:9px; padding:2px 5px; border-radius:3px; background:var(--ok); color:#000; font-weight:600; }
        
        .btns { display:flex; gap:3px; }
        .btn {
            padding: 6px 10px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--dim);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn:hover { background: #1e1e26; color: var(--text); }
        .btn.on { background: var(--accent); color: #fff; border-color: var(--accent); }
        
        #tree {
            top: 56px; left: 8px; bottom: 8px; width: 200px;
            background: rgba(22,22,29,0.92);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow-y: auto;
            font-size: 11px;
        }
        .grp { padding:6px 10px; font-size:9px; color:var(--accent); font-weight:600; text-transform:uppercase; letter-spacing:0.5px; }
        .part {
            padding: 5px 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            border-left: 2px solid transparent;
        }
        .part:hover { background: rgba(255,255,255,0.03); }
        .part.sel { background: rgba(168,85,247,0.15); border-left-color: var(--accent); }
        .part .n { flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .part .d { font-size:9px; color:var(--dim); font-family:monospace; }
        
        #info {
            top: 56px; right: 8px; width: 220px;
            background: rgba(22,22,29,0.92);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-size: 11px;
        }
        #info h3 { font-size:12px; margin-bottom:10px; color:var(--accent); }
        .row { display:flex; justify-content:space-between; padding:3px 0; }
        .row .l { color:var(--dim); }
        .row .v { font-family:monospace; }
        .row .v.ok { color:var(--ok); }
        .row .v.warn { color:var(--warn); }
        
        #stats {
            bottom: 8px; right: 8px;
            background: rgba(22,22,29,0.92);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 10px;
        }
        #stats .row { padding: 2px 0; }
        
        #ctrl {
            bottom: 8px; left: 50%; transform: translateX(-50%);
            background: rgba(22,22,29,0.92);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            display: none;
            gap: 8px;
            align-items: center;
            font-size: 11px;
        }
        #ctrl.show { display:flex; }
        #ctrl select, #ctrl input { 
            background: var(--surface); 
            border: 1px solid var(--border); 
            color: var(--text);
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 10px;
        }
        #ctrl input[type=range] { width:120px; accent-color:var(--accent); }
        
        #help {
            position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:100;
            display:none; place-items:center;
        }
        #help.show { display:grid; }
        #help > div {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            max-width: 400px;
            font-size: 12px;
        }
        #help h2 { font-size:14px; margin-bottom:12px; }
        #help .k { display:flex; justify-content:space-between; padding:3px 0; }
        #help kbd { background:var(--bg); padding:2px 6px; border-radius:3px; font-family:monospace; font-size:10px; }
    </style>
</head>
<body>
<canvas id="c"></canvas>

<div id="hdr" class="ui">
    <div class="logo">üîÆ <span>Kagami Orb V3.1</span> <div class="badge">VERIFIED</div></div>
    <div class="btns">
        <button class="btn" id="bHome" title="Home (H)">‚åÇ</button>
        <button class="btn" id="bExpl" title="Explode (E)">üí•</button>
        <button class="btn" id="bSect" title="Section (S)">‚úÇ</button>
        <button class="btn" id="bXray" title="X-Ray (X)">‚óê</button>
        <button class="btn" id="bHeat" title="Thermal (T)">üå°</button>
        <button class="btn" id="bHelp" title="Help (?)">?</button>
    </div>
</div>

<div id="tree" class="ui"></div>

<div id="info" class="ui">
    <h3>Select Component</h3>
    <div id="props"></div>
</div>

<div id="stats" class="ui">
    <div class="row"><span class="l">Parts</span><span class="v" id="sParts">0</span></div>
    <div class="row"><span class="l">Mass</span><span class="v" id="sMass">0g</span></div>
    <div class="row"><span class="l">Fit</span><span class="v ok" id="sFit">‚úì</span></div>
</div>

<div id="ctrl" class="ui">
    <select id="sAxis"><option value="y">Y</option><option value="x">X</option><option value="z">Z</option></select>
    <input type="range" id="sPos" min="-42" max="42" value="0">
    <span id="sVal">0mm</span>
</div>

<div id="help">
    <div>
        <h2>üîÆ Kagami Orb Viewer</h2>
        <p style="color:var(--dim);margin-bottom:12px">85mm sealed sphere with verified component dimensions.</p>
        <div class="k"><span>Orbit</span><kbd>Drag</kbd></div>
        <div class="k"><span>Zoom</span><kbd>Scroll</kbd></div>
        <div class="k"><span>Home</span><kbd>H</kbd></div>
        <div class="k"><span>Explode</span><kbd>E</kbd></div>
        <div class="k"><span>Section</span><kbd>S</kbd></div>
        <div class="k"><span>X-Ray</span><kbd>X</kbd></div>
        <div class="k"><span>Thermal</span><kbd>T</kbd></div>
        <button class="btn" onclick="document.getElementById('help').classList.remove('show')" style="width:100%;margin-top:12px">Close</button>
    </div>
</div>

<script type="importmap">{"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js","three/addons/":"https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"}}</script>
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

// ================================================================
// OPTIMAL ASSEMBLY LAYOUT
// 85mm sphere, 70mm internal, components stacked vertically
// Positions calculated from verified dimensions
// ================================================================

const R_OUT = 42.5;  // Outer radius
const R_IN = 35;     // Internal radius (70mm diameter)
const SHELL = 7.5;   // Shell thickness

// Vertical stack from top to bottom (Y coordinates in mm)
// Each component positioned to minimize interference and optimize thermal/electrical paths
const ASSEMBLY = [
    // === SHELL (2 hemispheres) ===
    { id:'shell_top', name:'Shell Top', grp:'Shell', geo:'hemi_top', r:R_OUT, y:0, clr:0x88ccff, op:0.2, mass:45, W:0, src:'Design' },
    { id:'shell_bot', name:'Shell Bottom', grp:'Shell', geo:'hemi_bot', r:R_OUT, y:0, clr:0x88ccff, op:0.2, mass:45, W:0, src:'Design' },
    
    // === DISPLAY STACK (Top) ===
    // Display at top, camera behind it, mount below
    { id:'display', name:'1.39" AMOLED', grp:'Display', geo:'box', w:38.21, d:38.83, h:0.68, y:30, clr:0x1a1a28, mass:8, W:0.8, src:'King Tech' },
    { id:'camera', name:'IMX989 Camera', grp:'Display', geo:'box', w:26, d:26, h:9.4, y:24, clr:0x222233, mass:15, W:0.5, src:'SincereFirst 26√ó26√ó9.4mm' },
    { id:'disp_mnt', name:'Display Mount', grp:'Display', geo:'cyl', r:22, h:8, y:18, clr:0x505050, mass:10, W:0, src:'Grey Pro SLA' },
    
    // === COMPUTE STACK (Center-Upper) ===
    // Main PCB with SoM and M.2 slot
    { id:'main_pcb', name:'Main PCB', grp:'Compute', geo:'disc', r:30, h:1.6, y:10, clr:0x1a5c1a, mass:15, W:0, src:'4-layer FR4 60mm round' },
    { id:'som', name:'QCS6490 SoM', grp:'Compute', geo:'box', w:42.5, d:35.5, h:5, y:13, clr:0x228822, mass:25, W:8, src:'Thundercomm 42.5√ó35.5√ó2.7mm + standoff' },
    { id:'hailo', name:'Hailo-10H', grp:'Compute', geo:'box', w:42, d:22, h:3, y:8, clr:0x116611, mass:8, W:2.5, src:'M.2 2242 42√ó22mm' },
    { id:'heatsink', name:'Heatsink', grp:'Compute', geo:'box', w:20, d:20, h:6, y:17, clr:0x333333, mass:8, W:0, src:'Aluminum 20√ó20√ó6mm on SoM' },
    
    // === LED RING (Equator) ===
    { id:'led_pcb', name:'LED Ring PCB', grp:'LEDs', geo:'ring', ro:28, ri:22, h:1.6, y:0, clr:0x1a3d1a, mass:5, W:0, src:'Flex PCB ring' },
    { id:'leds', name:'HD108 √ó16', grp:'LEDs', geo:'leds', n:16, r:25, y:0, clr:0xff00ff, mass:1, W:0.8, src:'5.1√ó5.0√ó1.6mm each' },
    { id:'diffuser', name:'Diffuser', grp:'LEDs', geo:'ring', ro:30, ri:20, h:3, y:1, clr:0xffffff, op:0.7, mass:4, W:0, src:'Frosted acrylic ring' },
    
    // === AUDIO (Center) ===
    { id:'mics', name:'sensiBel √ó4', grp:'Audio', geo:'mics', r:28, y:5, clr:0x444444, mass:0.5, W:0.006, src:'6√ó3.8√ó2.47mm optical MEMS' },
    { id:'speaker', name:'Speaker 28mm', grp:'Audio', geo:'cyl', r:14, h:5.4, y:-8, clr:0x282828, mass:5, W:0, src:'Yueda 28mm' },
    
    // === POWER (Bottom) ===
    { id:'battery', name:'Battery 2200mAh', grp:'Power', geo:'box', w:55, d:35, h:20, y:-20, clr:0x0055bb, mass:150, W:0.3, src:'3S LiPo 55√ó35√ó20mm = 24Wh' },
    { id:'bms', name:'BMS + Charger', grp:'Power', geo:'box', w:30, d:20, h:4, y:-10, clr:0x117711, mass:8, W:0.5, src:'BQ25895+BQ40Z50 on PCB' },
    { id:'coil_mnt', name:'Coil Mount', grp:'Power', geo:'disc', r:33, h:4, y:-32, clr:0x404040, mass:8, W:0, src:'Tough 2000 SLA' },
    { id:'rx_coil', name:'RX Coil', grp:'Power', geo:'torus', R:27, r:4, y:-34, clr:0xb87333, mass:18, W:3, src:'70mm Litz 18 turns' },
    { id:'ferrite', name:'Ferrite', grp:'Power', geo:'disc', r:28, h:0.5, y:-36, clr:0x222222, mass:12, W:0, src:'Mn-Zn 60mm disc' },
    
    // === BASE (Below sphere, 15mm gap) ===
    { id:'tx_coil', name:'TX Coil', grp:'Base', geo:'torus', R:27, r:4, y:-55, clr:0xb87333, mass:15, W:4, src:'70mm Litz 14 turns', base:1 },
    { id:'maglev', name:'HCNT Maglev', grp:'Base', geo:'box', w:80, d:80, h:15, y:-62, clr:0x334455, mass:700, W:2, src:'100√ó100√ó20mm module', base:1 },
    { id:'base_pcb', name:'Base PCB', grp:'Base', geo:'disc', r:35, h:1.6, y:-52, clr:0x1a4a1a, mass:10, W:0.5, src:'ESP32-S3 + drivers', base:1 },
    { id:'base_leds', name:'Base LEDs', grp:'Base', geo:'leds', n:8, r:32, y:-50, clr:0x00ff88, mass:0.5, W:0.1, src:'SK6812 ring', base:1 },
    { id:'base_enc', name:'Walnut Base', grp:'Base', geo:'cyl', r:70, h:20, y:-72, clr:0x5d4037, mass:350, W:0, src:'CNC walnut 140mm', base:1 },
];

// ================================================================
// THREE.JS SETUP
// ================================================================
let scene, camera, renderer, controls, clip;
const parts = new Map();
let exploded = false, sectioning = false, xray = false, thermal = false;
let selected = null;

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0d0d12);
    
    camera = new THREE.PerspectiveCamera(40, innerWidth/innerHeight, 1, 500);
    camera.position.set(80, 50, 80);
    
    renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('c'), antialias: true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.localClippingEnabled = true;
    
    clip = new THREE.Plane(new THREE.Vector3(0,-1,0), 0);
    
    controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.target.set(0, 0, 0);
    
    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    const key = new THREE.DirectionalLight(0xffffff, 0.7);
    key.position.set(40, 60, 40);
    scene.add(key);
    scene.add(new THREE.DirectionalLight(0x8888ff, 0.3).translateX(-30).translateY(30).translateZ(-30));
    
    // Grid
    const grid = new THREE.GridHelper(150, 15, 0x333333, 0x222222);
    grid.position.y = -82;
    scene.add(grid);
    
    // Build
    buildParts();
    buildTree();
    updateStats();
    
    // Events
    addEventListener('resize', () => {
        camera.aspect = innerWidth/innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(innerWidth, innerHeight);
    });
    addEventListener('keydown', onKey);
    renderer.domElement.addEventListener('click', onClick);
    
    document.getElementById('bHome').onclick = () => { camera.position.set(80,50,80); controls.target.set(0,0,0); };
    document.getElementById('bExpl').onclick = toggleExplode;
    document.getElementById('bSect').onclick = toggleSection;
    document.getElementById('bXray').onclick = toggleXray;
    document.getElementById('bHeat').onclick = toggleThermal;
    document.getElementById('bHelp').onclick = () => document.getElementById('help').classList.toggle('show');
    document.getElementById('sAxis').onchange = updateClip;
    document.getElementById('sPos').oninput = updateClip;
    
    renderer.setAnimationLoop(() => { controls.update(); renderer.render(scene, camera); });
}

function geo(c) {
    switch(c.geo) {
        case 'hemi_top': return new THREE.SphereGeometry(c.r, 48, 24, 0, Math.PI*2, 0, Math.PI/2);
        case 'hemi_bot': return new THREE.SphereGeometry(c.r, 48, 24, 0, Math.PI*2, Math.PI/2, Math.PI/2);
        case 'box': return new THREE.BoxGeometry(c.w, c.h, c.d);
        case 'cyl': return new THREE.CylinderGeometry(c.r, c.r, c.h, 32);
        case 'disc': return new THREE.CylinderGeometry(c.r, c.r, c.h, 32);
        case 'ring': {
            const s = new THREE.Shape();
            s.absarc(0,0,c.ro,0,Math.PI*2);
            const hole = new THREE.Path();
            hole.absarc(0,0,c.ri,0,Math.PI*2);
            s.holes.push(hole);
            return new THREE.ExtrudeGeometry(s, {depth:c.h, bevelEnabled:false});
        }
        case 'torus': return new THREE.TorusGeometry(c.R, c.r, 12, 48);
        case 'leds': return null;
        case 'mics': return null;
    }
}

function buildParts() {
    ASSEMBLY.forEach(c => {
        let mesh;
        const g = geo(c);
        
        if (c.geo === 'leds') {
            mesh = new THREE.Group();
            for (let i=0; i<c.n; i++) {
                const a = (i/c.n)*Math.PI*2;
                const led = new THREE.Mesh(
                    new THREE.BoxGeometry(4,1.5,4),
                    new THREE.MeshStandardMaterial({color:c.clr, emissive:c.clr, emissiveIntensity:0.4})
                );
                led.position.set(Math.cos(a)*c.r, 0, Math.sin(a)*c.r);
                mesh.add(led);
            }
        } else if (c.geo === 'mics') {
            mesh = new THREE.Group();
            [[1,0],[-1,0],[0,1],[0,-1]].forEach(([x,z]) => {
                const mic = new THREE.Mesh(
                    new THREE.BoxGeometry(6,2.5,3.8),
                    new THREE.MeshStandardMaterial({color:c.clr})
                );
                mic.position.set(x*c.r, 0, z*c.r);
                mesh.add(mic);
            });
        } else if (g) {
            mesh = new THREE.Mesh(g, new THREE.MeshStandardMaterial({
                color: c.clr,
                metalness: 0.15,
                roughness: 0.75,
                transparent: c.op !== undefined,
                opacity: c.op ?? 1,
                side: c.op ? THREE.DoubleSide : THREE.FrontSide
            }));
        }
        
        if (mesh) {
            mesh.position.y = c.y;
            if (c.geo === 'ring') mesh.rotation.x = -Math.PI/2;
            mesh.userData = { c, origY: c.y };
            scene.add(mesh);
            parts.set(c.id, mesh);
        }
    });
}

function buildTree() {
    const tree = document.getElementById('tree');
    const grps = {};
    ASSEMBLY.forEach(c => { if (!grps[c.grp]) grps[c.grp]=[]; grps[c.grp].push(c); });
    
    Object.keys(grps).forEach(g => {
        tree.innerHTML += `<div class="grp">${g}</div>`;
        grps[g].forEach(c => {
            const dims = c.w ? `${c.w}√ó${c.d}` : (c.r ? `√ò${c.r*2}` : (c.ro ? `√ò${c.ro*2}` : ''));
            tree.innerHTML += `<div class="part" data-id="${c.id}"><span class="n">${c.name}</span><span class="d">${dims}</span></div>`;
        });
    });
    
    tree.querySelectorAll('.part').forEach(el => el.onclick = () => select(el.dataset.id));
}

function updateStats() {
    const orb = ASSEMBLY.filter(c => !c.base);
    document.getElementById('sParts').textContent = orb.length;
    document.getElementById('sMass').textContent = orb.reduce((s,c) => s + c.mass, 0) + 'g';
    
    let maxW = 0;
    orb.forEach(c => { const w = c.w || (c.r||c.ro||0)*2; if (w > maxW) maxW = w; });
    const fits = maxW < 65;
    document.getElementById('sFit').textContent = fits ? `‚úì ${maxW.toFixed(0)}mm` : `‚úó ${maxW.toFixed(0)}mm`;
    document.getElementById('sFit').className = 'v ' + (fits ? 'ok' : 'warn');
}

function select(id) {
    document.querySelectorAll('.part').forEach(el => el.classList.remove('sel'));
    parts.forEach(m => { if (m.material) m.material.emissive?.setHex(0); });
    
    selected = id;
    const c = ASSEMBLY.find(x => x.id === id);
    if (!c) return;
    
    document.querySelector(`.part[data-id="${id}"]`)?.classList.add('sel');
    const mesh = parts.get(id);
    if (mesh?.material?.emissive) { mesh.material.emissive.setHex(0x442266); mesh.material.emissiveIntensity = 0.3; }
    
    const dims = c.w ? `${c.w}√ó${c.d}√ó${c.h}mm` : (c.r ? `√ò${c.r*2}√ó${c.h}mm` : (c.ro ? `√ò${c.ro*2}/${c.ri*2}√ó${c.h}mm` : (c.R ? `√ò${c.R*2}mm torus` : '')));
    document.getElementById('props').innerHTML = `
        <div class="row"><span class="l">Name</span><span class="v">${c.name}</span></div>
        <div class="row"><span class="l">Dims</span><span class="v ok">${dims}</span></div>
        <div class="row"><span class="l">Y Pos</span><span class="v">${c.y}mm</span></div>
        <div class="row"><span class="l">Mass</span><span class="v">${c.mass}g</span></div>
        <div class="row"><span class="l">Heat</span><span class="v">${c.W}W</span></div>
        <div class="row"><span class="l">Source</span><span class="v" style="font-size:9px">${c.src}</span></div>
    `;
    document.getElementById('info').querySelector('h3').textContent = c.name;
}

function toggleExplode() {
    exploded = !exploded;
    document.getElementById('bExpl').classList.toggle('on', exploded);
    parts.forEach((m) => {
        const targetY = exploded ? m.userData.origY * 1.8 : m.userData.origY;
        anim(m.position, 'y', targetY);
    });
}

function toggleSection() {
    sectioning = !sectioning;
    document.getElementById('bSect').classList.toggle('on', sectioning);
    document.getElementById('ctrl').classList.toggle('show', sectioning);
    parts.forEach(m => {
        if (m.material) {
            m.material.clippingPlanes = sectioning ? [clip] : [];
            m.material.needsUpdate = true;
        }
    });
}

function updateClip() {
    const axis = document.getElementById('sAxis').value;
    const pos = +document.getElementById('sPos').value;
    document.getElementById('sVal').textContent = pos + 'mm';
    clip.normal.set(axis==='x'?-1:0, axis==='y'?-1:0, axis==='z'?-1:0);
    clip.constant = pos;
}

function toggleXray() {
    xray = !xray;
    document.getElementById('bXray').classList.toggle('on', xray);
    parts.forEach((m, id) => {
        const c = ASSEMBLY.find(x => x.id === id);
        if (m.material && !c?.base) {
            m.material.transparent = xray;
            m.material.opacity = xray ? 0.25 : (c?.op ?? 1);
        }
    });
}

function toggleThermal() {
    thermal = !thermal;
    document.getElementById('bHeat').classList.toggle('on', thermal);
    parts.forEach((m, id) => {
        const c = ASSEMBLY.find(x => x.id === id);
        if (m.material && c) {
            if (thermal) {
                const t = Math.min(c.W / 8, 1);
                m.material.color.setHSL(0.33 - t * 0.33, 0.9, 0.45);
            } else {
                m.material.color.setHex(c.clr);
            }
        }
    });
}

function anim(obj, prop, target) {
    const start = obj[prop], t0 = performance.now();
    function tick(t) {
        const p = Math.min((t - t0) / 350, 1);
        obj[prop] = start + (target - start) * (1 - Math.pow(1-p, 3));
        if (p < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
}

function onClick(e) {
    const rect = renderer.domElement.getBoundingClientRect();
    const mouse = new THREE.Vector2(
        ((e.clientX - rect.left) / rect.width) * 2 - 1,
        -((e.clientY - rect.top) / rect.height) * 2 + 1
    );
    const ray = new THREE.Raycaster();
    ray.setFromCamera(mouse, camera);
    const hits = ray.intersectObjects(Array.from(parts.values()).filter(m => m.visible), true);
    if (hits.length) {
        let m = hits[0].object;
        while (m.parent && !m.userData.c) m = m.parent;
        if (m.userData.c) select(m.userData.c.id);
    }
}

function onKey(e) {
    if (e.target.tagName === 'INPUT') return;
    switch(e.key.toLowerCase()) {
        case 'h': camera.position.set(80,50,80); controls.target.set(0,0,0); break;
        case 'e': toggleExplode(); break;
        case 's': toggleSection(); break;
        case 'x': toggleXray(); break;
        case 't': toggleThermal(); break;
        case '?': document.getElementById('help').classList.toggle('show'); break;
        case 'escape': document.getElementById('help').classList.remove('show'); break;
    }
}

init();
</script>
</body>
</html>
