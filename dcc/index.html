<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCC: Making the Team</title>
    <meta name="description" content="An interactive documentary featuring the voices and faces of the Dallas Cowboys Cheerleaders">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --gold: #d4af37;
            --gold-dim: rgba(212, 175, 55, 0.6);
            --bg: #0a0908;
            --text: #f5f5f5;
            --text-dim: rgba(245, 245, 245, 0.6);
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* ============ LOADING STATE ============ */
        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }
        
        .loading.hidden { opacity: 0; pointer-events: none; }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--text-dim);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-text {
            margin-top: 1rem;
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ============ START OVERLAY ============ */
        #start-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        
        #start-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        #start-overlay h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            letter-spacing: 0.3em;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--gold) 0%, var(--text) 50%, var(--gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        #start-overlay p {
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            letter-spacing: 0.2em;
            color: var(--text-dim);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }
        
        /* ============ LANGUAGE PICKER ============ */
        .language-picker {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .language-picker label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .language-picker select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
            padding: 0.5rem 2rem 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23f5f5f5' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            transition: all 0.2s ease;
        }
        
        .language-picker select:hover {
            border-color: var(--gold);
        }
        
        .language-picker select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        
        /* ============ MAIN CONTAINER ============ */
        .main-container {
            display: flex;
            height: 100vh;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        .main-container.active { opacity: 1; }
        
        @media (min-width: 768px) {
            .main-container { flex-direction: row; }
            .video-panel { flex: 1.2; }
            .content-panel { flex: 0.8; }
        }
        
        @media (max-width: 767px) {
            .main-container { flex-direction: column; }
            .video-panel { height: 50vh; }
            .content-panel { height: 50vh; overflow-y: auto; }
        }
        
        /* ============ VIDEO PANEL ============ */
        .video-panel {
            position: relative;
            overflow: hidden;
            background: #000;
        }
        
        .video-panel::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to right, transparent 70%, var(--bg) 100%);
            pointer-events: none;
        }
        
        @media (max-width: 767px) {
            .video-panel::after {
                background: linear-gradient(to bottom, transparent 70%, var(--bg) 100%);
            }
        }
        
        .character-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 20%;
            opacity: 0;
            transition: opacity 0.4s ease;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .character-video.active {
            opacity: 1;
            z-index: 1;
        }
        
        .speaker-badge {
            position: absolute;
            bottom: 2rem;
            left: 2rem;
            z-index: 10;
        }
        
        .speaker-badge h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }
        
        .speaker-badge h2.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .speaker-badge .role {
            font-size: clamp(0.7rem, 1.5vw, 0.9rem);
            letter-spacing: 0.2em;
            color: var(--gold);
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.6s ease 0.3s;
        }
        
        .speaker-badge .role.visible { opacity: 1; }
        
        /* ============ CONTENT PANEL ============ */
        .content-panel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: clamp(2rem, 5vw, 5rem);
            position: relative;
        }
        
        .quote-container {
            font-size: clamp(1.1rem, 2.5vw, 1.7rem);
            line-height: 1.9;
            font-weight: 300;
            color: var(--text-dim);
            max-width: 600px;
        }
        
        .word {
            display: inline-block;
            opacity: 0;
            transform: translateY(12px);
            transition: opacity 0.2s ease, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), color 0.3s ease;
            margin-right: 0.2em;
        }
        
        .word.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .word.current {
            color: var(--text);
            font-weight: 400;
        }
        
        .word.emphasis {
            color: var(--gold);
            font-style: italic;
        }
        
        /* ============ PLAYBACK CONTROLS ============ */
        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1.5rem;
            background: linear-gradient(to top, var(--bg), transparent);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        body:hover .controls,
        .controls:hover,
        .controls.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 767px) {
            .controls { opacity: 1; transform: translateY(0); gap: 0.5rem; }
        }
        
        .control-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--gold);
        }
        
        .control-btn.play-pause {
            width: 56px;
            height: 56px;
            background: var(--gold);
            border: none;
        }
        
        .control-btn.play-pause:hover {
            transform: scale(1.05);
            background: #e5c349;
        }
        
        .control-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .control-btn.play-pause svg {
            fill: var(--bg);
            width: 24px;
            height: 24px;
        }
        
        .progress-container {
            flex: 1;
            max-width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--gold);
            border-radius: 3px;
            width: 0%;
            transition: width 0.05s linear;
        }
        
        .time-display {
            font-size: 0.75rem;
            color: var(--text-dim);
            min-width: 70px;
            text-align: center;
            font-variant-numeric: tabular-nums;
        }
        
        /* ============ NAV DOTS ============ */
        .nav-dots {
            position: fixed;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            z-index: 100;
        }
        
        @media (max-width: 767px) {
            .nav-dots {
                right: auto;
                left: 50%;
                top: auto;
                bottom: 5rem;
                transform: translateX(-50%);
                flex-direction: row;
            }
        }
        
        .nav-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-dot:hover { background: rgba(255, 255, 255, 0.5); }
        .nav-dot.active { background: var(--gold); transform: scale(1.3); }
        
        .nav-dot::after {
            content: attr(data-name);
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            font-size: 0.75rem;
            color: var(--text-dim);
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        
        .nav-dot:hover::after { opacity: 1; }
        
        @media (max-width: 767px) {
            .nav-dot::after { display: none; }
        }
        
        .credits {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            font-size: 0.65rem;
            color: var(--text-dim);
            opacity: 0.4;
            z-index: 50;
        }
        
        .credits a {
            color: var(--gold-dim);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Loading state -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading videos...</div>
    </div>
    
    <!-- Language Picker -->
    <div class="language-picker">
        <label for="langSelect">Language</label>
        <select id="langSelect">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="ja">日本語</option>
        </select>
    </div>
    
    <!-- Click to start -->
    <div id="start-overlay">
        <h1>DCC</h1>
        <p>CLICK TO BEGIN</p>
    </div>
    
    <div class="main-container" id="main">
        <div class="video-panel" id="videoPanel">
            <div class="speaker-badge">
                <h2 id="speakerName"></h2>
                <div class="role" id="speakerRole"></div>
            </div>
        </div>
        <div class="content-panel">
            <div class="quote-container" id="quote"></div>
        </div>
    </div>
    
    <div class="controls" id="controls">
        <button class="control-btn" id="prevBtn" title="Previous (↑)">
            <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
        </button>
        <button class="control-btn" id="rewindBtn" title="Rewind 5s (←)">
            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
        </button>
        <button class="control-btn play-pause" id="playPauseBtn" title="Play/Pause (Space)">
            <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg id="pauseIcon" viewBox="0 0 24 24" style="display:none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        </button>
        <button class="control-btn" id="forwardBtn" title="Forward 5s (→)">
            <svg viewBox="0 0 24 24"><path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/></svg>
        </button>
        <button class="control-btn" id="nextBtn" title="Next (↓)">
            <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
        </button>
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
    </div>
    
    <div class="nav-dots" id="navDots"></div>
    
    <div class="credits">
        Voice: <a href="https://elevenlabs.io">ElevenLabs</a> · 
        Video: <a href="https://heygen.com">HeyGen</a>
    </div>
    
    <script>
    /**
     * VideoDocumentary - Robust multi-segment video playback with language support
     */
    class VideoDocumentary {
        constructor(config, containerEl) {
            this.config = config;
            this.container = containerEl;
            this.currentLang = config.defaultLang || 'en';
            this.videos = {};
            this.currentIndex = -1;
            this.isPlaying = false;
            this.isTransitioning = false;
            
            this.onTimeUpdate = null;
            this.onSegmentChange = null;
            this.onEnd = null;
            this.onReady = null;
        }
        
        _getSegments() {
            return this.config.languages[this.currentLang].segments;
        }
        
        _getTotalDuration() {
            return this._getSegments().reduce((sum, s) => sum + s.duration, 0);
        }
        
        _getCumulativeStarts() {
            const starts = [0];
            let total = 0;
            this._getSegments().forEach(s => {
                total += s.duration;
                starts.push(total);
            });
            return starts;
        }
        
        async init() {
            await this._loadLanguage(this.currentLang);
            if (this.onReady) this.onReady();
        }
        
        async _loadLanguage(lang) {
            // Clear existing videos
            Object.values(this.videos).forEach(v => v.remove());
            this.videos = {};
            
            const segments = this.config.languages[lang].segments;
            const loadPromises = segments.map((seg, i) => this._createVideo(seg, lang));
            await Promise.all(loadPromises);
            
            // Set up ended handlers
            Object.values(this.videos).forEach(video => {
                video.addEventListener('ended', () => this._onVideoEnded());
            });
        }
        
        _createVideo(segment, lang) {
            return new Promise((resolve) => {
                const video = document.createElement('video');
                video.className = 'character-video';
                video.playsInline = true;
                video.preload = 'auto';
                video.src = `videos/${lang}/${segment.key}_talking.mp4`;
                
                const onCanPlay = () => {
                    video.removeEventListener('canplaythrough', onCanPlay);
                    resolve();
                };
                
                video.addEventListener('canplaythrough', onCanPlay);
                video.addEventListener('error', () => resolve());
                setTimeout(() => resolve(), 8000);
                
                video.load();
                this.videos[segment.key] = video;
                this.container.insertBefore(video, this.container.firstChild);
            });
        }
        
        async setLanguage(lang) {
            if (lang === this.currentLang) return;
            
            const wasPlaying = this.isPlaying;
            const savedIndex = this.currentIndex;
            
            this.pause();
            this.currentIndex = -1;
            this.currentLang = lang;
            
            await this._loadLanguage(lang);
            
            if (savedIndex >= 0) {
                this.goToSegment(savedIndex, wasPlaying);
            }
        }
        
        _onVideoEnded() {
            if (this.isTransitioning) return;
            
            const segments = this._getSegments();
            if (this.currentIndex < segments.length - 1) {
                this.goToSegment(this.currentIndex + 1, true);
            } else {
                this.isPlaying = false;
                if (this.onEnd) this.onEnd();
            }
        }
        
        goToSegment(index, autoplay = false) {
            const segments = this._getSegments();
            if (index < 0 || index >= segments.length) return;
            if (this.isTransitioning) return;
            
            this.isTransitioning = true;
            
            if (this.currentIndex >= 0) {
                const prevKey = segments[this.currentIndex].key;
                const prevVideo = this.videos[prevKey];
                if (prevVideo) {
                    prevVideo.pause();
                    prevVideo.classList.remove('active');
                }
            }
            
            const segment = segments[index];
            const video = this.videos[segment.key];
            
            if (video) {
                video.currentTime = 0;
                video.classList.add('active');
            }
            
            this.currentIndex = index;
            
            if (this.onSegmentChange) {
                this.onSegmentChange(index, segment);
            }
            
            setTimeout(() => {
                this.isTransitioning = false;
                if (autoplay || this.isPlaying) {
                    this.play();
                }
            }, 100);
        }
        
        play() {
            if (this.currentIndex < 0) {
                this.goToSegment(0, true);
                return;
            }
            
            const video = this._currentVideo();
            if (video) {
                video.play().catch(() => {});
                this.isPlaying = true;
                this._startUpdateLoop();
            }
        }
        
        pause() {
            const video = this._currentVideo();
            if (video) video.pause();
            this.isPlaying = false;
        }
        
        toggle() {
            if (this.isPlaying) this.pause();
            else this.play();
            return this.isPlaying;
        }
        
        seek(globalTime) {
            const segments = this._getSegments();
            const starts = this._getCumulativeStarts();
            
            for (let i = 0; i < segments.length; i++) {
                if (globalTime < starts[i + 1]) {
                    const localTime = globalTime - starts[i];
                    
                    if (i !== this.currentIndex) {
                        this.goToSegment(i, this.isPlaying);
                        setTimeout(() => {
                            const video = this.videos[segments[i].key];
                            if (video) video.currentTime = Math.max(0, localTime);
                        }, 150);
                    } else {
                        const video = this._currentVideo();
                        if (video) video.currentTime = Math.max(0, localTime);
                    }
                    return;
                }
            }
        }
        
        seekRelative(delta) {
            const current = this.getCurrentTime();
            const total = this._getTotalDuration();
            this.seek(Math.max(0, Math.min(total, current + delta)));
        }
        
        prev() {
            this.goToSegment(Math.max(0, this.currentIndex - 1), this.isPlaying);
        }
        
        next() {
            const max = this._getSegments().length - 1;
            this.goToSegment(Math.min(max, this.currentIndex + 1), this.isPlaying);
        }
        
        getCurrentTime() {
            const video = this._currentVideo();
            if (!video || this.currentIndex < 0) return 0;
            return this._getCumulativeStarts()[this.currentIndex] + video.currentTime;
        }
        
        getLocalTime() {
            const video = this._currentVideo();
            return video ? video.currentTime : 0;
        }
        
        _currentVideo() {
            if (this.currentIndex < 0) return null;
            const seg = this._getSegments()[this.currentIndex];
            return this.videos[seg.key];
        }
        
        _startUpdateLoop() {
            const update = () => {
                if (!this.isPlaying) return;
                if (this.onTimeUpdate) {
                    this.onTimeUpdate(this.getCurrentTime(), this.getLocalTime(), this._getTotalDuration());
                }
                requestAnimationFrame(update);
            };
            requestAnimationFrame(update);
        }
    }
    
    // ============ CONFIGURATION ============
    const CONFIG = {
        defaultLang: 'en',
        languages: {
            en: {
                segments: [
                    { key: "kelli", name: "Kelli Finglass", role: "Director, Dallas Cowboys Cheerleaders", duration: 11.12,
                      quote: "Being a Dallas Cowboys Cheerleader isn't about the uniform. It's about the *woman* inside it. When I look at these women, I see *daughters*. I see *sisters*. I see the *best* of what we can be." },
                    { key: "judy", name: "Judy Trammell", role: "Head Choreographer", duration: 9.68,
                      quote: "Five, six, seven, eight. You know what I tell them? *Feel* the *music*. Don't count it. When you're out there on that *field*, the crowd can tell if you're just going through the *motions*." },
                    { key: "victoria", name: "Victoria Kalina", role: "4th Year Veteran", duration: 7.8,
                      quote: "My *mom* was a *DCC*. She used to tell me stories about what it meant to her. The *sisterhood*, the *sacrifice*. Now I get to live that same *dream*. It's like carrying a *torch* forward." },
                    { key: "chandi", name: "Chandi Dayle", role: "6th Year Veteran", duration: 8.32,
                      quote: "Six *years*. Six *seasons* on this team. Every single one of them taught me something different about who I am. The *highs*, the *lows*... that's what makes you a *veteran*." },
                ]
            },
            es: {
                segments: [
                    { key: "kelli", name: "Kelli Finglass", role: "Directora, Dallas Cowboys Cheerleaders", duration: 12.529,
                      quote: "Ser porrista de los Dallas Cowboys no se trata del uniforme. Se trata de la *mujer* que lo lleva. Cuando miro a estas mujeres, veo *hijas*. Veo *hermanas*. Veo lo *mejor* de lo que podemos ser." },
                    { key: "judy", name: "Judy Trammell", role: "Coreógrafa Principal", duration: 12.241,
                      quote: "Cinco, seis, siete, ocho. ¿Saben qué les digo? *Sientan* la *música*. No la cuenten. Cuando están en ese *campo*, el público puede notar si solo están pasando por los *movimientos*." },
                    { key: "victoria", name: "Victoria Kalina", role: "Veterana de 4 Años", duration: 13.801,
                      quote: "Mi *mamá* fue *DCC*. Ella me contaba historias sobre lo que significaba para ella. La *hermandad*, el *sacrificio*. Ahora yo puedo vivir ese mismo *sueño*. Es como llevar una *antorcha* hacia adelante." },
                    { key: "chandi", name: "Chandi Dayle", role: "Veterana de 6 Años", duration: 9.8,
                      quote: "Seis *años*. Seis *temporadas* en este equipo. Cada una de ellas me enseñó algo diferente sobre quién soy. Los *altos*, los *bajos*... eso es lo que te hace *veterana*." },
                ]
            },
            ja: {
                segments: [
                    { key: "kelli", name: "ケリー・フィングラス", role: "ダラス・カウボーイズ・チアリーダーズ ディレクター", duration: 16.76,
                      quote: "ダラス・カウボーイズ・チアリーダーであることは、ユニフォームのことではありません。それを着る*女性*のことです。この女性たちを見ると、*娘*たちが見えます。*姉妹*が見えます。私たちの*最高*の姿が見えます。" },
                    { key: "judy", name: "ジュディ・トラメル", role: "ヘッドコレオグラファー", duration: 12.481,
                      quote: "5、6、7、8。私が彼女たちに言うことを知っていますか？*音楽*を*感じ*なさい。数えないで。*フィールド*に出たとき、観客にはただ*動き*をなぞっているだけかどうかがわかります。" },
                    { key: "victoria", name: "ヴィクトリア・カリーナ", role: "4年目のベテラン", duration: 15.481,
                      quote: "私の*母*は*DCC*でした。母は私に、それが彼女にとってどんな意味があったかを話してくれました。*姉妹*のような絆、*犠牲*。今、私も同じ*夢*を生きています。まるで*松明*を前に運ぶようなものです。" },
                    { key: "chandi", name: "チャンディ・デイル", role: "6年目のベテラン", duration: 9.64,
                      quote: "6*年*間。このチームで6*シーズン*。そのすべてが、私が誰なのかについて違うことを教えてくれました。*喜び*も、*苦しみ*も...それが*ベテラン*になるということです。" },
                ]
            }
        }
    };
    
    // ============ UI SETUP ============
    const loadingEl = document.getElementById('loading');
    const overlayEl = document.getElementById('start-overlay');
    const mainEl = document.getElementById('main');
    const videoPanelEl = document.getElementById('videoPanel');
    const speakerNameEl = document.getElementById('speakerName');
    const speakerRoleEl = document.getElementById('speakerRole');
    const quoteEl = document.getElementById('quote');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');
    const timeDisplay = document.getElementById('timeDisplay');
    const navDotsContainer = document.getElementById('navDots');
    const langSelect = document.getElementById('langSelect');
    
    // Create nav dots
    CONFIG.languages.en.segments.forEach((seg, i) => {
        const dot = document.createElement('div');
        dot.className = 'nav-dot';
        dot.dataset.idx = i;
        dot.dataset.name = seg.name;
        navDotsContainer.appendChild(dot);
    });
    const navDots = navDotsContainer.querySelectorAll('.nav-dot');
    
    // ============ DOCUMENTARY INSTANCE ============
    const doc = new VideoDocumentary(CONFIG, videoPanelEl);
    
    function formatTime(s) {
        const m = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return `${m}:${sec.toString().padStart(2, '0')}`;
    }
    
    function parseQuote(quote) {
        return quote.split(/\s+/).map(word => {
            const isEmphasis = word.startsWith('*') && word.includes('*', 1);
            return { word: word.replace(/\*/g, ''), emphasis: isEmphasis };
        });
    }
    
    function buildWords(segment) {
        quoteEl.innerHTML = '';
        const words = parseQuote(segment.quote);
        const wordDuration = segment.duration / words.length;
        
        words.forEach((w, i) => {
            const span = document.createElement('span');
            span.className = 'word';
            if (w.emphasis) span.classList.add('emphasis');
            span.textContent = w.word;
            span.dataset.start = (i * wordDuration).toFixed(3);
            quoteEl.appendChild(span);
        });
    }
    
    function updateWords(localTime) {
        const wordEls = quoteEl.querySelectorAll('.word');
        wordEls.forEach((el, i) => {
            const start = parseFloat(el.dataset.start);
            const nextStart = wordEls[i + 1] ? parseFloat(wordEls[i + 1].dataset.start) : Infinity;
            
            if (localTime >= start) {
                el.classList.add('visible');
                el.classList.toggle('current', localTime < nextStart);
            } else {
                el.classList.remove('visible', 'current');
            }
        });
    }
    
    function updatePlayPauseIcon() {
        playIcon.style.display = doc.isPlaying ? 'none' : '';
        pauseIcon.style.display = doc.isPlaying ? '' : 'none';
    }
    
    function updateNavDots() {
        const segments = doc._getSegments();
        navDots.forEach((dot, i) => {
            if (segments[i]) {
                dot.dataset.name = segments[i].name;
            }
        });
    }
    
    // ============ EVENT HANDLERS ============
    doc.onReady = () => {
        loadingEl.classList.add('hidden');
    };
    
    doc.onSegmentChange = (index, segment) => {
        navDots.forEach((dot, i) => dot.classList.toggle('active', i === index));
        
        speakerNameEl.classList.remove('visible');
        speakerRoleEl.classList.remove('visible');
        
        setTimeout(() => {
            speakerNameEl.textContent = segment.name;
            speakerRoleEl.textContent = segment.role;
            speakerNameEl.classList.add('visible');
            speakerRoleEl.classList.add('visible');
        }, 100);
        
        buildWords(segment);
    };
    
    doc.onTimeUpdate = (globalTime, localTime, totalDuration) => {
        progressBar.style.width = `${(globalTime / totalDuration) * 100}%`;
        timeDisplay.textContent = `${formatTime(globalTime)} / ${formatTime(totalDuration)}`;
        updateWords(localTime);
    };
    
    doc.onEnd = () => {
        updatePlayPauseIcon();
    };
    
    // ============ LANGUAGE CHANGE ============
    langSelect.addEventListener('change', async (e) => {
        loadingEl.classList.remove('hidden');
        await doc.setLanguage(e.target.value);
        updateNavDots();
        loadingEl.classList.add('hidden');
    });
    
    // ============ CONTROLS ============
    document.getElementById('playPauseBtn').addEventListener('click', () => {
        doc.toggle();
        updatePlayPauseIcon();
    });
    
    document.getElementById('prevBtn').addEventListener('click', () => doc.prev());
    document.getElementById('nextBtn').addEventListener('click', () => doc.next());
    document.getElementById('rewindBtn').addEventListener('click', () => doc.seekRelative(-5));
    document.getElementById('forwardBtn').addEventListener('click', () => doc.seekRelative(5));
    
    progressContainer.addEventListener('click', (e) => {
        const rect = progressContainer.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        doc.seek(percent * doc._getTotalDuration());
    });
    
    navDots.forEach(dot => {
        dot.addEventListener('click', () => {
            const idx = parseInt(dot.dataset.idx);
            doc.goToSegment(idx, true);
            if (!doc.isPlaying) {
                doc.play();
                updatePlayPauseIcon();
            }
        });
    });
    
    document.addEventListener('keydown', (e) => {
        if (!overlayEl.classList.contains('hidden')) {
            startExperience();
            return;
        }
        
        switch(e.key) {
            case ' ':
                e.preventDefault();
                doc.toggle();
                updatePlayPauseIcon();
                break;
            case 'ArrowRight':
                doc.seekRelative(5);
                break;
            case 'ArrowLeft':
                doc.seekRelative(-5);
                break;
            case 'ArrowUp':
                e.preventDefault();
                doc.prev();
                break;
            case 'ArrowDown':
                e.preventDefault();
                doc.next();
                break;
        }
    });
    
    // ============ START ============
    function startExperience() {
        overlayEl.classList.add('hidden');
        mainEl.classList.add('active');
        
        setTimeout(() => {
            doc.goToSegment(0, true);
            updatePlayPauseIcon();
        }, 300);
    }
    
    overlayEl.addEventListener('click', startExperience);
    
    // Initialize
    doc.init();
    </script>
</body>
</html>
