<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCC: Making the Team</title>
    <meta name="description" content="An interactive documentary featuring the voices and faces of the Dallas Cowboys Cheerleaders">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --navy: #002244;
            --navy-deep: #001a33;
            --silver: #869397;
            --silver-light: #b0b7bc;
            --white: #ffffff;
            --star-gold: #c5b358;
            --bg: #0a0d12;
            --bg-panel: rgba(0, 34, 68, 0.3);
            --text: #f8f9fa;
            --text-dim: rgba(248, 249, 250, 0.6);
            --accent: var(--silver-light);
            --accent-glow: rgba(176, 183, 188, 0.4);
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', system-ui, sans-serif;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #starfield {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            opacity: 0.6;
        }
        
        /* Loading */
        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.8s ease;
        }
        .loading.hidden { opacity: 0; pointer-events: none; }
        .loading-star { width: 60px; height: 60px; }
        .loading-star::before {
            content: '★';
            font-size: 48px;
            color: var(--silver-light);
            animation: starPulse 1.5s ease-in-out infinite;
            display: block;
            text-align: center;
        }
        @keyframes starPulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        .loading-text {
            margin-top: 1.5rem;
            color: var(--text-dim);
            font-size: 0.85rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }
        
        /* Start Overlay */
        #start-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--bg) 0%, var(--navy-deep) 50%, var(--bg) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1), visibility 1.2s;
        }
        #start-overlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .intro-stars {
            position: absolute;
            font-size: 1.5rem;
            color: var(--silver);
            letter-spacing: 0.5em;
            opacity: 0;
            animation: fadeSlideUp 1s ease forwards 0.3s;
        }
        .intro-stars.top { top: 25%; }
        .intro-stars.bottom { bottom: 25%; animation-delay: 0.5s; }
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 0.6; transform: translateY(0); }
        }
        #start-overlay h1 {
            font-family: 'Cinzel', serif;
            font-size: clamp(3rem, 12vw, 8rem);
            font-weight: 600;
            letter-spacing: 0.4em;
            margin-left: 0.4em;
            background: linear-gradient(180deg, var(--white) 0%, var(--silver-light) 40%, var(--silver) 60%, var(--white) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0;
            animation: titleReveal 1.5s ease forwards 0.2s;
        }
        @keyframes titleReveal {
            0% { opacity: 0; transform: scale(0.9) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .subtitle {
            font-family: 'Cinzel', serif;
            font-size: clamp(0.7rem, 2vw, 1rem);
            letter-spacing: 0.35em;
            color: var(--silver);
            margin-top: 1rem;
            opacity: 0;
            animation: fadeSlideUp 1s ease forwards 0.8s;
        }
        .start-prompt {
            position: absolute;
            bottom: 15%;
            font-size: clamp(0.7rem, 1.5vw, 0.9rem);
            letter-spacing: 0.25em;
            color: var(--text-dim);
            opacity: 0;
            animation: fadeSlideUp 1s ease forwards 1.2s, pulse 2.5s ease-in-out infinite 2.2s;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }
        
        /* Language Picker */
        .language-picker {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.5s ease;
        }
        .language-picker.visible { opacity: 1; transform: translateY(0); }
        .language-picker label {
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }
        .language-picker select {
            background: rgba(0, 34, 68, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(176, 183, 188, 0.2);
            color: var(--text);
            padding: 0.6rem 2.2rem 0.6rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23b0b7bc' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            transition: all 0.3s ease;
        }
        .language-picker select:hover { border-color: var(--silver); }
        .language-picker select:focus { outline: none; border-color: var(--silver-light); }
        
        /* Main Container */
        .main-container {
            display: flex;
            height: 100vh;
            opacity: 0;
            transform: scale(0.98);
            transition: opacity 1s ease 0.3s, transform 1s ease 0.3s;
            position: relative;
            z-index: 1;
        }
        .main-container.active { opacity: 1; transform: scale(1); }
        @media (min-width: 768px) {
            .main-container { flex-direction: row; }
            .video-panel { flex: 1.3; }
            .content-panel { flex: 0.7; }
        }
        @media (max-width: 767px) {
            .main-container { flex-direction: column; }
            .video-panel { height: 55vh; }
            .content-panel { height: 45vh; overflow-y: auto; }
        }
        
        /* Video Panel */
        .video-panel {
            position: relative;
            overflow: hidden;
            background: #000;
        }
        .video-panel::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 50%, var(--bg) 100%);
            pointer-events: none;
            z-index: 2;
            opacity: 0.4;
        }
        .video-panel::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to right, transparent 60%, var(--bg) 100%);
            pointer-events: none;
            z-index: 3;
        }
        @media (max-width: 767px) {
            .video-panel::after { background: linear-gradient(to bottom, transparent 60%, var(--bg) 100%); }
        }
        .character-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 20%;
            opacity: 0;
            transform: scale(1.02);
            transition: opacity 0.6s ease, transform 0.8s ease;
            position: absolute;
            top: 0;
            left: 0;
        }
        .character-video.active { opacity: 1; transform: scale(1); z-index: 1; }
        .speaker-badge {
            position: absolute;
            bottom: 2.5rem;
            left: 2.5rem;
            z-index: 10;
        }
        .speaker-badge h2 {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.5rem, 4vw, 2.8rem);
            font-weight: 500;
            letter-spacing: 0.12em;
            margin-bottom: 0.6rem;
            opacity: 0;
            transform: translateX(-30px);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: 0 2px 20px rgba(0,0,0,0.5);
        }
        .speaker-badge h2.visible { opacity: 1; transform: translateX(0); }
        .speaker-badge .role {
            font-size: clamp(0.65rem, 1.3vw, 0.85rem);
            letter-spacing: 0.2em;
            color: var(--silver-light);
            text-transform: uppercase;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1) 0.15s;
        }
        .speaker-badge .role.visible { opacity: 1; transform: translateX(0); }
        
        /* Content Panel */
        .content-panel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: clamp(2rem, 5vw, 5rem);
            position: relative;
            background: linear-gradient(135deg, transparent 0%, var(--bg-panel) 100%);
        }
        .quote-container {
            font-size: clamp(1.1rem, 2.2vw, 1.6rem);
            line-height: 2;
            font-weight: 300;
            color: var(--text-dim);
            max-width: 550px;
        }
        
        /* Word Animations */
        .word {
            display: inline-block;
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.2s ease, transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), color 0.3s ease, text-shadow 0.3s ease;
            margin-right: 0.25em;
        }
        .word.visible { opacity: 1; transform: translateY(0); }
        .word.current { color: var(--white); font-weight: 400; }
        
        /* EMOTION EFFECTS */
        .word.emotion-power {
            color: var(--silver-light);
            font-weight: 600;
        }
        .word.emotion-power.current {
            animation: powerPulse 0.6s ease;
            text-shadow: 0 0 30px rgba(176, 183, 188, 0.8), 0 0 60px rgba(176, 183, 188, 0.4);
        }
        @keyframes powerPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        
        .word.emotion-heart {
            color: #e8a4b8;
            font-style: italic;
        }
        .word.emotion-heart.current {
            animation: heartGlow 0.8s ease;
            text-shadow: 0 0 20px rgba(232, 164, 184, 0.6);
        }
        @keyframes heartGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(232, 164, 184, 0.6); }
            50% { text-shadow: 0 0 40px rgba(232, 164, 184, 0.9), 0 0 60px rgba(232, 164, 184, 0.5); }
        }
        
        .word.emotion-pride {
            color: var(--star-gold);
            font-weight: 500;
        }
        .word.emotion-pride.current {
            animation: prideShine 0.7s ease;
            text-shadow: 0 0 25px rgba(197, 179, 88, 0.7);
        }
        @keyframes prideShine {
            0% { filter: brightness(1); }
            50% { filter: brightness(1.4); }
            100% { filter: brightness(1); }
        }
        
        .word.emotion-wisdom {
            color: var(--silver);
            font-weight: 400;
            letter-spacing: 0.05em;
        }
        .word.emotion-wisdom.current {
            text-shadow: 0 0 15px rgba(134, 147, 151, 0.6);
        }
        
        .word.emotion-energy {
            color: var(--white);
            font-weight: 600;
        }
        .word.emotion-energy.current {
            animation: energyBounce 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes energyBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        /* Controls */
        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            padding: 1.5rem 2rem;
            background: linear-gradient(to top, var(--bg) 0%, transparent 100%);
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }
        .controls.visible { opacity: 1; transform: translateY(0); }
        @media (max-width: 767px) { .controls { gap: 0.5rem; padding: 1rem; } }
        
        .control-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(0, 34, 68, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(176, 183, 188, 0.15);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }
        .control-btn:hover {
            background: rgba(0, 34, 68, 0.8);
            border-color: var(--silver);
            transform: scale(1.08);
        }
        .control-btn:active { transform: scale(0.95); }
        .control-btn.play-pause {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--silver) 0%, var(--silver-light) 100%);
            border: none;
        }
        .control-btn.play-pause:hover { transform: scale(1.1); }
        .control-btn svg { width: 18px; height: 18px; fill: currentColor; }
        .control-btn.play-pause svg { fill: var(--navy-deep); width: 24px; height: 24px; }
        
        .progress-wrapper { flex: 1; max-width: 350px; display: flex; flex-direction: column; gap: 0.5rem; }
        .segment-indicators { display: flex; gap: 4px; height: 3px; }
        .segment-indicator {
            flex: 1;
            background: rgba(176, 183, 188, 0.15);
            border-radius: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .segment-indicator:hover { background: rgba(176, 183, 188, 0.3); }
        .segment-indicator.active { background: var(--silver-light); }
        .segment-indicator.completed { background: var(--silver); }
        .progress-container {
            height: 5px;
            background: rgba(176, 183, 188, 0.1);
            border-radius: 3px;
            cursor: pointer;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--silver) 0%, var(--silver-light) 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.05s linear;
        }
        .time-display {
            font-size: 0.7rem;
            color: var(--text-dim);
            min-width: 75px;
            text-align: center;
            font-variant-numeric: tabular-nums;
        }
        
        /* Nav Dots */
        .nav-dots {
            position: fixed;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .nav-dots.visible { opacity: 1; }
        @media (max-width: 767px) {
            .nav-dots { right: auto; left: 50%; top: auto; bottom: 6rem; transform: translateX(-50%); flex-direction: row; }
        }
        .nav-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(176, 183, 188, 0.2);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-dot:hover { background: rgba(176, 183, 188, 0.4); transform: scale(1.2); }
        .nav-dot.active { background: var(--silver-light); transform: scale(1.4); }
        .nav-dot::after {
            content: attr(data-name);
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            font-size: 0.7rem;
            color: var(--text-dim);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            padding: 0.3rem 0.6rem;
            background: rgba(0, 34, 68, 0.8);
            border-radius: 4px;
        }
        .nav-dot:hover::after { opacity: 1; }
        @media (max-width: 767px) { .nav-dot::after { display: none; } }
        
        /* Ending */
        #ending-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--bg) 0%, var(--navy-deep) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 900;
            opacity: 0;
            visibility: hidden;
            transition: all 0.8s ease;
        }
        #ending-overlay.visible { opacity: 1; visibility: visible; }
        .ending-star {
            font-size: 3rem;
            color: var(--silver-light);
            margin-bottom: 2rem;
            opacity: 0;
            animation: endingStarReveal 1s ease forwards 0.3s;
        }
        @keyframes endingStarReveal {
            from { opacity: 0; transform: scale(0) rotate(-180deg); }
            to { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        .ending-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 6vw, 4rem);
            letter-spacing: 0.3em;
            color: var(--silver-light);
            margin-bottom: 1rem;
            opacity: 0;
            animation: fadeSlideUp 1s ease forwards 0.6s;
        }
        .ending-subtitle {
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            margin-bottom: 3rem;
            opacity: 0;
            animation: fadeSlideUp 1s ease forwards 0.9s;
        }
        .replay-btn {
            padding: 1rem 2.5rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            background: transparent;
            border: 1px solid var(--silver);
            color: var(--silver-light);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeSlideUp 1s ease forwards 1.2s;
        }
        .replay-btn:hover { background: var(--silver); color: var(--navy-deep); }
        
        .credits {
            position: fixed;
            bottom: 0.8rem;
            right: 1rem;
            font-size: 0.6rem;
            color: var(--text-dim);
            opacity: 0.3;
            z-index: 50;
        }
        .credits a { color: var(--silver); text-decoration: none; }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    
    <div class="loading" id="loading">
        <div class="loading-star"></div>
        <div class="loading-text">Preparing Experience</div>
    </div>
    
    <div class="language-picker" id="langPicker">
        <label for="langSelect">Language</label>
        <select id="langSelect">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="ja">Japanese</option>
        </select>
    </div>
    
    <div id="start-overlay">
        <div class="intro-stars top">★ ★ ★ ★ ★</div>
        <h1>DCC</h1>
        <div class="subtitle">MAKING THE TEAM</div>
        <div class="intro-stars bottom">★ ★ ★ ★ ★</div>
        <div class="start-prompt">CLICK ANYWHERE TO BEGIN</div>
    </div>
    
    <div class="main-container" id="main">
        <div class="video-panel" id="videoPanel">
            <div class="speaker-badge">
                <h2 id="speakerName"></h2>
                <div class="role" id="speakerRole"></div>
            </div>
        </div>
        <div class="content-panel">
            <div class="quote-container" id="quote"></div>
        </div>
    </div>
    
    <div class="controls" id="controls">
        <button class="control-btn" id="prevBtn" title="Previous (↑)">
            <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
        </button>
        <button class="control-btn" id="rewindBtn" title="Rewind 5s (←)">
            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
        </button>
        <button class="control-btn play-pause" id="playPauseBtn" title="Play/Pause (Space)">
            <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg id="pauseIcon" viewBox="0 0 24 24" style="display:none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        </button>
        <button class="control-btn" id="forwardBtn" title="Forward 5s (→)">
            <svg viewBox="0 0 24 24"><path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/></svg>
        </button>
        <button class="control-btn" id="nextBtn" title="Next (↓)">
            <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
        </button>
        <div class="progress-wrapper">
            <div class="segment-indicators" id="segmentIndicators"></div>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
        <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
    </div>
    
    <div class="nav-dots" id="navDots"></div>
    
    <div id="ending-overlay">
        <div class="ending-content">
            <div class="ending-star">★</div>
            <h2 class="ending-title">DCC</h2>
            <p class="ending-subtitle">MAKING THE TEAM</p>
            <button class="replay-btn" id="replayBtn">Watch Again</button>
        </div>
    </div>
    
    <div class="credits">
        Voice <a href="https://elevenlabs.io">ElevenLabs</a> · 
        Video <a href="https://heygen.com">HeyGen</a>
    </div>
    
    <script>
    // ============ STARFIELD ============
    class Starfield {
        constructor(canvas) {
            this.canvas = canvas;
            this.ctx = canvas.getContext('2d');
            this.stars = [];
            this.resize();
            window.addEventListener('resize', () => this.resize());
        }
        resize() {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;
            this.initStars();
        }
        initStars() {
            this.stars = [];
            const count = Math.floor((this.canvas.width * this.canvas.height) / 15000);
            for (let i = 0; i < count; i++) {
                this.stars.push({
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height,
                    size: Math.random() * 1.5 + 0.5,
                    twinkle: Math.random() * Math.PI * 2,
                    speed: Math.random() * 0.02 + 0.01,
                });
            }
        }
        animate() {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            this.stars.forEach(star => {
                star.twinkle += star.speed;
                const alpha = 0.3 + Math.sin(star.twinkle) * 0.3;
                this.ctx.beginPath();
                this.ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                this.ctx.fillStyle = `rgba(176, 183, 188, ${alpha})`;
                this.ctx.fill();
            });
            requestAnimationFrame(() => this.animate());
        }
    }
    
    // ============ WORD EMOTION MAPPING ============
    const EMOTION_MAP = {
        // Power words - scale pulse
        'woman': 'power', 'women': 'power', 'best': 'power', 'veteran': 'power',
        'mujer': 'power', 'mujeres': 'power', 'mejor': 'power', 'veterana': 'power',
        '女性': 'power', '最高': 'power', 'ベテラン': 'power',
        
        // Heart words - warm glow
        'daughters': 'heart', 'sisters': 'heart', 'sisterhood': 'heart', 'mom': 'heart', 'dream': 'heart', 'torch': 'heart',
        'hijas': 'heart', 'hermanas': 'heart', 'hermandad': 'heart', 'mamá': 'heart', 'sueño': 'heart', 'antorcha': 'heart',
        '娘': 'heart', '姉妹': 'heart', '母': 'heart', '夢': 'heart', '松明': 'heart',
        
        // Pride words - golden shine
        'DCC': 'pride', 'field': 'pride', 'team': 'pride',
        'campo': 'pride', 'equipo': 'pride',
        'フィールド': 'pride', 'チーム': 'pride',
        
        // Wisdom words - subtle glow
        'sacrifice': 'wisdom', 'years': 'wisdom', 'seasons': 'wisdom', 'highs': 'wisdom', 'lows': 'wisdom',
        'sacrificio': 'wisdom', 'años': 'wisdom', 'temporadas': 'wisdom', 'altos': 'wisdom', 'bajos': 'wisdom',
        '犠牲': 'wisdom', '年': 'wisdom', 'シーズン': 'wisdom', '喜び': 'wisdom', '苦しみ': 'wisdom',
        
        // Energy words - bounce
        'Feel': 'energy', 'music': 'energy', 'motions': 'energy',
        'Sientan': 'energy', 'música': 'energy', 'movimientos': 'energy',
        '感じ': 'energy', '音楽': 'energy', '動き': 'energy',
    };
    
    // ============ SCRIPT DATA WITH WORD TIMINGS ============
    // Word timings are percentages through each segment (0-1)
    const CONFIG = {
        defaultLang: 'en',
        languages: {
            en: {
                segments: [
                    { 
                        key: "kelli", 
                        name: "Kelli Finglass", 
                        role: "Director", 
                        duration: 11.12,
                        words: [
                            { text: "Being", t: 0.00 },
                            { text: "a", t: 0.03 },
                            { text: "Dallas", t: 0.05 },
                            { text: "Cowboys", t: 0.09 },
                            { text: "Cheerleader", t: 0.13 },
                            { text: "isn't", t: 0.19 },
                            { text: "about", t: 0.22 },
                            { text: "the", t: 0.25 },
                            { text: "uniform.", t: 0.27 },
                            { text: "It's", t: 0.33 },
                            { text: "about", t: 0.35 },
                            { text: "the", t: 0.38 },
                            { text: "woman", t: 0.40, emotion: true },
                            { text: "inside", t: 0.45 },
                            { text: "it.", t: 0.49 },
                            { text: "When", t: 0.54 },
                            { text: "I", t: 0.56 },
                            { text: "look", t: 0.57 },
                            { text: "at", t: 0.59 },
                            { text: "these", t: 0.60 },
                            { text: "women,", t: 0.62, emotion: true },
                            { text: "I", t: 0.67 },
                            { text: "see", t: 0.68 },
                            { text: "daughters.", t: 0.70, emotion: true },
                            { text: "I", t: 0.77 },
                            { text: "see", t: 0.78 },
                            { text: "sisters.", t: 0.80, emotion: true },
                            { text: "I", t: 0.87 },
                            { text: "see", t: 0.88 },
                            { text: "the", t: 0.90 },
                            { text: "best", t: 0.92, emotion: true },
                            { text: "of", t: 0.95 },
                            { text: "what", t: 0.96 },
                            { text: "we", t: 0.97 },
                            { text: "can", t: 0.98 },
                            { text: "be.", t: 0.99 },
                        ]
                    },
                    { 
                        key: "judy", 
                        name: "Judy Trammell", 
                        role: "Head Choreographer", 
                        duration: 9.68,
                        words: [
                            { text: "Five,", t: 0.00 },
                            { text: "six,", t: 0.04 },
                            { text: "seven,", t: 0.08 },
                            { text: "eight.", t: 0.12 },
                            { text: "You", t: 0.20 },
                            { text: "know", t: 0.22 },
                            { text: "what", t: 0.24 },
                            { text: "I", t: 0.26 },
                            { text: "tell", t: 0.27 },
                            { text: "them?", t: 0.29 },
                            { text: "Feel", t: 0.35, emotion: true },
                            { text: "the", t: 0.40 },
                            { text: "music.", t: 0.42, emotion: true },
                            { text: "Don't", t: 0.50 },
                            { text: "count", t: 0.53 },
                            { text: "it.", t: 0.56 },
                            { text: "When", t: 0.62 },
                            { text: "you're", t: 0.64 },
                            { text: "out", t: 0.66 },
                            { text: "there", t: 0.68 },
                            { text: "on", t: 0.70 },
                            { text: "that", t: 0.71 },
                            { text: "field,", t: 0.73, emotion: true },
                            { text: "the", t: 0.78 },
                            { text: "crowd", t: 0.80 },
                            { text: "can", t: 0.82 },
                            { text: "tell", t: 0.84 },
                            { text: "if", t: 0.86 },
                            { text: "you're", t: 0.87 },
                            { text: "just", t: 0.89 },
                            { text: "going", t: 0.90 },
                            { text: "through", t: 0.92 },
                            { text: "the", t: 0.94 },
                            { text: "motions.", t: 0.95, emotion: true },
                        ]
                    },
                    { 
                        key: "victoria", 
                        name: "Victoria Kalina", 
                        role: "4th Year Veteran", 
                        duration: 7.8,
                        words: [
                            { text: "My", t: 0.00 },
                            { text: "mom", t: 0.04, emotion: true },
                            { text: "was", t: 0.10 },
                            { text: "a", t: 0.13 },
                            { text: "DCC.", t: 0.15, emotion: true },
                            { text: "She", t: 0.22 },
                            { text: "used", t: 0.25 },
                            { text: "to", t: 0.27 },
                            { text: "tell", t: 0.28 },
                            { text: "me", t: 0.30 },
                            { text: "stories", t: 0.32 },
                            { text: "about", t: 0.36 },
                            { text: "what", t: 0.39 },
                            { text: "it", t: 0.41 },
                            { text: "meant", t: 0.42 },
                            { text: "to", t: 0.45 },
                            { text: "her.", t: 0.46 },
                            { text: "The", t: 0.52 },
                            { text: "sisterhood,", t: 0.54, emotion: true },
                            { text: "the", t: 0.62 },
                            { text: "sacrifice.", t: 0.64, emotion: true },
                            { text: "Now", t: 0.72 },
                            { text: "I", t: 0.74 },
                            { text: "get", t: 0.75 },
                            { text: "to", t: 0.76 },
                            { text: "live", t: 0.77 },
                            { text: "that", t: 0.79 },
                            { text: "same", t: 0.80 },
                            { text: "dream.", t: 0.82, emotion: true },
                            { text: "It's", t: 0.88 },
                            { text: "like", t: 0.90 },
                            { text: "carrying", t: 0.91 },
                            { text: "a", t: 0.94 },
                            { text: "torch", t: 0.95, emotion: true },
                            { text: "forward.", t: 0.98 },
                        ]
                    },
                    { 
                        key: "chandi", 
                        name: "Chandi Dayle", 
                        role: "6th Year Veteran", 
                        duration: 8.32,
                        words: [
                            { text: "Six", t: 0.00 },
                            { text: "years.", t: 0.05, emotion: true },
                            { text: "Six", t: 0.14 },
                            { text: "seasons", t: 0.18, emotion: true },
                            { text: "on", t: 0.26 },
                            { text: "this", t: 0.28 },
                            { text: "team.", t: 0.30 },
                            { text: "Every", t: 0.38 },
                            { text: "single", t: 0.42 },
                            { text: "one", t: 0.46 },
                            { text: "of", t: 0.48 },
                            { text: "them", t: 0.49 },
                            { text: "taught", t: 0.51 },
                            { text: "me", t: 0.54 },
                            { text: "something", t: 0.56 },
                            { text: "different", t: 0.60 },
                            { text: "about", t: 0.65 },
                            { text: "who", t: 0.68 },
                            { text: "I", t: 0.70 },
                            { text: "am.", t: 0.71 },
                            { text: "The", t: 0.78 },
                            { text: "highs,", t: 0.80, emotion: true },
                            { text: "the", t: 0.86 },
                            { text: "lows...", t: 0.88, emotion: true },
                            { text: "that's", t: 0.93 },
                            { text: "what", t: 0.95 },
                            { text: "makes", t: 0.96 },
                            { text: "you", t: 0.97 },
                            { text: "a", t: 0.98 },
                            { text: "veteran.", t: 0.99, emotion: true },
                        ]
                    },
                ]
            },
            es: {
                segments: [
                    { 
                        key: "kelli", 
                        name: "Kelli Finglass", 
                        role: "Directora", 
                        duration: 12.529,
                        words: [
                            { text: "Ser", t: 0.00 },
                            { text: "porrista", t: 0.03 },
                            { text: "de", t: 0.08 },
                            { text: "los", t: 0.10 },
                            { text: "Dallas", t: 0.11 },
                            { text: "Cowboys", t: 0.14 },
                            { text: "no", t: 0.18 },
                            { text: "se", t: 0.20 },
                            { text: "trata", t: 0.21 },
                            { text: "del", t: 0.24 },
                            { text: "uniforme.", t: 0.26 },
                            { text: "Se", t: 0.33 },
                            { text: "trata", t: 0.35 },
                            { text: "de", t: 0.38 },
                            { text: "la", t: 0.39 },
                            { text: "mujer", t: 0.40, emotion: true },
                            { text: "que", t: 0.46 },
                            { text: "lo", t: 0.48 },
                            { text: "lleva.", t: 0.49 },
                            { text: "Cuando", t: 0.55 },
                            { text: "miro", t: 0.58 },
                            { text: "a", t: 0.61 },
                            { text: "estas", t: 0.62 },
                            { text: "mujeres,", t: 0.64, emotion: true },
                            { text: "veo", t: 0.70 },
                            { text: "hijas.", t: 0.72, emotion: true },
                            { text: "Veo", t: 0.80 },
                            { text: "hermanas.", t: 0.82, emotion: true },
                            { text: "Veo", t: 0.90 },
                            { text: "lo", t: 0.92 },
                            { text: "mejor", t: 0.93, emotion: true },
                            { text: "de", t: 0.97 },
                            { text: "lo", t: 0.98 },
                            { text: "que", t: 0.99 },
                            { text: "podemos", t: 0.995 },
                            { text: "ser.", t: 0.999 },
                        ]
                    },
                    { 
                        key: "judy", 
                        name: "Judy Trammell", 
                        role: "Coreógrafa Principal", 
                        duration: 12.241,
                        words: [
                            { text: "Cinco,", t: 0.00 },
                            { text: "seis,", t: 0.04 },
                            { text: "siete,", t: 0.08 },
                            { text: "ocho.", t: 0.12 },
                            { text: "¿Saben", t: 0.18 },
                            { text: "qué", t: 0.22 },
                            { text: "les", t: 0.24 },
                            { text: "digo?", t: 0.26 },
                            { text: "Sientan", t: 0.32, emotion: true },
                            { text: "la", t: 0.38 },
                            { text: "música.", t: 0.40, emotion: true },
                            { text: "No", t: 0.48 },
                            { text: "la", t: 0.50 },
                            { text: "cuenten.", t: 0.52 },
                            { text: "Cuando", t: 0.60 },
                            { text: "están", t: 0.64 },
                            { text: "en", t: 0.68 },
                            { text: "ese", t: 0.70 },
                            { text: "campo,", t: 0.72, emotion: true },
                            { text: "el", t: 0.78 },
                            { text: "público", t: 0.80 },
                            { text: "puede", t: 0.84 },
                            { text: "notar", t: 0.86 },
                            { text: "si", t: 0.90 },
                            { text: "solo", t: 0.91 },
                            { text: "están", t: 0.93 },
                            { text: "pasando", t: 0.95 },
                            { text: "por", t: 0.97 },
                            { text: "los", t: 0.98 },
                            { text: "movimientos.", t: 0.99, emotion: true },
                        ]
                    },
                    { 
                        key: "victoria", 
                        name: "Victoria Kalina", 
                        role: "Veterana · 4 Años", 
                        duration: 13.801,
                        words: [
                            { text: "Mi", t: 0.00 },
                            { text: "mamá", t: 0.03, emotion: true },
                            { text: "fue", t: 0.08 },
                            { text: "DCC.", t: 0.11, emotion: true },
                            { text: "Ella", t: 0.18 },
                            { text: "me", t: 0.21 },
                            { text: "contaba", t: 0.23 },
                            { text: "historias", t: 0.28 },
                            { text: "sobre", t: 0.33 },
                            { text: "lo", t: 0.36 },
                            { text: "que", t: 0.38 },
                            { text: "significaba", t: 0.40 },
                            { text: "para", t: 0.46 },
                            { text: "ella.", t: 0.48 },
                            { text: "La", t: 0.54 },
                            { text: "hermandad,", t: 0.56, emotion: true },
                            { text: "el", t: 0.64 },
                            { text: "sacrificio.", t: 0.66, emotion: true },
                            { text: "Ahora", t: 0.74 },
                            { text: "yo", t: 0.77 },
                            { text: "puedo", t: 0.79 },
                            { text: "vivir", t: 0.81 },
                            { text: "ese", t: 0.84 },
                            { text: "mismo", t: 0.86 },
                            { text: "sueño.", t: 0.88, emotion: true },
                            { text: "Es", t: 0.94 },
                            { text: "como", t: 0.95 },
                            { text: "llevar", t: 0.96 },
                            { text: "una", t: 0.97 },
                            { text: "antorcha", t: 0.98, emotion: true },
                            { text: "hacia", t: 0.995 },
                            { text: "adelante.", t: 0.999 },
                        ]
                    },
                    { 
                        key: "chandi", 
                        name: "Chandi Dayle", 
                        role: "Veterana · 6 Años", 
                        duration: 9.8,
                        words: [
                            { text: "Seis", t: 0.00 },
                            { text: "años.", t: 0.06, emotion: true },
                            { text: "Seis", t: 0.16 },
                            { text: "temporadas", t: 0.20, emotion: true },
                            { text: "en", t: 0.30 },
                            { text: "este", t: 0.32 },
                            { text: "equipo.", t: 0.34 },
                            { text: "Cada", t: 0.42 },
                            { text: "una", t: 0.46 },
                            { text: "de", t: 0.48 },
                            { text: "ellas", t: 0.50 },
                            { text: "me", t: 0.53 },
                            { text: "enseñó", t: 0.55 },
                            { text: "algo", t: 0.60 },
                            { text: "diferente", t: 0.64 },
                            { text: "sobre", t: 0.70 },
                            { text: "quién", t: 0.74 },
                            { text: "soy.", t: 0.78 },
                            { text: "Los", t: 0.84 },
                            { text: "altos,", t: 0.86, emotion: true },
                            { text: "los", t: 0.91 },
                            { text: "bajos...", t: 0.93, emotion: true },
                            { text: "eso", t: 0.97 },
                            { text: "es", t: 0.98 },
                            { text: "lo", t: 0.985 },
                            { text: "que", t: 0.99 },
                            { text: "te", t: 0.993 },
                            { text: "hace", t: 0.995 },
                            { text: "veterana.", t: 0.999, emotion: true },
                        ]
                    },
                ]
            },
            ja: {
                segments: [
                    { 
                        key: "kelli", 
                        name: "Kelli Finglass", 
                        role: "ディレクター", 
                        duration: 16.76,
                        words: [
                            { text: "ダラス・カウボーイズ・チアリーダーで", t: 0.00 },
                            { text: "あることは、", t: 0.08 },
                            { text: "ユニフォームの", t: 0.14 },
                            { text: "ことでは", t: 0.20 },
                            { text: "ありません。", t: 0.25 },
                            { text: "それを着る", t: 0.32 },
                            { text: "女性", t: 0.38, emotion: true },
                            { text: "のことです。", t: 0.44 },
                            { text: "この女性たちを", t: 0.52 },
                            { text: "見ると、", t: 0.60 },
                            { text: "娘", t: 0.66, emotion: true },
                            { text: "たちが", t: 0.72 },
                            { text: "見えます。", t: 0.76 },
                            { text: "姉妹", t: 0.82, emotion: true },
                            { text: "が見えます。", t: 0.88 },
                            { text: "私たちの", t: 0.94 },
                            { text: "最高", t: 0.97, emotion: true },
                            { text: "の姿が見えます。", t: 0.99 },
                        ]
                    },
                    { 
                        key: "judy", 
                        name: "Judy Trammell", 
                        role: "ヘッドコレオグラファー", 
                        duration: 12.481,
                        words: [
                            { text: "5、6、7、8。", t: 0.00 },
                            { text: "私が彼女たちに", t: 0.12 },
                            { text: "言うことを", t: 0.22 },
                            { text: "知っていますか？", t: 0.30 },
                            { text: "音楽", t: 0.40, emotion: true },
                            { text: "を", t: 0.46 },
                            { text: "感じ", t: 0.48, emotion: true },
                            { text: "なさい。", t: 0.54 },
                            { text: "数えないで。", t: 0.62 },
                            { text: "フィールド", t: 0.72, emotion: true },
                            { text: "に出たとき、", t: 0.80 },
                            { text: "観客には", t: 0.86 },
                            { text: "ただ", t: 0.91 },
                            { text: "動き", t: 0.94, emotion: true },
                            { text: "をなぞっているだけか", t: 0.97 },
                            { text: "どうかがわかります。", t: 0.99 },
                        ]
                    },
                    { 
                        key: "victoria", 
                        name: "Victoria Kalina", 
                        role: "4年目のベテラン", 
                        duration: 15.481,
                        words: [
                            { text: "私の", t: 0.00 },
                            { text: "母", t: 0.04, emotion: true },
                            { text: "は", t: 0.08 },
                            { text: "DCC", t: 0.10, emotion: true },
                            { text: "でした。", t: 0.16 },
                            { text: "母は私に、", t: 0.22 },
                            { text: "それが彼女にとって", t: 0.30 },
                            { text: "どんな意味が", t: 0.40 },
                            { text: "あったかを", t: 0.48 },
                            { text: "話してくれました。", t: 0.54 },
                            { text: "姉妹", t: 0.64, emotion: true },
                            { text: "のような絆、", t: 0.70 },
                            { text: "犠牲。", t: 0.76, emotion: true },
                            { text: "今、私も", t: 0.82 },
                            { text: "同じ", t: 0.86 },
                            { text: "夢", t: 0.88, emotion: true },
                            { text: "を生きています。", t: 0.92 },
                            { text: "まるで", t: 0.96 },
                            { text: "松明", t: 0.98, emotion: true },
                            { text: "を前に運ぶようなものです。", t: 0.99 },
                        ]
                    },
                    { 
                        key: "chandi", 
                        name: "Chandi Dayle", 
                        role: "6年目のベテラン", 
                        duration: 9.64,
                        words: [
                            { text: "6", t: 0.00 },
                            { text: "年", t: 0.06, emotion: true },
                            { text: "間。", t: 0.12 },
                            { text: "このチームで", t: 0.20 },
                            { text: "6", t: 0.30 },
                            { text: "シーズン。", t: 0.34, emotion: true },
                            { text: "そのすべてが、", t: 0.44 },
                            { text: "私が誰なのかについて", t: 0.54 },
                            { text: "違うことを", t: 0.66 },
                            { text: "教えてくれました。", t: 0.74 },
                            { text: "喜び", t: 0.84, emotion: true },
                            { text: "も、", t: 0.88 },
                            { text: "苦しみ", t: 0.90, emotion: true },
                            { text: "も...", t: 0.94 },
                            { text: "それが", t: 0.96 },
                            { text: "ベテラン", t: 0.98, emotion: true },
                            { text: "になるということです。", t: 0.99 },
                        ]
                    },
                ]
            }
        }
    };
    
    // ============ VIDEO DOCUMENTARY ============
    class VideoDocumentary {
        constructor(config, containerEl) {
            this.config = config;
            this.container = containerEl;
            this.currentLang = config.defaultLang || 'en';
            this.videos = {};
            this.currentIndex = -1;
            this.isPlaying = false;
            this.isTransitioning = false;
            this.onTimeUpdate = null;
            this.onSegmentChange = null;
            this.onEnd = null;
            this.onReady = null;
        }
        
        _getSegments() { return this.config.languages[this.currentLang].segments; }
        _getTotalDuration() { return this._getSegments().reduce((sum, s) => sum + s.duration, 0); }
        _getCumulativeStarts() {
            const starts = [0];
            let total = 0;
            this._getSegments().forEach(s => { total += s.duration; starts.push(total); });
            return starts;
        }
        
        async init() {
            await this._loadLanguage(this.currentLang);
            if (this.onReady) this.onReady();
        }
        
        async _loadLanguage(lang) {
            Object.values(this.videos).forEach(v => v.remove());
            this.videos = {};
            const segments = this.config.languages[lang].segments;
            await Promise.all(segments.map(seg => this._createVideo(seg, lang)));
            Object.values(this.videos).forEach(video => {
                video.addEventListener('ended', () => this._onVideoEnded());
            });
        }
        
        _createVideo(segment, lang) {
            return new Promise((resolve) => {
                const video = document.createElement('video');
                video.className = 'character-video';
                video.playsInline = true;
                video.preload = 'auto';
                video.src = `videos/${lang}/${segment.key}_talking.mp4`;
                video.addEventListener('canplaythrough', () => resolve(), { once: true });
                video.addEventListener('error', () => resolve());
                setTimeout(() => resolve(), 10000);
                video.load();
                this.videos[segment.key] = video;
                this.container.insertBefore(video, this.container.firstChild);
            });
        }
        
        async setLanguage(lang) {
            if (lang === this.currentLang) return;
            const wasPlaying = this.isPlaying;
            const savedIndex = this.currentIndex;
            this.pause();
            this.currentIndex = -1;
            this.currentLang = lang;
            await this._loadLanguage(lang);
            if (savedIndex >= 0) this.goToSegment(savedIndex, wasPlaying);
        }
        
        _onVideoEnded() {
            if (this.isTransitioning) return;
            const segments = this._getSegments();
            if (this.currentIndex < segments.length - 1) {
                this.goToSegment(this.currentIndex + 1, true);
            } else {
                this.isPlaying = false;
                if (this.onEnd) this.onEnd();
            }
        }
        
        goToSegment(index, autoplay = false) {
            const segments = this._getSegments();
            if (index < 0 || index >= segments.length || this.isTransitioning) return;
            this.isTransitioning = true;
            
            if (this.currentIndex >= 0) {
                const prev = this.videos[segments[this.currentIndex].key];
                if (prev) { prev.pause(); prev.classList.remove('active'); }
            }
            
            const segment = segments[index];
            const video = this.videos[segment.key];
            if (video) { video.currentTime = 0; video.classList.add('active'); }
            this.currentIndex = index;
            if (this.onSegmentChange) this.onSegmentChange(index, segment);
            
            setTimeout(() => {
                this.isTransitioning = false;
                if (autoplay || this.isPlaying) this.play();
            }, 150);
        }
        
        play() {
            if (this.currentIndex < 0) { this.goToSegment(0, true); return; }
            const video = this._currentVideo();
            if (video) { video.play().catch(() => {}); this.isPlaying = true; this._startUpdateLoop(); }
        }
        pause() { const video = this._currentVideo(); if (video) video.pause(); this.isPlaying = false; }
        toggle() { if (this.isPlaying) this.pause(); else this.play(); return this.isPlaying; }
        
        seek(globalTime) {
            const segments = this._getSegments();
            const starts = this._getCumulativeStarts();
            for (let i = 0; i < segments.length; i++) {
                if (globalTime < starts[i + 1]) {
                    const localTime = globalTime - starts[i];
                    if (i !== this.currentIndex) {
                        this.goToSegment(i, this.isPlaying);
                        setTimeout(() => {
                            const video = this.videos[segments[i].key];
                            if (video) video.currentTime = Math.max(0, localTime);
                        }, 200);
                    } else {
                        const video = this._currentVideo();
                        if (video) video.currentTime = Math.max(0, localTime);
                    }
                    return;
                }
            }
        }
        
        seekRelative(delta) { this.seek(Math.max(0, Math.min(this._getTotalDuration(), this.getCurrentTime() + delta))); }
        prev() { this.goToSegment(Math.max(0, this.currentIndex - 1), this.isPlaying); }
        next() { this.goToSegment(Math.min(this._getSegments().length - 1, this.currentIndex + 1), this.isPlaying); }
        getCurrentTime() { const v = this._currentVideo(); return (!v || this.currentIndex < 0) ? 0 : this._getCumulativeStarts()[this.currentIndex] + v.currentTime; }
        getLocalTime() { const v = this._currentVideo(); return v ? v.currentTime : 0; }
        _currentVideo() { return this.currentIndex < 0 ? null : this.videos[this._getSegments()[this.currentIndex].key]; }
        _startUpdateLoop() {
            const update = () => {
                if (!this.isPlaying) return;
                if (this.onTimeUpdate) this.onTimeUpdate(this.getCurrentTime(), this.getLocalTime(), this._getTotalDuration());
                requestAnimationFrame(update);
            };
            requestAnimationFrame(update);
        }
        reset() {
            this.pause();
            this.currentIndex = -1;
            Object.values(this.videos).forEach(v => { v.classList.remove('active'); v.currentTime = 0; });
        }
    }
    
    // ============ INIT ============
    const starfield = new Starfield(document.getElementById('starfield'));
    starfield.animate();
    
    const loadingEl = document.getElementById('loading');
    const overlayEl = document.getElementById('start-overlay');
    const mainEl = document.getElementById('main');
    const videoPanelEl = document.getElementById('videoPanel');
    const speakerNameEl = document.getElementById('speakerName');
    const speakerRoleEl = document.getElementById('speakerRole');
    const quoteEl = document.getElementById('quote');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');
    const timeDisplay = document.getElementById('timeDisplay');
    const navDotsContainer = document.getElementById('navDots');
    const langSelect = document.getElementById('langSelect');
    const langPicker = document.getElementById('langPicker');
    const controlsEl = document.getElementById('controls');
    const endingEl = document.getElementById('ending-overlay');
    const segmentIndicatorsEl = document.getElementById('segmentIndicators');
    
    CONFIG.languages.en.segments.forEach((seg, i) => {
        const dot = document.createElement('div');
        dot.className = 'nav-dot';
        dot.dataset.idx = i;
        dot.dataset.name = seg.name;
        navDotsContainer.appendChild(dot);
        
        const indicator = document.createElement('div');
        indicator.className = 'segment-indicator';
        indicator.dataset.idx = i;
        segmentIndicatorsEl.appendChild(indicator);
    });
    
    const navDots = navDotsContainer.querySelectorAll('.nav-dot');
    const segmentIndicators = segmentIndicatorsEl.querySelectorAll('.segment-indicator');
    const doc = new VideoDocumentary(CONFIG, videoPanelEl);
    
    function formatTime(s) { return `${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}`; }
    
    function getEmotionClass(word) {
        const clean = word.replace(/[.,!?;:'"]/g, '');
        const emotion = EMOTION_MAP[clean];
        return emotion ? `emotion-${emotion}` : '';
    }
    
    function buildWords(segment) {
        quoteEl.innerHTML = '';
        segment.words.forEach((w, i) => {
            const span = document.createElement('span');
            span.className = 'word';
            if (w.emotion) {
                const emotionClass = getEmotionClass(w.text);
                if (emotionClass) span.classList.add(emotionClass);
            }
            span.textContent = w.text;
            span.dataset.t = w.t;
            quoteEl.appendChild(span);
        });
    }
    
    function updateWords(localTime, duration) {
        const progress = localTime / duration;
        const wordEls = quoteEl.querySelectorAll('.word');
        wordEls.forEach((el, i) => {
            const t = parseFloat(el.dataset.t);
            const nextT = wordEls[i + 1] ? parseFloat(wordEls[i + 1].dataset.t) : 1;
            if (progress >= t) {
                el.classList.add('visible');
                el.classList.toggle('current', progress < nextT);
            } else {
                el.classList.remove('visible', 'current');
            }
        });
    }
    
    function updatePlayPauseIcon() {
        playIcon.style.display = doc.isPlaying ? 'none' : '';
        pauseIcon.style.display = doc.isPlaying ? '' : 'none';
    }
    
    function updateSegmentIndicators(idx) {
        segmentIndicators.forEach((ind, i) => {
            ind.classList.toggle('active', i === idx);
            ind.classList.toggle('completed', i < idx);
        });
    }
    
    doc.onReady = () => loadingEl.classList.add('hidden');
    
    doc.onSegmentChange = (index, segment) => {
        navDots.forEach((dot, i) => dot.classList.toggle('active', i === index));
        updateSegmentIndicators(index);
        speakerNameEl.classList.remove('visible');
        speakerRoleEl.classList.remove('visible');
        setTimeout(() => {
            speakerNameEl.textContent = segment.name;
            speakerRoleEl.textContent = segment.role;
            speakerNameEl.classList.add('visible');
            speakerRoleEl.classList.add('visible');
        }, 100);
        buildWords(segment);
    };
    
    doc.onTimeUpdate = (globalTime, localTime, totalDuration) => {
        progressBar.style.width = `${(globalTime / totalDuration) * 100}%`;
        timeDisplay.textContent = `${formatTime(globalTime)} / ${formatTime(totalDuration)}`;
        const segment = doc._getSegments()[doc.currentIndex];
        if (segment) updateWords(localTime, segment.duration);
    };
    
    doc.onEnd = () => { updatePlayPauseIcon(); endingEl.classList.add('visible'); controlsEl.classList.remove('visible'); navDotsContainer.classList.remove('visible'); };
    
    document.getElementById('replayBtn').addEventListener('click', () => {
        endingEl.classList.remove('visible');
        controlsEl.classList.add('visible');
        navDotsContainer.classList.add('visible');
        doc.reset();
        quoteEl.innerHTML = '';
        speakerNameEl.classList.remove('visible');
        speakerRoleEl.classList.remove('visible');
        updateSegmentIndicators(-1);
        setTimeout(() => { doc.goToSegment(0, true); updatePlayPauseIcon(); }, 300);
    });
    
    langSelect.addEventListener('change', async (e) => {
        loadingEl.classList.remove('hidden');
        await doc.setLanguage(e.target.value);
        loadingEl.classList.add('hidden');
    });
    
    document.getElementById('playPauseBtn').addEventListener('click', () => { doc.toggle(); updatePlayPauseIcon(); });
    document.getElementById('prevBtn').addEventListener('click', () => doc.prev());
    document.getElementById('nextBtn').addEventListener('click', () => doc.next());
    document.getElementById('rewindBtn').addEventListener('click', () => doc.seekRelative(-5));
    document.getElementById('forwardBtn').addEventListener('click', () => doc.seekRelative(5));
    
    progressContainer.addEventListener('click', (e) => {
        const rect = progressContainer.getBoundingClientRect();
        doc.seek((e.clientX - rect.left) / rect.width * doc._getTotalDuration());
    });
    
    segmentIndicators.forEach(ind => ind.addEventListener('click', () => {
        doc.goToSegment(parseInt(ind.dataset.idx), true);
        if (!doc.isPlaying) { doc.play(); updatePlayPauseIcon(); }
    }));
    
    navDots.forEach(dot => dot.addEventListener('click', () => {
        doc.goToSegment(parseInt(dot.dataset.idx), true);
        if (!doc.isPlaying) { doc.play(); updatePlayPauseIcon(); }
    }));
    
    document.addEventListener('keydown', (e) => {
        if (!overlayEl.classList.contains('hidden')) { startExperience(); return; }
        if (endingEl.classList.contains('visible')) {
            endingEl.classList.remove('visible');
            controlsEl.classList.add('visible');
            navDotsContainer.classList.add('visible');
            doc.reset();
            setTimeout(() => { doc.goToSegment(0, true); updatePlayPauseIcon(); }, 300);
            return;
        }
        switch(e.key) {
            case ' ': e.preventDefault(); doc.toggle(); updatePlayPauseIcon(); break;
            case 'ArrowRight': doc.seekRelative(5); break;
            case 'ArrowLeft': doc.seekRelative(-5); break;
            case 'ArrowUp': e.preventDefault(); doc.prev(); break;
            case 'ArrowDown': e.preventDefault(); doc.next(); break;
        }
    });
    
    function startExperience() {
        overlayEl.classList.add('hidden');
        mainEl.classList.add('active');
        controlsEl.classList.add('visible');
        navDotsContainer.classList.add('visible');
        langPicker.classList.add('visible');
        setTimeout(() => { doc.goToSegment(0, true); updatePlayPauseIcon(); }, 500);
    }
    
    overlayEl.addEventListener('click', startExperience);
    doc.init();
    </script>
</body>
</html>
