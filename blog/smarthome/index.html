<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Command ‚Äî A Smart Home Deep Dive</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚åò</text></svg>">
</head>
<body>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 1: THE HOOK
         Mood: Quiet drama. One command. Everything changes.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <section class="scene scene-hook">
        <div class="hook-container">
            
            <header class="hook-header">
                <span class="hook-eyebrow">A Technical Deep Dive</span>
                <h1 class="hook-title">One Command</h1>
                <p class="hook-subtitle">
                    How I unified twenty-five vendor integrations into a single function<br>
                    that orchestrates lights, shades, locks, and audio in parallel.
                </p>
            </header>

            <div class="terminal">
                <div class="terminal-chrome">
                    <span class="terminal-dot"></span>
                    <span class="terminal-dot"></span>
                    <span class="terminal-dot"></span>
                </div>
                <div class="terminal-screen">
                    <div class="terminal-line">
                        <span class="terminal-prompt">‚Üí</span>
                        <span class="terminal-command">await controller.goodnight()</span>
                    </div>
                    <div class="terminal-output">
                        <div class="output-item" style="--delay: 0.2s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">41 lights fading to zero</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.4s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">11 shades descending</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.6s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">2 locks engaging</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.8s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">Fireplace extinguishing</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 1.0s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">Security arming</span>
                            <span class="output-check">‚úì</span>
                        </div>
                    </div>
                    <div class="terminal-result">
                        <span class="result-time">‚úì done</span>
                    </div>
                </div>
            </div>

            <div class="hook-scroll">
                <span>How?</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 5v14m-7-7l7 7 7-7"/>
                </svg>
            </div>
            
        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 2: THE PROBLEM
         Mood: Chaos. Frustration. Eighteen incompatible worlds.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-problem">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">I</span>
                <h2 class="scene-title">The Problem</h2>
            </div>

            <div class="problem-content">
                <p class="problem-lead">
                    Twenty-five integrations. Dozens of authentication flows. Each with 
                    its own assumptions about how the world should work.
                </p>

                <div class="chaos-visualization">
                    <div class="chaos-center">
                        <span>Your Home</span>
                    </div>
                    <div class="chaos-orbit orbit-1">
                        <div class="chaos-node" style="--angle: 0deg">
                            <span class="node-name">Control4</span>
                            <span class="node-pain">24h tokens</span>
                        </div>
                        <div class="chaos-node" style="--angle: 60deg">
                            <span class="node-name">UniFi</span>
                            <span class="node-pain">Binary WebSocket</span>
                        </div>
                        <div class="chaos-node" style="--angle: 120deg">
                            <span class="node-name">Tesla</span>
                            <span class="node-pain">Fleet API migration</span>
                        </div>
                        <div class="chaos-node" style="--angle: 180deg">
                            <span class="node-name">Eight Sleep</span>
                            <span class="node-pain">Undocumented</span>
                        </div>
                        <div class="chaos-node" style="--angle: 240deg">
                            <span class="node-name">Denon</span>
                            <span class="node-pain">Input name chaos</span>
                        </div>
                        <div class="chaos-node" style="--angle: 300deg">
                            <span class="node-name">August</span>
                            <span class="node-pain">Rate limits</span>
                        </div>
                    </div>
                    <div class="chaos-orbit orbit-2">
                        <div class="chaos-node" style="--angle: 30deg">
                            <span class="node-name">Mitsubishi</span>
                        </div>
                        <div class="chaos-node" style="--angle: 90deg">
                            <span class="node-name">Spotify</span>
                        </div>
                        <div class="chaos-node" style="--angle: 150deg">
                            <span class="node-name">LG TV</span>
                        </div>
                        <div class="chaos-node" style="--angle: 210deg">
                            <span class="node-name">Samsung</span>
                        </div>
                        <div class="chaos-node" style="--angle: 270deg">
                            <span class="node-name">Oelo</span>
                        </div>
                        <div class="chaos-node" style="--angle: 330deg">
                            <span class="node-name">Weather</span>
                        </div>
                    </div>
                    <svg class="chaos-lines" viewBox="0 0 600 600">
                        <!-- Lines drawn by JS -->
                    </svg>
                </div>

                <blockquote class="problem-quote">
                    Each vendor assumes they're the center of your universe.
                </blockquote>

                <p class="problem-text">
                    The "smart" home industry's dirty secret: nothing talks to anything else. 
                    Every company builds their own app, their own cloud, their own walled garden. 
                    They don't want interoperability. They want lock-in.
                </p>

                <p class="problem-text">
                    I wanted something different. One command to orchestrate everything. 
                    Not through a cloud service that could disappear tomorrow. 
                    Not through Home Assistant (which is excellent, but I wanted to understand 
                    every byte flowing through my network). Direct API access. Full control.
                </p>
            </div>
            
        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 3: THE ARCHITECTURE
         Mood: Clarity. Elegance emerging from chaos.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-architecture">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">II</span>
                <h2 class="scene-title">The Architecture</h2>
            </div>

            <p class="arch-lead">
                A singleton controller. Every integration behind a unified interface. 
                Failure assumed. Redundancy everywhere.
            </p>

            <figure class="arch-diagram">
                <div class="arch-layer arch-top">
                    <div class="arch-box arch-controller">
                        <span class="arch-label">SmartHomeController</span>
                        <span class="arch-sublabel">singleton ¬∑ full authority</span>
                    </div>
                </div>

                <div class="arch-connector"></div>

                <div class="arch-layer arch-services">
                    <div class="arch-box">
                        <span class="arch-label">Orchestrator</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">Presence</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">Failover</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">Safety</span>
                    </div>
                </div>

                <div class="arch-connector"></div>

                <div class="arch-layer arch-tiers">
                    <div class="arch-tier tier-critical">
                        <span class="tier-name">Critical</span>
                        <span class="tier-desc">Security ¬∑ Safety</span>
                    </div>
                    <div class="arch-tier tier-high">
                        <span class="tier-name">High</span>
                        <span class="tier-desc">Lighting ¬∑ HVAC</span>
                    </div>
                    <div class="arch-tier tier-medium">
                        <span class="tier-name">Medium</span>
                        <span class="tier-desc">Audio ¬∑ Video</span>
                    </div>
                    <div class="arch-tier tier-low">
                        <span class="tier-name">Low</span>
                        <span class="tier-desc">Appliances</span>
                    </div>
                </div>
            </figure>

            <div class="arch-insight">
                <h3>The Key Insight</h3>
                <p>
                    Every integration will fail. The question isn't <em>if</em>, it's <em>when</em>. 
                    So the system assumes failure as the default state and builds redundancy at every layer.
                </p>
                <p>
                    If Control4 goes down, lighting degrades to direct Lutron LEAP. 
                    If UniFi fails, presence falls back to Tesla geofencing, then August door sensors, 
                    then Eight Sleep bed detection. There's always another path.
                </p>
            </div>

            <figure class="code-figure">
                <figcaption>failover_manager.py</figcaption>
                <pre><code>FAILOVER_ROUTES = {
    <span class="code-string">"presence"</span>: [
        <span class="code-string">"unifi"</span>,        <span class="code-comment"># WiFi + cameras</span>
        <span class="code-string">"tesla"</span>,        <span class="code-comment"># Geofencing</span>
        <span class="code-string">"august"</span>,       <span class="code-comment"># Door sensors</span>
        <span class="code-string">"eight_sleep"</span>, <span class="code-comment"># Bed occupancy</span>
    ],
    <span class="code-string">"lighting"</span>: [
        <span class="code-string">"control4"</span>,     <span class="code-comment"># Director API</span>
        <span class="code-string">"lutron_leap"</span>, <span class="code-comment"># Direct LEAP</span>
    ],
}</code></pre>
            </figure>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 4: CONTROL4 DEEP DIVE
         Mood: Getting hands dirty. The first integration.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-integration">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">III</span>
                <h2 class="scene-title">Control4</h2>
                <p class="scene-subtitle">The heart of the system</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">41</span>
                    <span class="stat-unit">lights</span>
                </div>
                <div class="stat">
                    <span class="stat-value">11</span>
                    <span class="stat-unit">shades</span>
                </div>
                <div class="stat">
                    <span class="stat-value">26</span>
                    <span class="stat-unit">audio zones</span>
                </div>
                <div class="stat">
                    <span class="stat-value">2</span>
                    <span class="stat-unit">locks</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>The Challenge</h3>
                <p>
                    Control4 is professional-grade home automation. They really don't want 
                    you accessing it directly. The official path: mobile app ‚Üí their cloud ‚Üí 
                    your local Director. I wanted direct local control. No cloud dependency. 
                    Sub-100ms response times.
                </p>

                <h3>The Token Dance</h3>
                <p>
                    The Director exposes a REST API, but only with a valid bearer token. 
                    Getting that token requires a three-step authentication dance through 
                    their cloud. The token expires every 24 hours.
                </p>

                <figure class="code-figure">
                    <figcaption>control4.py</figcaption>
                    <pre><code><span class="code-keyword">async def</span> <span class="code-function">_authenticate</span>(self) -> Control4Token:
    <span class="code-comment"># Step 1: Cloud authentication</span>
    account_token = <span class="code-keyword">await</span> self._cloud_auth()
    
    <span class="code-comment"># Step 2: Controller authorization</span>
    controller = <span class="code-keyword">await</span> self._get_controllers(account_token)
    
    <span class="code-comment"># Step 3: Director token exchange</span>
    director_token = <span class="code-keyword">await</span> self._get_director_token(
        account_token,
        controller[<span class="code-string">"controllerCommonName"</span>]
    )
    
    <span class="code-comment"># Valid for ~24 hours</span>
    <span class="code-keyword">return</span> Control4Token(
        director_token=director_token,
        expires_at=time.time() + <span class="code-number">86400</span>
    )</code></pre>
                </figure>

                <h3>Device ID Archaeology</h3>
                <p>
                    Control4 uses internal integer IDs that aren't documented anywhere. 
                    Light 62 is the living room cans. Shade 66 is the primary bedroom north window. 
                    I had to enumerate all items, categorize by type, and manually map them to rooms. 
                    The <code>_items</code> dictionary now contains 200+ device mappings 
                    built from trial and error.
                </p>
            </div>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 5: UNIFI DEEP DIVE
         Mood: Reverse engineering. Binary protocols.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-integration scene-alt">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">IV</span>
                <h2 class="scene-title">UniFi Protect</h2>
                <p class="scene-subtitle">Real-time presence through binary WebSocket</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">4</span>
                    <span class="stat-unit">AI cameras</span>
                </div>
                <div class="stat">
                    <span class="stat-value">UDM</span>
                    <span class="stat-unit">Pro Max</span>
                </div>
                <div class="stat">
                    <span class="stat-value">22TB</span>
                    <span class="stat-unit">NVR storage</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>The Challenge</h3>
                <p>
                    UniFi Protect's WebSocket API uses a custom binary protocol. 
                    The documentation doesn't exist. I had to reverse-engineer the frame 
                    format by watching network traffic.
                </p>

                <figure class="protocol-figure">
                    <div class="protocol-frame">
                        <div class="frame-section">
                            <span class="frame-label">Header</span>
                            <span class="frame-size">8 bytes</span>
                        </div>
                        <div class="frame-fields">
                            <span>packet_type</span>
                            <span>payload_format</span>
                            <span>deflated</span>
                            <span>payload_size</span>
                        </div>
                    </div>
                    <span class="protocol-arrow">‚Üí</span>
                    <div class="protocol-frame">
                        <div class="frame-section">
                            <span class="frame-label">Action</span>
                        </div>
                        <div class="frame-fields">
                            <span>action</span>
                            <span>modelKey</span>
                            <span>id</span>
                        </div>
                    </div>
                    <span class="protocol-arrow">‚Üí</span>
                    <div class="protocol-frame">
                        <div class="frame-section">
                            <span class="frame-label">Data</span>
                        </div>
                        <div class="frame-fields">
                            <span>JSON payload</span>
                        </div>
                    </div>
                </figure>

                <figure class="code-figure">
                    <figcaption>unifi.py</figcaption>
                    <pre><code><span class="code-keyword">def</span> <span class="code-function">_parse_ws_frame</span>(self, data: bytes) -> dict:
    <span class="code-comment"># Unpack 8-byte header</span>
    packet_type = data[<span class="code-number">0</span>]
    payload_format = data[<span class="code-number">1</span>]
    deflated = data[<span class="code-number">2</span>]
    payload_size = struct.unpack(<span class="code-string">"&gt;I"</span>, data[<span class="code-number">4</span>:<span class="code-number">8</span>])[<span class="code-number">0</span>]
    
    payload = data[<span class="code-number">8</span>:<span class="code-number">8</span> + payload_size]
    
    <span class="code-keyword">if</span> deflated:
        payload = zlib.decompress(payload)
    
    <span class="code-keyword">return</span> json.loads(payload)</code></pre>
                </figure>

                <p class="integration-win">
                    Motion events now arrive via WebSocket instead of polling. 
                    The system can react to motion as it happens, not seconds later.
                </p>
            </div>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 6: THEORY OF MIND
         Mood: Intelligence. The system learns.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-mind">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">V</span>
                <h2 class="scene-title">Theory of Mind</h2>
                <p class="scene-subtitle">The system doesn't just see. It understands.</p>
            </div>

            <div class="mind-progression">
                <div class="mind-stage">
                    <span class="mind-number">1</span>
                    <span class="mind-question">Where?</span>
                    <p>Sensor fusion across WiFi, cameras, motion, bed, car</p>
                </div>
                <div class="mind-arrow">‚Üí</div>
                <div class="mind-stage">
                    <span class="mind-number">2</span>
                    <span class="mind-question">What?</span>
                    <p>Activity inference from location + time + duration</p>
                </div>
                <div class="mind-arrow">‚Üí</div>
                <div class="mind-stage">
                    <span class="mind-number">3</span>
                    <span class="mind-question">Why?</span>
                    <p>Intent prediction from learned patterns</p>
                </div>
                <div class="mind-arrow">‚Üí</div>
                <div class="mind-stage">
                    <span class="mind-number">4</span>
                    <span class="mind-question">Next?</span>
                    <p>Anticipate needs before you know them</p>
                </div>
            </div>

            <div class="mind-content">
                <h3>Pattern Learning</h3>
                <p>
                    The presence engine maintains a probability distribution over room occupancy 
                    for each 30-minute time slot. After a few weeks, it knows that at 7:30am on 
                    a weekday, there's a 94% chance you're in the kitchen.
                </p>

                <figure class="code-figure">
                    <figcaption>presence.py</figcaption>
                    <pre><code><span class="code-keyword">def</span> <span class="code-function">predict_next_room</span>(self) -> tuple[str, float]:
    slot = TimeSlot.current()
    pattern = self.patterns[slot]
    
    <span class="code-comment"># Most likely room given current time</span>
    probs = pattern.room_probabilities
    best = max(probs, key=probs.get)
    confidence = probs[best] / pattern.samples
    
    <span class="code-keyword">return</span> best, confidence</code></pre>
                </figure>

                <h3>Activity Context</h3>
                <p>
                    Room + time + duration maps to activity. The system doesn't need explicit 
                    "I'm cooking" declarations ‚Äî it infers from behavior.
                </p>

                <figure class="context-table">
                    <div class="context-row context-header">
                        <span>Room</span>
                        <span>Time</span>
                        <span>Duration</span>
                        <span>Activity</span>
                    </div>
                    <div class="context-row">
                        <span>Kitchen</span>
                        <span>6‚Äì9am</span>
                        <span>15‚Äì30min</span>
                        <span class="context-activity">COOKING</span>
                    </div>
                    <div class="context-row">
                        <span>Office</span>
                        <span>9am‚Äì5pm</span>
                        <span>&gt; 30min</span>
                        <span class="context-activity">WORKING</span>
                    </div>
                    <div class="context-row">
                        <span>Living Room</span>
                        <span>7‚Äì11pm</span>
                        <span>&gt; 20min</span>
                        <span class="context-activity">RELAXING</span>
                    </div>
                    <div class="context-row">
                        <span>Primary Bed</span>
                        <span>10pm‚Äì7am</span>
                        <span>&gt; 15min</span>
                        <span class="context-activity">SLEEPING</span>
                    </div>
                </figure>
            </div>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 7: PERFORMANCE
         Mood: Speed. Precision. The numbers matter.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-performance">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">VI</span>
                <h2 class="scene-title">Performance</h2>
            </div>

            <div class="perf-hero">
                <div class="perf-number">
                    <span class="perf-value">Parallel</span>
                </div>
                <p class="perf-context">Independent operations run concurrently, not sequentially.</p>
            </div>

            <div class="perf-content">
                <h3>Parallel Execution</h3>
                <p>
                    Scene activation doesn't wait for each device sequentially. 
                    Independent operations run in parallel, with dependencies executed 
                    in topological order.
                </p>

                <figure class="timeline-figure">
                    <div class="timeline-track">
                        <div class="timeline-row">
                            <span class="timeline-label">Shades</span>
                            <div class="timeline-bar" style="--start: 0; --width: 70"></div>
                        </div>
                        <div class="timeline-row">
                            <span class="timeline-label">HVAC</span>
                            <div class="timeline-bar" style="--start: 0; --width: 45"></div>
                        </div>
                        <div class="timeline-row">
                            <span class="timeline-label">Lights</span>
                            <div class="timeline-bar" style="--start: 5; --width: 55"></div>
                        </div>
                        <div class="timeline-row">
                            <span class="timeline-label">Audio</span>
                            <div class="timeline-bar" style="--start: 10; --width: 60"></div>
                        </div>
                    </div>
                    <div class="timeline-scale">
                        <span></span>
                        <span></span>
                        <span>Parallel execution</span>
                        <span></span>
                        <span></span>
                    </div>
                </figure>

                <h3>Circuit Breakers</h3>
                <p>
                    Each integration has a circuit breaker that trips after 3 consecutive failures. 
                    The breaker stays open for 60 seconds before allowing a retry. 
                    One failing integration can't block the entire system.
                </p>
            </div>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 8: SAFETY
         Mood: Responsibility. The invariant that protects everything.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-safety">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">VII</span>
                <h2 class="scene-title">Safety</h2>
            </div>

            <div class="safety-hero">
                <div class="safety-formula">h(x) ‚â• 0</div>
                <p class="safety-meaning">Always.</p>
            </div>

            <div class="safety-content">
                <p>
                    Some actions have consequences. The fireplace can start a fire. 
                    The TV mount can crush something. The locks have security implications. 
                    Every physical action passes through a safety module that evaluates 
                    a Control Barrier Function. If h(x) drops below zero, the action is blocked.
                </p>

                <div class="safety-rules">
                    <div class="safety-rule">
                        <span class="rule-icon">üî•</span>
                        <div class="rule-content">
                            <span class="rule-name">Fireplace</span>
                            <span class="rule-constraint">Auto-off after 4 hours</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">üì∫</span>
                        <div class="rule-content">
                            <span class="rule-name">TV Mount</span>
                            <span class="rule-constraint">Preset positions only</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">üîì</span>
                        <div class="rule-content">
                            <span class="rule-name">Unlock</span>
                            <span class="rule-constraint">Requires presence confirmation</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">‚ùÑÔ∏è</span>
                        <div class="rule-content">
                            <span class="rule-name">HVAC</span>
                            <span class="rule-constraint">60‚Äì85¬∞F range enforced</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 9: THE YAK SHAVES
         Mood: Honesty. The real work behind the work.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-yaks">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">VIII</span>
                <h2 class="scene-title">The Yak Shaves</h2>
                <p class="scene-subtitle">Every project has moments where you find yourself<br>three levels deep in something unrelated.</p>
            </div>

            <div class="yak-list">
                
                <article class="yak">
                    <h3>The Control4 Token Dance</h3>
                    <p>
                        To control my own lights, I need a bearer token. To get the token, 
                        I authenticate with Control4's cloud. The cloud returns an account token. 
                        I exchange that for a controller token. Then I get a director token. 
                        The director token expires in 24 hours. The refresh flow requires 
                        the entire dance again.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Token management is its own microservice.
                    </p>
                </article>

                <article class="yak">
                    <h3>UniFi Local Admin Discovery</h3>
                    <p>
                        UniFi's 2FA flow makes automation painful. After days of frustration, 
                        I discovered you can create a local-only admin account on the UDM Pro 
                        that bypasses 2FA entirely. This isn't documented anywhere obvious.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Enterprise features often have escape hatches.
                    </p>
                </article>

                <article class="yak">
                    <h3>Tesla Fleet API Migration</h3>
                    <p>
                        My working Tesla integration suddenly stopped. Tesla had deprecated 
                        the Vehicle API. The new Fleet API requires registering as a "partner," 
                        which means hosting a public key at a specific URL path on a verified domain. 
                        For a personal project.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> APIs you don't control can change overnight.
                    </p>
                </article>

                <article class="yak">
                    <h3>Denon Input Source Archaeology</h3>
                    <p>
                        The Denon API accepts input names like "MPLAY" and "SAT/CBL". 
                        The UI shows "Apple TV" and "Cable". There's no mapping documentation. 
                        I literally tried every combination of input names and recorded which ones worked.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Sometimes the only documentation is experimentation.
                    </p>
                </article>

            </div>

        </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCENE 10: CLOSING
         Mood: Satisfaction. The promise fulfilled.
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <section class="scene scene-closing">
        <div class="scene-container">
            
            <div class="closing-content">
                <p class="closing-lead">
                    The house thinks now.
                </p>
                <p class="closing-text">
                    It knows when I'm home, what I'm doing, and what I might need next. 
                    One command orchestrates lights, shades, locks, and audio together. 
                    And when something fails ‚Äî and it will ‚Äî the system routes around it.
                </p>
                <p class="closing-coda">
                    That's not magic. That's just good engineering.
                </p>
            </div>

            <footer class="closing-footer">
                <a href="/art/home/" class="footer-link">See the house ‚Üí</a>
                <span class="footer-divider">¬∑</span>
                <span class="footer-location">Seattle ¬∑ Built December 29‚Äì30, 2025</span>
            </footer>

        </div>
    </section>

    <script src="js/main.js"></script>
</body>
</html>
