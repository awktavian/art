<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Command — A Smart Home Deep Dive</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⌘</text></svg>">
</head>
<body>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 1: THE HOOK
         Mood: Quiet drama. One command. Everything changes.
         ═══════════════════════════════════════════════════════════════════════ -->
    
    <section class="scene scene-hook">
        <div class="hook-container">
            
            <header class="hook-header">
                <span class="hook-eyebrow">A Technical Deep Dive</span>
                <h1 class="hook-title">One Command</h1>
                <p class="hook-subtitle">
                    How I unified nine physical integrations and ten digital services<br>
                    into a single function that orchestrates in parallel.
                </p>
            </header>

            <div class="terminal">
                <div class="terminal-chrome">
                    <span class="terminal-dot"></span>
                    <span class="terminal-dot"></span>
                    <span class="terminal-dot"></span>
                </div>
                <div class="terminal-screen">
                    <div class="terminal-line">
                        <span class="terminal-prompt">→</span>
                        <span class="terminal-command">await controller.goodnight()</span>
                    </div>
                    <div class="terminal-output">
                        <div class="output-item" style="--delay: 0.1s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">Control4: 41 lights fading</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.2s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">Control4: 11 shades closing</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.3s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">August: 2 locks engaging</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.4s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">Control4: Fireplace off</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.5s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">Denon: Audio muting</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.6s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">Mitsubishi: Night setback</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.7s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">LG TV: Screen off</span>
                            <span class="output-check">✓</span>
                        </div>
                        <div class="output-item" style="--delay: 0.8s">
                            <span class="output-icon">◐</span>
                            <span class="output-text">Oelo: Outdoor lights off</span>
                            <span class="output-check">✓</span>
                        </div>
                    </div>
                    <div class="terminal-result">
                        <span class="result-time">✓ 8 integrations · parallel</span>
                    </div>
                </div>
            </div>

            <div class="hook-scroll">
                <span>How?</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 5v14m-7-7l7 7 7-7"/>
                </svg>
            </div>
            
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 2: THE PROBLEM
         Mood: Chaos. Frustration. Protocol anarchy.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-problem">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">I</span>
                <h2 class="scene-title">The Problem</h2>
            </div>

            <div class="problem-content">
                <p class="problem-lead">
                    Nine physical integrations. Ten digital services. Each with its own protocol,
                    authentication dance, and assumptions about reality.
                </p>

                <div class="chaos-visualization">
                    <div class="chaos-center">
                        <span>Your Home</span>
                    </div>
                    <div class="chaos-orbit orbit-1">
                        <div class="chaos-node" style="--angle: 0deg">
                            <span class="node-name">Control4</span>
                            <span class="node-pain">24h token expiry</span>
                        </div>
                        <div class="chaos-node" style="--angle: 51deg">
                            <span class="node-name">UniFi</span>
                            <span class="node-pain">Binary WebSocket</span>
                        </div>
                        <div class="chaos-node" style="--angle: 102deg">
                            <span class="node-name">Denon</span>
                            <span class="node-pain">Telnet port 23</span>
                        </div>
                        <div class="chaos-node" style="--angle: 153deg">
                            <span class="node-name">Tesla</span>
                            <span class="node-pain">Fleet API SSE</span>
                        </div>
                        <div class="chaos-node" style="--angle: 204deg">
                            <span class="node-name">Mitsubishi</span>
                            <span class="node-pain">Kumo Cloud V3</span>
                        </div>
                        <div class="chaos-node" style="--angle: 255deg">
                            <span class="node-name">August</span>
                            <span class="node-pain">Rate limits</span>
                        </div>
                        <div class="chaos-node" style="--angle: 306deg">
                            <span class="node-name">Formlabs</span>
                            <span class="node-pain">Local REST</span>
                        </div>
                    </div>
                    <div class="chaos-orbit orbit-2">
                        <div class="chaos-node" style="--angle: 30deg">
                            <span class="node-name">Gmail</span>
                        </div>
                        <div class="chaos-node" style="--angle: 66deg">
                            <span class="node-name">Slack</span>
                        </div>
                        <div class="chaos-node" style="--angle: 102deg">
                            <span class="node-name">Calendar</span>
                        </div>
                        <div class="chaos-node" style="--angle: 138deg">
                            <span class="node-name">Linear</span>
                        </div>
                        <div class="chaos-node" style="--angle: 174deg">
                            <span class="node-name">Todoist</span>
                        </div>
                        <div class="chaos-node" style="--angle: 210deg">
                            <span class="node-name">Notion</span>
                        </div>
                        <div class="chaos-node" style="--angle: 246deg">
                            <span class="node-name">Drive</span>
                        </div>
                        <div class="chaos-node" style="--angle: 282deg">
                            <span class="node-name">Sheets</span>
                        </div>
                        <div class="chaos-node" style="--angle: 318deg">
                            <span class="node-name">Discord</span>
                        </div>
                        <div class="chaos-node" style="--angle: 354deg">
                            <span class="node-name">Twitter</span>
                        </div>
                    </div>
                    <svg class="chaos-lines" viewBox="0 0 600 600">
                        <!-- Lines drawn by JS -->
                    </svg>
                </div>

                <blockquote class="problem-quote">
                    Each vendor assumes they're the center of your universe.
                </blockquote>

                <p class="problem-text">
                    The "smart" home industry's dirty secret: nothing talks to anything else. 
                    Control4 speaks REST with proprietary tokens. UniFi uses binary WebSocket frames.
                    Denon accepts raw telnet commands on port 23. Tesla migrated to Fleet SSE.
                    Mitsubishi hides behind Kumo Cloud. Every company builds their own walled garden.
                </p>

                <p class="problem-text">
                    I wanted something different. One command to orchestrate everything. 
                    Not through a cloud service that could disappear tomorrow. 
                    Not through Home Assistant (which is excellent, but I wanted to understand 
                    every byte flowing through my network). Direct API access. Full control.
                </p>
            </div>
            
        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 3: THE ARCHITECTURE
         Mood: Clarity. Elegance emerging from chaos.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-architecture">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">II</span>
                <h2 class="scene-title">The Architecture</h2>
            </div>

            <p class="arch-lead">
                A singleton controller. Room-centric design. Every integration behind a unified interface. 
                Failure assumed. Redundancy everywhere.
            </p>

            <figure class="arch-diagram">
                <div class="arch-layer arch-top">
                    <div class="arch-box arch-controller">
                        <span class="arch-label">SmartHomeController</span>
                        <span class="arch-sublabel">singleton · 26 rooms · full authority</span>
                    </div>
                </div>

                <div class="arch-connector"></div>

                <div class="arch-layer arch-services">
                    <div class="arch-box">
                        <span class="arch-label">RoomOrchestrator</span>
                        <span class="arch-sublabel">scene activation</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">PresenceEngine</span>
                        <span class="arch-sublabel">Theory of Mind</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">FailoverManager</span>
                        <span class="arch-sublabel">circuit breakers</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">CBFEnforcer</span>
                        <span class="arch-sublabel">h(x) ≥ 0</span>
                    </div>
                </div>

                <div class="arch-connector"></div>

                <div class="arch-layer arch-tiers">
                    <div class="arch-tier tier-critical">
                        <span class="tier-name">Critical</span>
                        <span class="tier-desc">Locks · Security · Safety</span>
                    </div>
                    <div class="arch-tier tier-high">
                        <span class="tier-name">High</span>
                        <span class="tier-desc">Lighting · HVAC · Presence</span>
                    </div>
                    <div class="arch-tier tier-medium">
                        <span class="tier-name">Medium</span>
                        <span class="tier-desc">Audio · Video · Shades</span>
                    </div>
                    <div class="arch-tier tier-low">
                        <span class="tier-name">Low</span>
                        <span class="tier-desc">Appliances · Fabrication</span>
                    </div>
                </div>
            </figure>

            <div class="arch-insight">
                <h3>The Key Insight</h3>
                <p>
                    Every integration will fail. The question isn't <em>if</em>, it's <em>when</em>. 
                    So the system assumes failure as the default state and builds redundancy at every layer.
                </p>
                <p>
                    If Control4 goes down, lighting degrades to direct Lutron LEAP. 
                    If UniFi fails, presence falls back to Tesla geofencing, then August door sensors. 
                    There's always another path.
                </p>
            </div>

            <figure class="code-figure">
                <figcaption>failover_manager.py</figcaption>
                <pre><code>FAILOVER_ROUTES = {
    <span class="code-string">"presence"</span>: [
        <span class="code-string">"unifi"</span>,        <span class="code-comment"># WiFi + cameras (primary)</span>
        <span class="code-string">"tesla"</span>,        <span class="code-comment"># Vehicle geofencing</span>
        <span class="code-string">"august"</span>,       <span class="code-comment"># Door activity</span>
    ],
    <span class="code-string">"lighting"</span>: [
        <span class="code-string">"control4"</span>,     <span class="code-comment"># Director API</span>
        <span class="code-string">"lutron_leap"</span>, <span class="code-comment"># Direct LEAP fallback</span>
    ],
    <span class="code-string">"climate"</span>: [
        <span class="code-string">"mitsubishi"</span>,  <span class="code-comment"># Kumo Cloud V3</span>
        <span class="code-string">"control4"</span>,     <span class="code-comment"># Thermostat backup</span>
    ],
}</code></pre>
            </figure>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 4: CONTROL4 DEEP DIVE
         Mood: Getting hands dirty. The heart of the system.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-integration">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">III</span>
                <h2 class="scene-title">Control4</h2>
                <p class="scene-subtitle">The heart of the system</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">41</span>
                    <span class="stat-unit">lights</span>
                </div>
                <div class="stat">
                    <span class="stat-value">11</span>
                    <span class="stat-unit">shades</span>
                </div>
                <div class="stat">
                    <span class="stat-value">26</span>
                    <span class="stat-unit">audio zones</span>
                </div>
                <div class="stat">
                    <span class="stat-value">2</span>
                    <span class="stat-unit">locks</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>The Challenge</h3>
                <p>
                    Control4 is professional-grade home automation. They really don't want 
                    you accessing it directly. The official path: mobile app → their cloud → 
                    your local Director. I wanted direct local control. No cloud dependency. 
                    Sub-100ms response times.
                </p>

                <h3>The Token Dance</h3>
                <p>
                    The Director exposes a REST API, but only with a valid bearer token. 
                    Getting that token requires a three-step authentication dance through 
                    their cloud. The token expires every 24 hours.
                </p>

                <figure class="code-figure">
                    <figcaption>control4.py</figcaption>
                    <pre><code><span class="code-keyword">async def</span> <span class="code-function">_authenticate</span>(self) -> Control4Token:
    <span class="code-comment"># Step 1: Cloud authentication</span>
    account_token = <span class="code-keyword">await</span> self._cloud_auth()
    
    <span class="code-comment"># Step 2: Controller authorization</span>
    controller = <span class="code-keyword">await</span> self._get_controllers(account_token)
    
    <span class="code-comment"># Step 3: Director token exchange</span>
    director_token = <span class="code-keyword">await</span> self._get_director_token(
        account_token,
        controller[<span class="code-string">"controllerCommonName"</span>]
    )
    
    <span class="code-comment"># Valid for ~24 hours</span>
    <span class="code-keyword">return</span> Control4Token(
        director_token=director_token,
        expires_at=time.time() + <span class="code-number">86400</span>
    )</code></pre>
                </figure>

                <h3>Device ID Archaeology</h3>
                <p>
                    Control4 uses internal integer IDs that aren't documented anywhere. 
                    Light 239 is the living room cans. Shade 66 is the primary bedroom north window. 
                    Room 57 is the Living Room. I had to enumerate all items, categorize by type, 
                    and manually map them to rooms. The <code>_items</code> dictionary now contains 
                    200+ device mappings built from trial and error.
                </p>

                <h3>Real-Time WebSocket</h3>
                <p>
                    Beyond REST, Control4 offers WebSocket for real-time events. Device state changes,
                    button presses, security events—all arrive within milliseconds. The connection
                    requires the same bearer token and periodic keep-alives.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 5: UNIFI DEEP DIVE
         Mood: Reverse engineering. Binary protocols.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-integration scene-alt">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">IV</span>
                <h2 class="scene-title">UniFi Protect</h2>
                <p class="scene-subtitle">Real-time presence through binary WebSocket</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">4</span>
                    <span class="stat-unit">AI cameras</span>
                </div>
                <div class="stat">
                    <span class="stat-value">UDM</span>
                    <span class="stat-unit">Pro Max</span>
                </div>
                <div class="stat">
                    <span class="stat-value">22TB</span>
                    <span class="stat-unit">NVR storage</span>
                </div>
                <div class="stat">
                    <span class="stat-value">38</span>
                    <span class="stat-unit">WiFi clients</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>The Challenge</h3>
                <p>
                    UniFi Protect's WebSocket API uses a custom binary protocol. 
                    The documentation doesn't exist. I had to reverse-engineer the frame 
                    format by watching network traffic.
                </p>

                <figure class="protocol-figure">
                    <div class="protocol-frame">
                        <div class="frame-section">
                            <span class="frame-label">Header</span>
                            <span class="frame-size">8 bytes</span>
                        </div>
                        <div class="frame-fields">
                            <span>packet_type</span>
                            <span>payload_format</span>
                            <span>deflated</span>
                            <span>payload_size</span>
                        </div>
                    </div>
                    <span class="protocol-arrow">→</span>
                    <div class="protocol-frame">
                        <div class="frame-section">
                            <span class="frame-label">Action</span>
                        </div>
                        <div class="frame-fields">
                            <span>action</span>
                            <span>modelKey</span>
                            <span>id</span>
                        </div>
                    </div>
                    <span class="protocol-arrow">→</span>
                    <div class="protocol-frame">
                        <div class="frame-section">
                            <span class="frame-label">Data</span>
                        </div>
                        <div class="frame-fields">
                            <span>JSON payload</span>
                        </div>
                    </div>
                </figure>

                <figure class="code-figure">
                    <figcaption>unifi.py</figcaption>
                    <pre><code><span class="code-keyword">def</span> <span class="code-function">_parse_ws_frame</span>(self, data: bytes) -> dict:
    <span class="code-comment"># Unpack 8-byte header</span>
    packet_type = data[<span class="code-number">0</span>]
    payload_format = data[<span class="code-number">1</span>]
    deflated = data[<span class="code-number">2</span>]
    payload_size = struct.unpack(<span class="code-string">"&gt;I"</span>, data[<span class="code-number">4</span>:<span class="code-number">8</span>])[<span class="code-number">0</span>]
    
    payload = data[<span class="code-number">8</span>:<span class="code-number">8</span> + payload_size]
    
    <span class="code-keyword">if</span> deflated:
        payload = zlib.decompress(payload)
    
    <span class="code-keyword">return</span> json.loads(payload)</code></pre>
                </figure>

                <h3>Local Admin Discovery</h3>
                <p>
                    UniFi's 2FA flow makes automation painful. After days of frustration, 
                    I discovered you can create a local-only admin account on the UDM Pro 
                    that bypasses 2FA entirely. This isn't documented anywhere obvious.
                    The trick: Settings → Admins → Add Admin → Local Access Only.
                </p>

                <h3>Motion Events</h3>
                <p>
                    The AI cameras detect motion, people, vehicles, and packages. Events arrive 
                    via WebSocket within 50ms. The system can react to motion as it happens,
                    not seconds later through polling.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 6: DENON DEEP DIVE
         Mood: Old-school protocols. Telnet in 2025.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-integration">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">V</span>
                <h2 class="scene-title">Denon AVR</h2>
                <p class="scene-subtitle">Home theater via telnet and HEOS</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">15.4</span>
                    <span class="stat-unit">channels</span>
                </div>
                <div class="stat">
                    <span class="stat-value">A10H</span>
                    <span class="stat-unit">flagship</span>
                </div>
                <div class="stat">
                    <span class="stat-value">Atmos</span>
                    <span class="stat-unit">5.2.4</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>Two Protocols</h3>
                <p>
                    Denon offers two integration paths: raw telnet commands on port 23, and the 
                    HEOS WebSocket API for real-time events. I use both. Telnet for commands
                    (it's faster), HEOS for state notifications.
                </p>

                <figure class="code-figure">
                    <figcaption>denon.py — Telnet Control</figcaption>
                    <pre><code><span class="code-keyword">async def</span> <span class="code-function">connect</span>(self, max_retries: int = <span class="code-number">3</span>) -> bool:
    <span class="code-comment"># Denon uses raw TCP on port 23</span>
    <span class="code-keyword">for</span> attempt <span class="code-keyword">in</span> range(max_retries):
        <span class="code-keyword">try</span>:
            self._reader, self._writer = <span class="code-keyword">await</span> asyncio.wait_for(
                asyncio.open_connection(self._host, <span class="code-number">23</span>),
                timeout=<span class="code-number">20.0</span>
            )
            <span class="code-keyword">return</span> <span class="code-keyword">True</span>
        <span class="code-keyword">except</span> asyncio.TimeoutError:
            <span class="code-keyword">await</span> asyncio.sleep(<span class="code-number">2</span> ** attempt)
    <span class="code-keyword">return</span> <span class="code-keyword">False</span>

<span class="code-keyword">async def</span> <span class="code-function">send_command</span>(self, cmd: str) -> str:
    <span class="code-comment"># Commands are plain text, CR terminated</span>
    self._writer.write(f<span class="code-string">"{cmd}\r"</span>.encode())
    <span class="code-keyword">await</span> self._writer.drain()
    response = <span class="code-keyword">await</span> self._reader.readline()
    <span class="code-keyword">return</span> response.decode().strip()</code></pre>
                </figure>

                <h3>Input Source Archaeology</h3>
                <p>
                    The API accepts input names like "MPLAY" and "SAT/CBL". 
                    The UI shows "Apple TV" and "Cable". There's no mapping documentation. 
                    I literally tried every combination of input names and recorded which ones worked.
                </p>

                <figure class="code-figure">
                    <figcaption>Input Mapping</figcaption>
                    <pre><code>INPUT_MAP = {
    <span class="code-string">"Apple TV"</span>:    <span class="code-string">"MPLAY"</span>,     <span class="code-comment"># Media Player</span>
    <span class="code-string">"Cable"</span>:       <span class="code-string">"SAT/CBL"</span>,   <span class="code-comment"># Satellite/Cable</span>
    <span class="code-string">"Blu-ray"</span>:     <span class="code-string">"BD"</span>,        <span class="code-comment"># Blu-ray Disc</span>
    <span class="code-string">"Game"</span>:        <span class="code-string">"GAME"</span>,      <span class="code-comment"># Game Console</span>
    <span class="code-string">"Turntable"</span>:   <span class="code-string">"PHONO"</span>,     <span class="code-comment"># Phono Input</span>
}</code></pre>
                </figure>

                <h3>HEOS Real-Time Events</h3>
                <p>
                    HEOS provides WebSocket notifications for volume changes, input switches, and 
                    playback state. Events arrive within 200ms—fast enough for synchronized UI updates.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 7: TESLA DEEP DIVE
         Mood: API migration pain. The SSE revelation.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-integration scene-alt">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">VI</span>
                <h2 class="scene-title">Tesla Fleet</h2>
                <p class="scene-subtitle">Vehicle presence via Server-Sent Events</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">SSE</span>
                    <span class="stat-unit">streaming</span>
                </div>
                <div class="stat">
                    <span class="stat-value">~500ms</span>
                    <span class="stat-unit">latency</span>
                </div>
                <div class="stat">
                    <span class="stat-value">Geofence</span>
                    <span class="stat-unit">presence</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>The Migration</h3>
                <p>
                    My working Tesla integration suddenly stopped. Tesla had deprecated 
                    the Vehicle API. The new Fleet API requires registering as a "partner," 
                    which means hosting a public key at a specific URL path on a verified domain. 
                    For a personal project.
                </p>

                <p>
                    The reward: Server-Sent Events (SSE) streaming. Instead of polling every 30 seconds,
                    location updates arrive in real-time as the car moves. Geofence detection 
                    triggers within 500ms of crossing the boundary.
                </p>

                <figure class="code-figure">
                    <figcaption>tesla.py — SSE Streaming</figcaption>
                    <pre><code><span class="code-keyword">async def</span> <span class="code-function">stream_telemetry</span>(self):
    <span class="code-comment"># Fleet API uses Server-Sent Events</span>
    <span class="code-keyword">async with</span> self._session.get(
        f<span class="code-string">"{FLEET_URL}/vehicles/{self._vin}/telemetry_stream"</span>,
        headers={<span class="code-string">"Authorization"</span>: f<span class="code-string">"Bearer {self._token}"</span>}
    ) <span class="code-keyword">as</span> response:
        <span class="code-keyword">async for</span> line <span class="code-keyword">in</span> response.content:
            <span class="code-keyword">if</span> line.startswith(b<span class="code-string">"data: "</span>):
                data = json.loads(line[<span class="code-number">6</span>:])
                <span class="code-keyword">await</span> self._handle_telemetry(data)</code></pre>
                </figure>

                <h3>Geofence Presence</h3>
                <p>
                    When the car crosses within 200m of home, the system triggers arrival preparation.
                    Lights warm up, locks prepare to disengage, HVAC adjusts. By the time you park,
                    the house is ready.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 8: MITSUBISHI DEEP DIVE
         Mood: Cloud APIs. Zone control.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-integration">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">VII</span>
                <h2 class="scene-title">Mitsubishi HVAC</h2>
                <p class="scene-subtitle">Five-zone climate via Kumo Cloud</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">5</span>
                    <span class="stat-unit">zones</span>
                </div>
                <div class="stat">
                    <span class="stat-value">Kumo</span>
                    <span class="stat-unit">Cloud V3</span>
                </div>
                <div class="stat">
                    <span class="stat-value">60-85°F</span>
                    <span class="stat-unit">safe range</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>The Challenge</h3>
                <p>
                    Mitsubishi's mini-splits are connected through Kumo Cloud. Unlike most IoT,
                    they actually expose a reasonable API. The V3 API provides device discovery,
                    state polling, and command execution with proper error handling.
                </p>

                <figure class="code-figure">
                    <figcaption>mitsubishi.py</figcaption>
                    <pre><code><span class="code-keyword">async def</span> <span class="code-function">set_temperature</span>(
    self,
    zone: str,
    temp_f: float,
    mode: str = <span class="code-string">"auto"</span>
) -> bool:
    <span class="code-comment"># Kumo Cloud V3 API</span>
    device = self._zones.get(zone)
    <span class="code-keyword">if not</span> device:
        <span class="code-keyword">return</span> <span class="code-keyword">False</span>
    
    <span class="code-comment"># CBF safety bounds: 60-85°F</span>
    temp_f = max(<span class="code-number">60</span>, min(<span class="code-number">85</span>, temp_f))
    
    <span class="code-keyword">await</span> self._api.set_device(
        device[<span class="code-string">"serial"</span>],
        {<span class="code-string">"spCool"</span>: temp_f, <span class="code-string">"mode"</span>: mode}
    )
    <span class="code-keyword">return</span> <span class="code-keyword">True</span></code></pre>
                </figure>

                <h3>Zone Coordination</h3>
                <p>
                    Each room can have its own temperature. The office warms before work hours.
                    The bedroom cools before sleep. The system learns your patterns and pre-conditions
                    zones before you arrive.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 9: WORKSHOP DEEP DIVE
         Mood: Maker dreams. Local APIs.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-integration scene-alt">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">VIII</span>
                <h2 class="scene-title">Workshop</h2>
                <p class="scene-subtitle">Fabrication monitoring and control</p>
            </div>

            <div class="integration-stats">
                <div class="stat">
                    <span class="stat-value">Form 4</span>
                    <span class="stat-unit">3D printer</span>
                </div>
                <div class="stat">
                    <span class="stat-value">Local</span>
                    <span class="stat-unit">REST API</span>
                </div>
                <div class="stat">
                    <span class="stat-value">45W</span>
                    <span class="stat-unit">Glowforge laser</span>
                </div>
            </div>

            <div class="integration-content">
                <h3>Formlabs Form 4</h3>
                <p>
                    Unlike most IoT devices, Formlabs exposes a local REST API on your network.
                    Print status, job queue, material levels—all accessible without cloud dependency.
                    When a print completes, the house announces it through the nearest speaker.
                </p>

                <figure class="code-figure">
                    <figcaption>formlabs.py</figcaption>
                    <pre><code><span class="code-keyword">async def</span> <span class="code-function">get_printer_status</span>(self) -> PrinterStatus:
    <span class="code-comment"># Local API on port 80</span>
    <span class="code-keyword">async with</span> self._session.get(
        f<span class="code-string">"http://{self._host}/api/v1/status"</span>
    ) <span class="code-keyword">as</span> response:
        data = <span class="code-keyword">await</span> response.json()
        <span class="code-keyword">return</span> PrinterStatus(
            state=data[<span class="code-string">"printer_state"</span>],
            job_name=data.get(<span class="code-string">"current_job"</span>, {}).get(<span class="code-string">"name"</span>),
            progress=data.get(<span class="code-string">"print_progress"</span>, <span class="code-number">0</span>),
            time_remaining=data.get(<span class="code-string">"time_remaining_sec"</span>)
        )</code></pre>
                </figure>

                <h3>Glowforge (Limited)</h3>
                <p>
                    The Glowforge Pro is cloud-only by design. I can detect its presence on the network
                    via mDNS and monitor online/offline status, but actual control requires their web app.
                    This is on the "Up Next" list for deeper integration if they ever open the API.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 10: THEORY OF MIND
         Mood: Intelligence. The system learns.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-mind">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">IX</span>
                <h2 class="scene-title">Theory of Mind</h2>
                <p class="scene-subtitle">The system doesn't just see. It understands.</p>
            </div>

            <div class="mind-progression">
                <div class="mind-stage">
                    <span class="mind-number">1</span>
                    <span class="mind-question">Where?</span>
                    <p>Sensor fusion: WiFi, cameras, motion, car</p>
                </div>
                <div class="mind-arrow">→</div>
                <div class="mind-stage">
                    <span class="mind-number">2</span>
                    <span class="mind-question">What?</span>
                    <p>Activity inference from location + time</p>
                </div>
                <div class="mind-arrow">→</div>
                <div class="mind-stage">
                    <span class="mind-number">3</span>
                    <span class="mind-question">Why?</span>
                    <p>Intent prediction from learned patterns</p>
                </div>
                <div class="mind-arrow">→</div>
                <div class="mind-stage">
                    <span class="mind-number">4</span>
                    <span class="mind-question">Next?</span>
                    <p>Anticipate needs before you know them</p>
                </div>
            </div>

            <div class="mind-content">
                <h3>Pattern Learning</h3>
                <p>
                    The presence engine maintains a probability distribution over room occupancy 
                    for each 30-minute time slot. After a few weeks, it knows that at 7:30am on 
                    a weekday, there's a 94% chance you're in the kitchen.
                </p>

                <figure class="code-figure">
                    <figcaption>presence.py</figcaption>
                    <pre><code><span class="code-keyword">def</span> <span class="code-function">predict_next_room</span>(self) -> tuple[str, float]:
    slot = TimeSlot.current()
    pattern = self.patterns[slot]
    
    <span class="code-comment"># Most likely room given current time</span>
    probs = pattern.room_probabilities
    best = max(probs, key=probs.get)
    confidence = probs[best] / pattern.samples
    
    <span class="code-keyword">return</span> best, confidence</code></pre>
                </figure>

                <h3>Activity Context</h3>
                <p>
                    Room + time + duration maps to activity. The system doesn't need explicit 
                    "I'm cooking" declarations — it infers from behavior.
                </p>

                <figure class="context-table">
                    <div class="context-row context-header">
                        <span>Room</span>
                        <span>Time</span>
                        <span>Duration</span>
                        <span>Activity</span>
                    </div>
                    <div class="context-row">
                        <span>Kitchen</span>
                        <span>6–9am</span>
                        <span>15–30min</span>
                        <span class="context-activity">COOKING</span>
                    </div>
                    <div class="context-row">
                        <span>Office</span>
                        <span>9am–5pm</span>
                        <span>&gt; 30min</span>
                        <span class="context-activity">WORKING</span>
                    </div>
                    <div class="context-row">
                        <span>Living Room</span>
                        <span>7–11pm</span>
                        <span>&gt; 20min</span>
                        <span class="context-activity">RELAXING</span>
                    </div>
                    <div class="context-row">
                        <span>Primary Bed</span>
                        <span>10pm–7am</span>
                        <span>&gt; 15min</span>
                        <span class="context-activity">SLEEPING</span>
                    </div>
                </figure>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 11: SITUATION AWARENESS
         Mood: Layers. Hierarchy. Prediction.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-awareness">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">X</span>
                <h2 class="scene-title">Situation Awareness</h2>
                <p class="scene-subtitle">Four layers of predictive understanding</p>
            </div>

            <div class="awareness-layers">
                <div class="awareness-layer">
                    <span class="layer-name">Perception</span>
                    <span class="layer-desc">Raw sensor fusion from all sources</span>
                </div>
                <div class="awareness-arrow">↓</div>
                <div class="awareness-layer">
                    <span class="layer-name">Comprehension</span>
                    <span class="layer-desc">Pattern matching and activity inference</span>
                </div>
                <div class="awareness-arrow">↓</div>
                <div class="awareness-layer">
                    <span class="layer-name">Projection</span>
                    <span class="layer-desc">What will likely happen next</span>
                </div>
                <div class="awareness-arrow">↓</div>
                <div class="awareness-layer">
                    <span class="layer-name">Anticipation</span>
                    <span class="layer-desc">Pre-position resources for predicted needs</span>
                </div>
            </div>

            <div class="awareness-content">
                <h3>Phase Detection</h3>
                <p>
                    The day divides into phases: MORNING, WORKING, AFTERNOON, EVENING, NIGHT.
                    Each phase has different polling rates, notification thresholds, and automation
                    aggressiveness. During WORKING, email checks increase; during NIGHT, 
                    everything quiets except critical alerts.
                </p>

                <h3>Wakefulness States</h3>
                <p>
                    The system itself has wakefulness levels: DORMANT, DROWSY, ALERT, FOCUSED, HYPER.
                    During FOCUSED mode, Gmail polls 5x slower, Discord 10x slower. During HYPER
                    (active scene change), everything runs at 2x speed.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 12: CROSS-DOMAIN BRIDGE
         Mood: Digital meets physical. Magic happens.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-bridge">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">XI</span>
                <h2 class="scene-title">Cross-Domain Bridge</h2>
                <p class="scene-subtitle">When digital events trigger physical responses</p>
            </div>

            <div class="bridge-diagram">
                <div class="bridge-side bridge-digital">
                    <span class="bridge-label">Digital (Composio)</span>
                    <div class="bridge-items">
                        <span>Gmail</span>
                        <span>Slack</span>
                        <span>Calendar</span>
                        <span>Linear</span>
                        <span>+6 more</span>
                    </div>
                </div>
                <div class="bridge-center">
                    <span class="bridge-arrow">→</span>
                    <span class="bridge-text">Triggers</span>
                    <span class="bridge-arrow">→</span>
                </div>
                <div class="bridge-side bridge-physical">
                    <span class="bridge-label">Physical (SmartHome)</span>
                    <div class="bridge-items">
                        <span>Lights</span>
                        <span>Audio</span>
                        <span>HVAC</span>
                        <span>Shades</span>
                        <span>+more</span>
                    </div>
                </div>
            </div>

            <div class="bridge-content">
                <h3>Composio Integration</h3>
                <p>
                    Ten digital services connected through Composio: Gmail, Slack, Calendar, Linear,
                    Todoist, Notion, Drive, Sheets, Discord, Twitter. That's 500 API actions unified
                    under one interface.
                </p>

                <h3>Example Triggers</h3>
                <figure class="triggers-list">
                    <div class="trigger-row">
                        <span class="trigger-event">Urgent email arrives</span>
                        <span class="trigger-arrow">→</span>
                        <span class="trigger-action">Announce via occupied room speaker</span>
                    </div>
                    <div class="trigger-row">
                        <span class="trigger-event">Meeting in 5 minutes</span>
                        <span class="trigger-arrow">→</span>
                        <span class="trigger-action">Office lights optimize, shades adjust</span>
                    </div>
                    <div class="trigger-row">
                        <span class="trigger-event">PR merged</span>
                        <span class="trigger-arrow">→</span>
                        <span class="trigger-action">Celebration chime (quiet hours aware)</span>
                    </div>
                    <div class="trigger-row">
                        <span class="trigger-event">Focus mode enabled</span>
                        <span class="trigger-arrow">→</span>
                        <span class="trigger-action">Notifications pause, lights warm</span>
                    </div>
                </figure>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 13: PERFORMANCE
         Mood: Speed. Precision. The numbers matter.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-performance">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">XII</span>
                <h2 class="scene-title">Performance</h2>
            </div>

            <div class="perf-hero">
                <div class="perf-number">
                    <span class="perf-value">Parallel</span>
                </div>
                <p class="perf-context">Independent operations run concurrently, not sequentially.</p>
            </div>

            <div class="perf-content">
                <h3>Parallel Execution</h3>
                <p>
                    Scene activation doesn't wait for each device sequentially. 
                    Independent operations run in parallel via <code>asyncio.gather()</code>,
                    with dependencies executed in topological order.
                </p>

                <figure class="timeline-figure">
                    <div class="timeline-track">
                        <div class="timeline-row">
                            <span class="timeline-label">Control4</span>
                            <div class="timeline-bar" style="--start: 0; --width: 70"></div>
                        </div>
                        <div class="timeline-row">
                            <span class="timeline-label">Mitsubishi</span>
                            <div class="timeline-bar" style="--start: 0; --width: 45"></div>
                        </div>
                        <div class="timeline-row">
                            <span class="timeline-label">Denon</span>
                            <div class="timeline-bar" style="--start: 5; --width: 35"></div>
                        </div>
                        <div class="timeline-row">
                            <span class="timeline-label">August</span>
                            <div class="timeline-bar" style="--start: 10; --width: 60"></div>
                        </div>
                    </div>
                    <div class="timeline-scale">
                        <span>0ms</span>
                        <span>250ms</span>
                        <span>500ms</span>
                        <span>750ms</span>
                        <span>1000ms</span>
                    </div>
                </figure>

                <h3>Circuit Breakers</h3>
                <p>
                    Each integration has a circuit breaker that trips after 3 consecutive failures. 
                    The breaker stays open for 60 seconds before allowing a retry. 
                    One failing integration can't block the entire system.
                </p>

                <h3>Adaptive Polling</h3>
                <p>
                    Polling rates adapt to context. Four factors multiply: wakefulness level,
                    activity type, presence confidence, and time of day. Range: 0.25x to 10x baseline.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 14: SAFETY
         Mood: Responsibility. The invariant that protects everything.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-safety">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">XIII</span>
                <h2 class="scene-title">Safety</h2>
            </div>

            <div class="safety-hero">
                <div class="safety-formula">h(x) ≥ 0</div>
                <p class="safety-meaning">Always.</p>
            </div>

            <div class="safety-content">
                <p>
                    Some actions have consequences. The fireplace can start a fire. 
                    The TV mount can crush something. The locks have security implications. 
                    Every physical action passes through a Control Barrier Function (CBF) enforcer. 
                    If h(x) drops below zero, the action is blocked.
                </p>

                <div class="safety-rules">
                    <div class="safety-rule">
                        <span class="rule-icon">🔥</span>
                        <div class="rule-content">
                            <span class="rule-name">Fireplace</span>
                            <span class="rule-constraint">Auto-off after 4 hours</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">📺</span>
                        <div class="rule-content">
                            <span class="rule-name">TV Mount</span>
                            <span class="rule-constraint">Preset positions only (never arbitrary)</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">🔓</span>
                        <div class="rule-content">
                            <span class="rule-name">Unlock</span>
                            <span class="rule-constraint">Requires presence confirmation</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">❄️</span>
                        <div class="rule-content">
                            <span class="rule-name">HVAC</span>
                            <span class="rule-constraint">60–85°F range enforced</span>
                        </div>
                    </div>
                    <div class="safety-rule">
                        <span class="rule-icon">🔒</span>
                        <div class="rule-content">
                            <span class="rule-name">Security</span>
                            <span class="rule-constraint">Cannot disarm without presence</span>
                        </div>
                    </div>
                </div>

                <figure class="code-figure">
                    <figcaption>universal_cbf_enforcer.py</figcaption>
                    <pre><code><span class="code-keyword">def</span> <span class="code-function">check_action</span>(self, action: Action, state: HomeState) -> bool:
    <span class="code-comment"># Compute barrier function value</span>
    h_x = self._compute_barrier(action, state)
    
    <span class="code-keyword">if</span> h_x < <span class="code-number">0</span>:
        logger.warning(f<span class="code-string">"CBF violation: {action} blocked (h={h_x:.3f})"</span>)
        <span class="code-keyword">return</span> <span class="code-keyword">False</span>
    
    <span class="code-keyword">return</span> <span class="code-keyword">True</span></code></pre>
                </figure>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 15: REAL-TIME EVENTS
         Mood: WebSockets. Speed targets. Latency budgets.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-realtime">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">XIV</span>
                <h2 class="scene-title">Real-Time Events</h2>
                <p class="scene-subtitle">WebSocket, SSE, and strategic polling</p>
            </div>

            <div class="realtime-grid">
                <div class="realtime-source">
                    <span class="source-name">UniFi WebSocket</span>
                    <span class="source-latency">&lt; 50ms</span>
                    <span class="source-type">Binary frames</span>
                </div>
                <div class="realtime-source">
                    <span class="source-name">Control4 WebSocket</span>
                    <span class="source-latency">&lt; 100ms</span>
                    <span class="source-type">JSON events</span>
                </div>
                <div class="realtime-source">
                    <span class="source-name">Denon HEOS</span>
                    <span class="source-latency">&lt; 200ms</span>
                    <span class="source-type">WebSocket</span>
                </div>
                <div class="realtime-source">
                    <span class="source-name">Tesla Fleet</span>
                    <span class="source-latency">~500ms</span>
                    <span class="source-type">SSE streaming</span>
                </div>
            </div>

            <div class="realtime-content">
                <h3>Event Flow</h3>
                <p>
                    Real-time events from four sources converge into a unified event bus.
                    Each event is typed, timestamped, and routed to interested handlers.
                    Motion detection triggers lighting. Doorbell triggers camera snapshot.
                    Car arrival triggers welcome sequence.
                </p>

                <h3>Polling Fallbacks</h3>
                <p>
                    When WebSocket isn't available, adaptive polling fills the gap. Base intervals
                    range from 15 seconds (presence) to 600 seconds (sleep data), multiplied by
                    the 4-factor adaptive system based on current context.
                </p>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 16: THE YAK SHAVES
         Mood: Honesty. The real work behind the work.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-yaks">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">XV</span>
                <h2 class="scene-title">The Yak Shaves</h2>
                <p class="scene-subtitle">Every project has moments where you find yourself<br>three levels deep in something unrelated.</p>
            </div>

            <div class="yak-list">
                
                <article class="yak">
                    <h3>The Control4 Token Dance</h3>
                    <p>
                        To control my own lights, I need a bearer token. To get the token, 
                        I authenticate with Control4's cloud. The cloud returns an account token. 
                        I exchange that for a controller token. Then I get a director token. 
                        The director token expires in 24 hours. The refresh flow requires 
                        the entire dance again.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Token management is its own microservice.
                    </p>
                </article>

                <article class="yak">
                    <h3>UniFi Local Admin Discovery</h3>
                    <p>
                        UniFi's 2FA flow makes automation painful. After days of frustration, 
                        I discovered you can create a local-only admin account on the UDM Pro 
                        that bypasses 2FA entirely. This isn't documented anywhere obvious.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Enterprise features often have escape hatches.
                    </p>
                </article>

                <article class="yak">
                    <h3>Tesla Fleet API Migration</h3>
                    <p>
                        My working Tesla integration suddenly stopped. Tesla had deprecated 
                        the Vehicle API. The new Fleet API requires registering as a "partner," 
                        which means hosting a public key at a specific URL path on a verified domain. 
                        For a personal project.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> APIs you don't control can change overnight.
                    </p>
                </article>

                <article class="yak">
                    <h3>Denon Input Source Archaeology</h3>
                    <p>
                        The Denon API accepts input names like "MPLAY" and "SAT/CBL". 
                        The UI shows "Apple TV" and "Cable". There's no mapping documentation. 
                        I literally tried every combination of input names and recorded which ones worked.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Sometimes the only documentation is experimentation.
                    </p>
                </article>

                <article class="yak">
                    <h3>The Denon Connection Race</h3>
                    <p>
                        When too many integrations initialize simultaneously, the Denon AVR's telnet
                        port becomes overloaded. Connection timeouts cascaded. The fix: exponential
                        backoff with jitter, plus a 20-second timeout instead of 10.
                    </p>
                    <p class="yak-lesson">
                        <strong>Lesson:</strong> Initialization order matters more than you think.
                    </p>
                </article>

            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 17: UP NEXT
         Mood: Roadmap. The work continues.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-upnext">
        <div class="scene-container">
            
            <div class="scene-intro">
                <span class="scene-number">XVI</span>
                <h2 class="scene-title">Up Next</h2>
                <p class="scene-subtitle">Code exists. Wiring awaits.</p>
            </div>

            <div class="upnext-grid">
                <div class="upnext-item">
                    <span class="upnext-name">Eight Sleep</span>
                    <span class="upnext-status">OAuth reconnection</span>
                    <p>Full sleep tracking and bed temperature control. Code complete, awaiting API token refresh.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">LG TV</span>
                    <span class="upnext-status">WebSocket pairing</span>
                    <p>WebOS control ready. Needs on-screen pairing confirmation for persistent connection.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">Samsung TV</span>
                    <span class="upnext-status">Tizen connection</span>
                    <p>SmartThings API code ready. Device not responding—may need network reconfiguration.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">Apple Health</span>
                    <span class="upnext-status">HealthKit permissions</span>
                    <p>Heart rate and activity data for circadian automation. Requires iOS permissions flow.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">DSC Security</span>
                    <span class="upnext-status">Envisalink TPI</span>
                    <p>Direct panel integration via EVL-4. Currently routed through Control4.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">Glowforge</span>
                    <span class="upnext-status">Cloud-only limitation</span>
                    <p>Can detect network presence but control requires their web app. Monitoring for API access.</p>
                </div>
            </div>

        </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════
         SCENE 18: CLOSING
         Mood: Satisfaction. The promise fulfilled.
         ═══════════════════════════════════════════════════════════════════════ -->

    <section class="scene scene-closing">
        <div class="scene-container">
            
            <div class="closing-content">
                <p class="closing-lead">
                    The house thinks now.
                </p>
                <p class="closing-text">
                    It knows when I'm home, what I'm doing, and what I might need next. 
                    Nine physical integrations and ten digital services, unified under one command.
                    Forty-one lights, eleven shades, five HVAC zones, four cameras—all responding
                    in parallel, in under a second.
                </p>
                <p class="closing-text">
                    And when something fails — and it will — the system routes around it.
                    Circuit breakers trip. Failover paths activate. Degraded operation beats
                    total failure every time.
                </p>
                <p class="closing-coda">
                    That's not magic. That's just good engineering.
                </p>
            </div>

            <footer class="closing-footer">
                <a href="/art/home/" class="footer-link">See the house →</a>
                <span class="footer-divider">·</span>
                <span class="footer-location">Seattle · December 2025</span>
            </footer>

        </div>
    </section>

    <script src="js/main.js"></script>
</body>
</html>
