<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Command ‚Äî A Smart Home Deep Dive</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚åò</text></svg>">
</head>
<body>

    <!-- Hero -->
    <section class="scene scene-hook">
        <div class="hook-container">
            <span class="hook-eyebrow">A Technical Deep Dive</span>
            <h1 class="hook-title">One Command</h1>
            <p class="hook-subtitle">
                Twenty-six integrations. 724 actions. Circadian lighting. Predictive HVAC.<br>
                Computer control. One async function. Parallel execution.
            </p>

            <div class="terminal">
                <div class="terminal-chrome">
                    <span class="terminal-dot"></span>
                    <span class="terminal-dot"></span>
                    <span class="terminal-dot"></span>
                </div>
                <div class="terminal-screen">
                    <div class="terminal-line">
                        <span class="terminal-prompt">‚Üí</span>
                        <span class="terminal-command">await controller.goodnight()</span>
                    </div>
                    <div class="terminal-output">
                        <div class="output-item" style="--delay: 0.1s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">Control4: 41 lights fading</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.2s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">Lutron: 11 shades closing</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.3s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">August: 2 locks engaging</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.4s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">Mitsubishi: Night setback</span>
                            <span class="output-check">‚úì</span>
                        </div>
                        <div class="output-item" style="--delay: 0.5s">
                            <span class="output-icon">‚óê</span>
                            <span class="output-text">Denon: Audio off</span>
                            <span class="output-check">‚úì</span>
                        </div>
                    </div>
                    <div class="terminal-result">
                        ‚úì 26 integrations ¬∑ 724 actions ¬∑ &lt;1s
                    </div>
                </div>
            </div>

            <div class="hook-scroll">
                <span>How?</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 5v14m-7-7l7 7 7-7"/>
                </svg>
            </div>
        </div>
    </section>

    <!-- The Problem -->
    <section class="scene">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">01</span>
                <h2 class="section-title">The Problem</h2>
                <p class="section-lead">
                    Every vendor builds a walled garden. Nothing talks to anything else.
                </p>
            </header>

            <div class="content-block">
                <p>
                    Control4 speaks REST with proprietary tokens that expire every 24 hours.
                    UniFi uses binary WebSocket frames. Denon accepts raw telnet on port 23.
                    Tesla migrated to Fleet SSE. Mitsubishi hides behind Kumo Cloud.
                </p>
                <p>
                    I wanted direct API access. No cloud dependency. Sub-100ms response.
                    Full control over every byte on my network.
                </p>
            </div>

            <blockquote>
                Each vendor assumes they're the center of your universe.
            </blockquote>
        </div>
    </section>

    <!-- The Architecture -->
    <section class="scene scene-alt">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">02</span>
                <h2 class="section-title">The Architecture</h2>
                <p class="section-lead">
                    A singleton controller. Room-centric design. Failure assumed.
                </p>
            </header>

            <div class="arch-diagram">
                <div class="arch-layer">
                    <div class="arch-box arch-box-main">
                        <span class="arch-label">SmartHomeController</span>
                        <span class="arch-sublabel">singleton ¬∑ 26 rooms ¬∑ full authority</span>
                    </div>
                </div>
                <div class="arch-connector"></div>
                <div class="arch-layer">
                    <div class="arch-box">
                        <span class="arch-label">RoomOrchestrator</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">PresenceEngine</span>
                    </div>
                    <div class="arch-box">
                        <span class="arch-label">FailoverManager</span>
                    </div>
                </div>
                <div class="arch-connector"></div>
                <div class="tier-row">
                    <div class="tier tier-critical">Critical</div>
                    <div class="tier tier-high">High</div>
                    <div class="tier tier-medium">Medium</div>
                    <div class="tier tier-low">Low</div>
                </div>
            </div>

            <div class="callout">
                <h4>The Key Insight</h4>
                <p>
                    Every integration will fail. The question isn't if‚Äîit's when.
                    If Control4 goes down, lighting falls back to direct Lutron LEAP.
                    If UniFi fails, presence routes through Tesla geofencing.
                    There's always another path.
                </p>
            </div>
        </div>
    </section>

    <!-- Physical Integrations -->
    <section class="scene">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">03</span>
                <h2 class="section-title">Physical Integrations</h2>
                <p class="section-lead">
                    Thirteen systems, each with its own protocol and quirks.
                </p>
            </header>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Integration</th>
                        <th>Protocol</th>
                        <th>Challenge</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="mono">Control4</td>
                        <td>REST + WebSocket</td>
                        <td>24h token dance, undocumented device IDs</td>
                    </tr>
                    <tr>
                        <td class="mono">UniFi</td>
                        <td>Binary WebSocket</td>
                        <td>Reverse-engineered frame format</td>
                    </tr>
                    <tr>
                        <td class="mono">Denon</td>
                        <td>Telnet + HEOS</td>
                        <td>Input names don't match UI labels</td>
                    </tr>
                    <tr>
                        <td class="mono">Tesla</td>
                        <td>Fleet SSE</td>
                        <td>Partner registration required</td>
                    </tr>
                    <tr>
                        <td class="mono">Mitsubishi</td>
                        <td>Kumo Cloud V3</td>
                        <td>Per-zone coordination</td>
                    </tr>
                    <tr>
                        <td class="mono">August</td>
                        <td>yalexs REST</td>
                        <td>Rate limiting</td>
                    </tr>
                    <tr>
                        <td class="mono">Eight Sleep</td>
                        <td>OAuth2 REST</td>
                        <td>8+ second API latency</td>
                    </tr>
                    <tr>
                        <td class="mono">LG TV</td>
                        <td>WebSocket</td>
                        <td>Session management</td>
                    </tr>
                    <tr>
                        <td class="mono">Formlabs</td>
                        <td>Local REST</td>
                        <td>Job monitoring</td>
                    </tr>
                    <tr>
                        <td class="mono">Spotify</td>
                        <td>librespot</td>
                        <td>Playlist playback</td>
                    </tr>
                </tbody>
            </table>

            <div class="content-block">
                <h3>The Token Dance</h3>
                <p>
                    Control4 requires a three-step authentication through their cloud:
                    account token ‚Üí controller token ‚Üí director token.
                    The director token expires in 24 hours. I automated the entire flow.
                </p>
            </div>

            <div class="content-block">
                <h3>Binary WebSocket</h3>
                <p>
                    UniFi's WebSocket uses undocumented binary frames. I captured network traffic
                    and reverse-engineered the 8-byte header: packet type, payload format,
                    compression flag, and payload size. Motion events arrive in under 50ms.
                </p>
            </div>
        </div>
    </section>

    <!-- Digital Services -->
    <section class="scene scene-alt">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">04</span>
                <h2 class="section-title">Digital Services</h2>
                <p class="section-lead">
                    Ten cloud services via Composio: Gmail, Slack, Calendar, and more.
                </p>
            </header>

            <div class="stats-row">
                <div class="stat">
                    <span class="stat-value">724</span>
                    <span class="stat-label">total actions</span>
                </div>
                <div class="stat">
                    <span class="stat-value">10</span>
                    <span class="stat-label">digital services</span>
                </div>
                <div class="stat">
                    <span class="stat-value">3</span>
                    <span class="stat-label">computer tiers</span>
                </div>
            </div>

            <div class="content-block">
                <p>
                    Urgent emails announce through speakers. Calendar events trigger room preparation.
                    PR merges get celebration announcements. Digital events drive physical responses.
                </p>
            </div>
        </div>
    </section>

    <!-- Computer Control -->
    <section class="scene">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">05</span>
                <h2 class="section-title">Computer Control</h2>
                <p class="section-lead">
                    Three tiers of automation: host, sandboxed, and multi-OS.
                </p>
            </header>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Tier</th>
                        <th>Technology</th>
                        <th>Use Case</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="mono">1: Host</td>
                        <td>Peekaboo MCP</td>
                        <td>Direct macOS automation, sub-100ms</td>
                    </tr>
                    <tr>
                        <td class="mono">2: Sandboxed</td>
                        <td>CUA/Lume</td>
                        <td>Isolated macOS VMs, 97% native speed</td>
                    </tr>
                    <tr>
                        <td class="mono">3: Multi-OS</td>
                        <td>Parallels</td>
                        <td>Windows/Linux, cross-platform testing</td>
                    </tr>
                </tbody>
            </table>

            <div class="content-block">
                <h3>The Three-Tier Model</h3>
                <p>
                    Tier 1 is the Mac itself‚ÄîPeekaboo captures screenshots, reads the accessibility tree,
                    clicks, types. Fast and direct. But it's the real machine. Mistakes are permanent.
                </p>
                <p>
                    Tier 2 isolates risk. CUA/Lume spins up macOS VMs using Apple's Virtualization.Framework.
                    97% native speed on Apple Silicon. Snapshot before experimenting. Restore in seconds.
                </p>
                <p>
                    Tier 3 crosses platforms. The Parallels "Gaming" VM runs Windows 11 with 16 cores and 128GB RAM.
                    Execute PowerShell scripts. Test Windows-specific workflows. Same API, different OS.
                </p>
            </div>

            <div class="content-block">
                <h3>Unified CLI</h3>
                <p>
                    One interface routes commands everywhere. <code>cli.execute("ls")</code> runs locally.
                    Add <code>target="parallels"</code> and it runs on Windows. Add <code>target="lume"</code>
                    for the sandboxed VM. Same API, different target.
                </p>
            </div>
        </div>
    </section>

    <!-- Intelligence -->
    <section class="scene scene-alt">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">06</span>
                <h2 class="section-title">Intelligence</h2>
                <p class="section-lead">
                    The system doesn't just see. It understands.
                </p>
            </header>

            <div class="content-block">
                <h3>Pattern Learning</h3>
                <p>
                    The PresenceEngine divides each day into 30-minute slots, tracking
                    weekdays and weekends separately. Every observation updates probabilities
                    via exponential moving average. Recent behavior matters more than old habits.
                </p>
            </div>

            <div class="content-block">
                <h3>Circadian Lighting</h3>
                <p>
                    Light color temperature follows your body's rhythm: 3000K warm at dawn,
                    5000K cool during the day, 2700K warm at night. Brightness scales from
                    30% to 100% and back down.
                </p>
            </div>

            <div class="content-block">
                <h3>Predictive HVAC</h3>
                <p>
                    Tesla location triggers arrival prediction. The system calculates ETA
                    and pre-conditions the home 15 minutes before you arrive.
                    Comfort waiting, not catching up.
                </p>
            </div>

            <div class="content-block">
                <h3>Visitor Detection</h3>
                <p>
                    WiFi presence categorizes every device: Owner, Family, Friend, Service,
                    Airbnb, Infrastructure, Unknown. Known visitors trigger welcome sequences.
                    Unknown devices generate alerts. Guest mode activates automatically.
                </p>
            </div>
        </div>
    </section>

    <!-- Cross-Domain -->
    <section class="scene">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">07</span>
                <h2 class="section-title">Cross-Domain Triggers</h2>
                <p class="section-lead">
                    Digital events trigger physical responses.
                </p>
            </header>

            <div class="trigger-list">
                <div class="trigger-item">
                    <span class="trigger-event">Urgent email arrives</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Announce via occupied room speaker</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">Meeting in 15 minutes</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Office lights optimize, shades adjust</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">Sleep detected</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Goodnight scene activates</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">Vehicle arriving (ETA &lt;5min)</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Welcome home sequence</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">Hot sunny weather</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">South-facing shades close</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">PR merged</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Celebration announcement</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">Motion + away from desk</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Screenshot capture for context resume</span>
                </div>
                <div class="trigger-item">
                    <span class="trigger-event">CI/CD pipeline starts</span>
                    <span class="trigger-arrow">‚Üí</span>
                    <span class="trigger-action">Spin up testing VM</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Safety -->
    <section class="scene scene-alt">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">08</span>
                <h2 class="section-title">Safety</h2>
            </header>

            <div class="safety-hero">
                <div class="safety-formula">h(x) ‚â• 0</div>
                <p class="safety-meaning">Always.</p>
            </div>

            <div class="content-block">
                <p>
                    Some actions have consequences. Every physical action passes through
                    a Control Barrier Function enforcer. If h(x) drops below zero,
                    the action is blocked.
                </p>
            </div>

            <div class="safety-rules">
                <div class="safety-rule">
                    <span class="rule-icon">üî•</span>
                    <span class="rule-name">Fireplace</span>
                    <span class="rule-constraint">Auto-off after 4 hours</span>
                </div>
                <div class="safety-rule">
                    <span class="rule-icon">üì∫</span>
                    <span class="rule-name">TV Mount</span>
                    <span class="rule-constraint">Preset positions only</span>
                </div>
                <div class="safety-rule">
                    <span class="rule-icon">üîì</span>
                    <span class="rule-name">Unlock</span>
                    <span class="rule-constraint">Requires presence confirmation</span>
                </div>
                <div class="safety-rule">
                    <span class="rule-icon">‚ùÑÔ∏è</span>
                    <span class="rule-name">HVAC</span>
                    <span class="rule-constraint">60‚Äì85¬∞F range enforced</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Lessons -->
    <section class="scene">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">09</span>
                <h2 class="section-title">Lessons</h2>
                <p class="section-lead">
                    What I learned building this system.
                </p>
            </header>

            <div class="lesson-list">
                <article class="lesson">
                    <span class="lesson-number">01</span>
                    <h3>APIs change overnight</h3>
                    <p>
                        Tesla deprecated their Vehicle API without warning.
                        Every integration needs circuit breakers and fallback paths.
                    </p>
                </article>

                <article class="lesson">
                    <span class="lesson-number">02</span>
                    <h3>Documentation is experimentation</h3>
                    <p>
                        Denon's input names don't match their UI. I tried every combination.
                        Now my code is the documentation.
                    </p>
                </article>

                <article class="lesson">
                    <span class="lesson-number">03</span>
                    <h3>Initialization order matters</h3>
                    <p>
                        Nine integrations connecting simultaneously overwhelmed Denon's telnet port.
                        The fix: exponential backoff with jitter.
                    </p>
                </article>

                <article class="lesson">
                    <span class="lesson-number">04</span>
                    <h3>Respect rate limits</h3>
                    <p>
                        Eight Sleep's rate limiting taught me: read the Retry-After header,
                        back off gracefully. Patient clients stay connected.
                    </p>
                </article>
            </div>
        </div>
    </section>

    <!-- Up Next -->
    <section class="scene scene-alt">
        <div class="scene-container">
            <header class="section-header">
                <span class="section-number">10</span>
                <h2 class="section-title">Up Next</h2>
                <p class="section-lead">
                    Code exists. Wiring awaits.
                </p>
            </header>

            <div class="upnext-grid">
                <div class="upnext-item">
                    <span class="upnext-name">Eight Sleep</span>
                    <span class="upnext-status">Deferred connection</span>
                    <p>Cloud API is slow (8+ seconds). Connection deferred to background after boot.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">Samsung TV</span>
                    <span class="upnext-status">Network discovery</span>
                    <p>SmartThings code ready. Device not responding to wake packets.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">Apple Health</span>
                    <span class="upnext-status">iOS permissions</span>
                    <p>Heart rate and activity for circadian automation. Needs HealthKit flow.</p>
                </div>
                <div class="upnext-item">
                    <span class="upnext-name">Glowforge</span>
                    <span class="upnext-status">Network monitoring only</span>
                    <p>Can detect presence via mDNS. No local API for control.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Closing -->
    <section class="scene scene-closing">
        <div class="scene-container">
            <p class="closing-lead">
                The house thinks now.
            </p>
            <p class="closing-text">
                Twenty-six integrations. 724 actions. Circadian lighting. Predictive HVAC.
                Visitor detection. Three-tier computer control. Pattern learning that improves over time.
            </p>
            <p class="closing-text">
                Every integration has a circuit breaker. Every failure has a fallback.
                State reconciliation catches drift. Persistence survives restarts.
            </p>
            <p class="closing-coda">
                Not magic. Just engineering.
            </p>

            <footer class="closing-footer">
                <a href="/art/home/" class="footer-link">See the house ‚Üí</a>
                <span class="footer-divider">¬∑</span>
                <span>Seattle ¬∑ December 2025</span>
            </footer>
        </div>
    </section>

</body>
</html>
